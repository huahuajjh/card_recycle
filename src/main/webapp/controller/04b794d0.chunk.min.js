webpackJsonp([39],{297:function(module,exports,__webpack_require__){(function(__webpack_provided_window_dot_jQuery,module){"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};!function(factory){"function"==typeof window.define?window.define.amd?window.define("wangEditor",["jquery"],factory):window.define.cmd?window.define(function(require,exports,module){return factory}):factory(__webpack_provided_window_dot_jQuery):"object"===_typeof(module)&&"object"===_typeof(module.exports)?(window.wangEditorCssPath?__webpack_require__(299)(window.wangEditorCssPath):__webpack_require__(290),module.exports=factory(window.wangEditorJQueryPath?__webpack_require__(299)(window.wangEditorJQueryPath):__webpack_require__(47))):factory(__webpack_provided_window_dot_jQuery)}(function($){if(!$||!$.fn||!$.fn.jquery)return void alert("在引用wangEditor.js之前，先引用jQuery，否则无法使用 wangEditor");var _e=function(fn){var E=window.wangEditor;E&&fn(E,$)};return function(window,$){if(window.wangEditor)return void alert("一个页面不能重复引用 wangEditor.js 或 wangEditor.min.js ！！！");var E=function(elem){"string"==typeof elem&&(elem="#"+elem);var $elem=$(elem);if(1===$elem.length){var nodeName=$elem[0].nodeName;"TEXTAREA"!==nodeName&&"DIV"!==nodeName||(this.valueNodeName=nodeName.toLowerCase(),this.$valueContainer=$elem,this.$prev=$elem.prev(),this.$parent=$elem.parent(),this.init())}};E.fn=E.prototype,E.$body=$("body"),E.$document=$(document),E.$window=$(window),E.userAgent=navigator.userAgent,E.getComputedStyle=window.getComputedStyle,E.w3cRange="function"==typeof document.createRange,E.hostname=location.hostname.toLowerCase(),E.websiteHost="wangeditor.github.io|www.wangeditor.com|wangeditor.coding.me",E.isOnWebsite=E.websiteHost.indexOf(E.hostname)>=0,E.docsite="http://www.kancloud.cn/wangfupeng/wangeditor2/113961",window.wangEditor=E,E.plugin=function(fn){E._plugins||(E._plugins=[]),"function"==typeof fn&&E._plugins.push(fn)}}(window,$),_e(function(E,$){E.fn.init=function(){this.initDefaultConfig(),this.addEditorContainer(),this.addTxt(),this.addMenuContainer(),this.menus={},this.commandHooks()}}),_e(function(E,$){E.fn.ready=function(fn){this.readyFns||(this.readyFns=[]),this.readyFns.push(fn)},E.fn.readyHeadler=function(){for(var fns=this.readyFns;fns.length;)fns.shift().call(this)},E.fn.updateValue=function(){var editor=this,$valueContainer=editor.$valueContainer,$txt=editor.txt.$txt;if($valueContainer!==$txt){var value=$txt.html();$valueContainer.val(value)}},E.fn.getInitValue=function(){var editor=this,$valueContainer=editor.$valueContainer,currentValue="",nodeName=editor.valueNodeName;return"div"===nodeName?currentValue=$valueContainer.html():"textarea"===nodeName&&(currentValue=$valueContainer.val()),currentValue},E.fn.updateMenuStyle=function(){var menus=this.menus;$.each(menus,function(k,menu){menu.updateSelected()})},E.fn.enableMenusExcept=function(menuIds){this._disabled||(menuIds=menuIds||[],"string"==typeof menuIds&&(menuIds=[menuIds]),$.each(this.menus,function(k,menu){menuIds.indexOf(k)>=0||menu.disabled(!1)}))},E.fn.disableMenusExcept=function(menuIds){this._disabled||(menuIds=menuIds||[],"string"==typeof menuIds&&(menuIds=[menuIds]),$.each(this.menus,function(k,menu){menuIds.indexOf(k)>=0||menu.disabled(!0)}))},E.fn.hideDropPanelAndModal=function(){var menus=this.menus;$.each(menus,function(k,menu){var m=menu.dropPanel||menu.dropList||menu.modal;m&&m.hide&&m.hide()})}}),_e(function(E,$){function emptyFn(){}var ieRange=!E.w3cRange;E.fn.currentRange=function(cr){return cr?void(this._rangeData=cr):this._rangeData},E.fn.collapseRange=function(range,opt){opt=opt||"end",opt="start"===opt,range=range||this.currentRange(),range&&(range.collapse(opt),this.currentRange(range))},E.fn.getRangeText=ieRange?emptyFn:function(range){if(range=range||this.currentRange())return range.toString()},E.fn.getRangeElem=ieRange?emptyFn:function(range){range=range||this.currentRange();var dom=range.commonAncestorContainer;return 1===dom.nodeType?dom:dom.parentNode},E.fn.isRangeEmpty=ieRange?emptyFn:function(range){return range=range||this.currentRange(),!(!range||!range.startContainer||range.startContainer!==range.endContainer||range.startOffset!==range.endOffset)},E.fn.saveSelection=ieRange?emptyFn:function(range){var _parentElem,selection,self=this,txt=self.txt.$txt.get(0);range?_parentElem=range.commonAncestorContainer:(selection=document.getSelection(),selection.getRangeAt&&selection.rangeCount&&(range=document.getSelection().getRangeAt(0),_parentElem=range.commonAncestorContainer)),_parentElem&&($.contains(txt,_parentElem)||txt===_parentElem)&&self.currentRange(range)},E.fn.restoreSelection=ieRange?emptyFn:function(range){var selection;if(range=range||this.currentRange())try{selection=document.getSelection(),selection.removeAllRanges(),selection.addRange(range)}catch(ex){E.error("执行 editor.restoreSelection 时，IE可能会有异常，不影响使用")}},E.fn.restoreSelectionByElem=ieRange?emptyFn:function(elem,opt){elem&&(opt=opt||"end",this.setRangeByElem(elem),"start"===opt&&this.collapseRange(this.currentRange(),"start"),"end"===opt&&this.collapseRange(this.currentRange(),"end"),this.restoreSelection())},E.fn.initSelection=ieRange?emptyFn:function(){var editor=this;if(!editor.currentRange()){var $txt=editor.txt.$txt,$firstChild=$txt.children().first();$firstChild.length&&editor.restoreSelectionByElem($firstChild.get(0))}},E.fn.setRangeByElem=ieRange?emptyFn:function(elem){var editor=this,txtElem=editor.txt.$txt.get(0);if(elem&&$.contains(txtElem,elem)){for(var firstTextNode=elem.firstChild;firstTextNode&&3!==firstTextNode.nodeType;)firstTextNode=firstTextNode.firstChild;for(var lastTextNode=elem.lastChild;lastTextNode&&3!==lastTextNode.nodeType;)lastTextNode=lastTextNode.lastChild;var range=document.createRange();firstTextNode&&lastTextNode?(range.setStart(firstTextNode,0),range.setEnd(lastTextNode,lastTextNode.textContent.length)):(range.setStart(elem,0),range.setEnd(elem,0)),editor.saveSelection(range)}}}),_e(function(E,$){E.w3cRange||(E.fn.getRangeText=function(range){if(range=range||this.currentRange())return range.text},E.fn.getRangeElem=function(range){if(range=range||this.currentRange()){var dom=range.parentElement();return 1===dom.nodeType?dom:dom.parentNode}},E.fn.isRangeEmpty=function(range){return range=range||this.currentRange(),!range||!range.text},E.fn.saveSelection=function(range){var _parentElem,self=this,txt=self.txt.$txt.get(0);range?_parentElem=range.parentElement():(range=document.selection.createRange(),_parentElem="undefined"==typeof range.parentElement?null:range.parentElement()),_parentElem&&($.contains(txt,_parentElem)||txt===_parentElem)&&self.currentRange(range)},E.fn.restoreSelection=function(currentRange){var range,editor=this;if(currentRange=currentRange||editor.currentRange()){range=document.selection.createRange();try{range.setEndPoint("EndToEnd",currentRange)}catch(ex){}if(0===currentRange.text.length)try{range.collapse(!1)}catch(ex){}else range.setEndPoint("StartToStart",currentRange);range.select()}})}),_e(function(E,$){E.fn.commandHooks=function(){var editor=this,commandHooks={};commandHooks.insertHtml=function(html){var targetElem,$elem=$(html),rangeElem=editor.getRangeElem();targetElem=editor.getLegalTags(rangeElem),targetElem&&$(targetElem).after($elem)},editor.commandHooks=commandHooks}}),_e(function(E,$){E.fn.command=function(e,commandName,commandValue,callback){function commandFn(){commandName&&(editor.queryCommandSupported(commandName)?document.execCommand(commandName,!1,commandValue):(hooks=editor.commandHooks,commandName in hooks&&hooks[commandName](commandValue)))}var hooks,editor=this;this.customCommand(e,commandFn,callback)},E.fn.commandForElem=function(elemOpt,e,commandName,commandValue,callback){var selector,check;"string"==typeof elemOpt?selector=elemOpt:(selector=elemOpt.selector,check=elemOpt.check);var rangeElem=this.getRangeElem();rangeElem=this.getSelfOrParentByName(rangeElem,selector,check),rangeElem&&this.setRangeByElem(rangeElem),this.command(e,commandName,commandValue,callback)},E.fn.customCommand=function(e,commandFn,callback){function hidePanelAndModal(){editor.hideDropPanelAndModal()}var editor=this,range=editor.currentRange();return range?(editor.undoRecord(),this.restoreSelection(range),commandFn.call(editor),this.saveSelection(),this.restoreSelection(),callback&&"function"==typeof callback&&callback.call(editor),editor.txt.insertEmptyP(),editor.txt.wrapImgAndText(),editor.updateValue(),editor.updateMenuStyle(),setTimeout(hidePanelAndModal,200),void(e&&e.preventDefault())):void(e&&e.preventDefault())},E.fn.queryCommandValue=function(commandName){var result="";try{result=document.queryCommandValue(commandName)}catch(ex){}return result},E.fn.queryCommandState=function(commandName){var result=!1;try{result=document.queryCommandState(commandName)}catch(ex){}return result},E.fn.queryCommandSupported=function(commandName){var result=!1;try{result=document.queryCommandSupported(commandName)}catch(ex){}return result}}),_e(function(E,$){function _matchesSelectorForIE(selector){var elem=this,$elems=$(selector),result=!1;return $elems.each(function(){if(this===elem)return result=!0,!1}),result}var matchesSelector;E.fn.getLegalTags=function(elem){var legalTags=this.config.legalTags;return legalTags?this.getSelfOrParentByName(elem,legalTags):void E.error("配置项中缺少 legalTags 的配置")},E.fn.getSelfOrParentByName=function(elem,selector,check){if(elem&&selector){matchesSelector||(matchesSelector=elem.webkitMatchesSelector||elem.mozMatchesSelector||elem.oMatchesSelector||elem.matchesSelector),matchesSelector||(matchesSelector=_matchesSelectorForIE);for(var txt=this.txt.$txt.get(0);elem&&txt!==elem&&$.contains(txt,elem);){if(matchesSelector.call(elem,selector)){if(!check)return elem;if(check(elem))return elem}elem=elem.parentNode}}}}),_e(function(E,$){function _getRedoList(editor){return null==editor._redoList&&(editor._redoList=[]),editor._redoList}function _getUndoList(editor){return null==editor._undoList&&(editor._undoList=[]),editor._undoList}function _handle(editor,data,type){var val=data.val,html=editor.txt.$txt.html();if(null!=val){if(val===html)return"redo"===type?void editor.redo():"undo"===type?void editor.undo():void 0;editor.txt.$txt.html(val),editor.updateValue(),editor.onchange&&"function"==typeof editor.onchange&&editor.onchange.call(editor)}}var length=20;E.fn.undoRecord=function(){var editor=this,$txt=editor.txt.$txt,val=$txt.html(),undoList=_getUndoList(editor),redoList=_getRedoList(editor),currentVal=undoList.length?undoList[0]:"";val!==currentVal.val&&(redoList.length&&(redoList=[]),undoList.unshift({range:editor.currentRange(),val:val}),undoList.length>length&&undoList.pop())},E.fn.undo=function(){var editor=this,undoList=_getUndoList(editor),redoList=_getRedoList(editor);if(undoList.length){var data=undoList.shift();redoList.unshift(data),_handle(this,data,"undo")}},E.fn.redo=function(){var editor=this,undoList=_getUndoList(editor),redoList=_getRedoList(editor);if(redoList.length){var data=redoList.shift();undoList.unshift(data),_handle(this,data,"redo")}}}),_e(function(E,$){E.fn.create=function(){var editor=this;E.$body&&0!==E.$body.length||(E.$body=$("body"),E.$document=$(document),E.$window=$(window)),editor.addMenus(),editor.renderMenus(),editor.renderMenuContainer(),editor.renderTxt(),editor.renderEditorContainer(),editor.eventMenus(),editor.eventMenuContainer(),editor.eventTxt(),editor.readyHeadler(),editor.initSelection(),editor.$txt=editor.txt.$txt;var _plugins=E._plugins;_plugins&&_plugins.length&&$.each(_plugins,function(k,val){val.call(editor)})},E.fn.disable=function(){this.txt.$txt.removeAttr("contenteditable"),this.disableMenusExcept(),this._disabled=!0},E.fn.enable=function(){this._disabled=!1,this.txt.$txt.attr("contenteditable","true"),this.enableMenusExcept()},E.fn.destroy=function(){var self=this,$valueContainer=self.$valueContainer,$editorContainer=self.$editorContainer,valueNodeName=self.valueNodeName;"div"===valueNodeName?($valueContainer.removeAttr("contenteditable"),$editorContainer.after($valueContainer),$editorContainer.hide()):($valueContainer.show(),$editorContainer.hide())},E.fn.undestroy=function(){var self=this,$valueContainer=self.$valueContainer,$editorContainer=self.$editorContainer,$menuContainer=self.menuContainer.$menuContainer,valueNodeName=self.valueNodeName;"div"===valueNodeName?($valueContainer.attr("contenteditable","true"),$menuContainer.after($valueContainer),$editorContainer.show()):($valueContainer.hide(),$editorContainer.show())},E.fn.clear=function(){var editor=this,$txt=editor.txt.$txt;$txt.html("<p><br></p>"),editor.restoreSelectionByElem($txt.find("p").get(0))}}),_e(function(E,$){var MenuContainer=function(editor){this.editor=editor,this.init()};MenuContainer.fn=MenuContainer.prototype,E.MenuContainer=MenuContainer}),_e(function(E,$){var MenuContainer=E.MenuContainer;MenuContainer.fn.init=function(){var self=this,$menuContainer=$('<div class="wangEditor-menu-container clearfix"></div>');self.$menuContainer=$menuContainer,self.changeShadow()},MenuContainer.fn.changeShadow=function(){var $menuContainer=this.$menuContainer,editor=this.editor,$txt=editor.txt.$txt;$txt.on("scroll",function(){$txt.scrollTop()>10?$menuContainer.addClass("wangEditor-menu-shadow"):$menuContainer.removeClass("wangEditor-menu-shadow")})}}),_e(function(E,$){var MenuContainer=E.MenuContainer;MenuContainer.fn.render=function(){var $menuContainer=this.$menuContainer,$editorContainer=this.editor.$editorContainer;$editorContainer.append($menuContainer)},MenuContainer.fn.height=function(){var $menuContainer=this.$menuContainer;return $menuContainer.height()},MenuContainer.fn.appendMenu=function(groupIdx,menu){return this._addGroup(groupIdx),this._addOneMenu(menu)},MenuContainer.fn._addGroup=function(groupIdx){var $menuGroup,$menuContainer=this.$menuContainer;this.$currentGroup&&this.currentGroupIdx===groupIdx||($menuGroup=$('<div class="menu-group clearfix"></div>'),$menuContainer.append($menuGroup),this.$currentGroup=$menuGroup,this.currentGroupIdx=groupIdx)},MenuContainer.fn._addOneMenu=function(menu){var $menuNormal=menu.$domNormal,$menuSelected=menu.$domSelected,$menuGroup=this.$currentGroup,$item=$('<div class="menu-item clearfix"></div>');return $menuSelected.hide(),$item.append($menuNormal).append($menuSelected),$menuGroup.append($item),$item}}),_e(function(E,$){var Menu=function(opt){this.editor=opt.editor,this.id=opt.id,this.title=opt.title,this.$domNormal=opt.$domNormal,this.$domSelected=opt.$domSelected||opt.$domNormal,this.commandName=opt.commandName,this.commandValue=opt.commandValue,this.commandNameSelected=opt.commandNameSelected||opt.commandName,this.commandValueSelected=opt.commandValueSelected||opt.commandValue};Menu.fn=Menu.prototype,E.Menu=Menu}),_e(function(E,$){var Menu=E.Menu;Menu.fn.initUI=function(){var editor=this.editor,uiConfig=editor.UI.menus,menuId=this.id,menuUI=uiConfig[menuId];this.$domNormal&&this.$domSelected||(null==menuUI&&(E.warn('editor.UI配置中，没有菜单 "'+menuId+'" 的UI配置，只能取默认值'),menuUI=uiConfig["default"]),this.$domNormal=$(menuUI.normal),/^\./.test(menuUI.selected)?this.$domSelected=this.$domNormal.clone().addClass(menuUI.selected.slice(1)):this.$domSelected=$(menuUI.selected))}}),_e(function(E,$){var Menu=E.Menu;Menu.fn.render=function(groupIdx){this.initUI();var editor=this.editor,menuContainer=editor.menuContainer,$menuItem=menuContainer.appendMenu(groupIdx,this),onRender=this.onRender;this._renderTip($menuItem),onRender&&"function"==typeof onRender&&onRender.call(this)},Menu.fn._renderTip=function($menuItem){function show(){$tip.show()}function hide(){$tip.hide()}var $tempDiv,self=this,editor=self.editor,title=self.title,$tip=$('<div class="menu-tip"></div>');self.tipWidth||($tempDiv=$('<p style="opacity:0; filter:Alpha(opacity=0); position:absolute;top:-10000px;">'+title+"</p>"),E.$body.append($tempDiv),editor.ready(function(){var titleWidth=$tempDiv.outerWidth()+5,currentWidth=$tip.outerWidth(),currentMarginLeft=parseFloat($tip.css("margin-left"),10);$tempDiv.remove(),$tempDiv=null,$tip.css({width:titleWidth,"margin-left":currentMarginLeft+(currentWidth-titleWidth)/2}),self.tipWidth=titleWidth})),$tip.append(title),$menuItem.append($tip);var timeoutId;$menuItem.find("a").on("mouseenter",function(e){self.active()||self.disabled()||(timeoutId=setTimeout(show,200))}).on("mouseleave",function(e){timeoutId&&clearTimeout(timeoutId),hide()}).on("click",hide)},Menu.fn.bindEvent=function(){var self=this,$domNormal=self.$domNormal,$domSelected=self.$domSelected,clickEvent=self.clickEvent;clickEvent||(clickEvent=function(e){var dropObj=self.dropPanel||self.dropList||self.modal;if(dropObj&&dropObj.show)return void(dropObj.isShowing?dropObj.hide():dropObj.show());var commandName,commandValue,editor=self.editor,selected=self.selected;selected?(commandName=self.commandNameSelected,commandValue=self.commandValueSelected):(commandName=self.commandName,commandValue=self.commandValue),commandName?editor.command(e,commandName,commandValue):(E.warn('菜单 "'+self.id+'" 未定义click事件'),e.preventDefault())});var clickEventSelected=self.clickEventSelected||clickEvent;$domNormal.click(function(e){self.disabled()||(clickEvent.call(self,e),self.updateSelected()),e.preventDefault()}),$domSelected.click(function(e){self.disabled()||(clickEventSelected.call(self,e),self.updateSelected()),e.preventDefault()})},Menu.fn.updateSelected=function(){var self=this,updateSelectedEvent=(self.editor,self.updateSelectedEvent);updateSelectedEvent||(updateSelectedEvent=function(){var self=this,editor=self.editor,commandName=self.commandName,commandValue=self.commandValue;if(commandValue){if(editor.queryCommandValue(commandName).toLowerCase()===commandValue.toLowerCase())return!0}else if(editor.queryCommandState(commandName))return!0;return!1});var result=updateSelectedEvent.call(self);result=!!result,self.changeSelectedState(result)},Menu.fn.changeSelectedState=function(state){var self=this,selected=self.selected;if(null!=state&&"boolean"==typeof state){if(selected===state)return;self.selected=state,state?(self.$domNormal.hide(),self.$domSelected.show()):(self.$domNormal.show(),self.$domSelected.hide())}},Menu.fn.active=function(active){return null==active?this._activeState:void(this._activeState=active)},Menu.fn.activeStyle=function(active){var $dom=(this.selected,this.$domNormal),$domSelected=this.$domSelected;active?($dom.addClass("active"),$domSelected.addClass("active")):($dom.removeClass("active"),$domSelected.removeClass("active")),this.active(active)},Menu.fn.disabled=function(opt){if(null==opt)return!!this._disabled;if(this._disabled!==opt){var $dom=this.$domNormal,$domSelected=this.$domSelected;opt?($dom.addClass("disable"),$domSelected.addClass("disable")):($dom.removeClass("disable"),$domSelected.removeClass("disable")),this._disabled=opt}}}),_e(function(E,$){var DropList=function(editor,menu,opt){this.editor=editor,this.menu=menu,this.data=opt.data,this.tpl=opt.tpl,this.selectorForELemCommand=opt.selectorForELemCommand,this.beforeEvent=opt.beforeEvent,this.afterEvent=opt.afterEvent,this.init()};DropList.fn=DropList.prototype,E.DropList=DropList}),_e(function(E,$){var DropList=E.DropList;DropList.fn.init=function(){var self=this;self.initDOM(),self.bindEvent(),self.initHideEvent()},DropList.fn.initDOM=function(){var itemContent,$item,self=this,data=self.data,tpl=self.tpl||"<span>{#title}</span>",$list=$('<div class="wangEditor-drop-list clearfix"></div>');$.each(data,function(commandValue,title){itemContent=tpl.replace(/{#commandValue}/gi,commandValue).replace(/{#title}/gi,title),$item=$('<a href="#" commandValue="'+commandValue+'"></a>'),$item.append(itemContent),$list.append($item)}),self.$list=$list},DropList.fn.bindEvent=function(){var self=this,editor=self.editor,menu=self.menu,commandName=menu.commandName,selectorForELemCommand=self.selectorForELemCommand,$list=self.$list,beforeEvent=self.beforeEvent,afterEvent=self.afterEvent;$list.on("click","a[commandValue]",function(e){beforeEvent&&"function"==typeof beforeEvent&&beforeEvent.call(e);var commandValue=$(e.currentTarget).attr("commandValue");menu.selected&&editor.isRangeEmpty()&&selectorForELemCommand?editor.commandForElem(selectorForELemCommand,e,commandName,commandValue):editor.command(e,commandName,commandValue),afterEvent&&"function"==typeof afterEvent&&afterEvent.call(e)})},DropList.fn.initHideEvent=function(){var self=this,thisList=self.$list.get(0);E.$body.on("click",function(e){if(self.isShowing){var menuDom,trigger=e.target,menu=self.menu;menuDom=menu.selected?menu.$domSelected.get(0):menu.$domNormal.get(0),menuDom===trigger||$.contains(menuDom,trigger)||thisList===trigger||$.contains(thisList,trigger)||self.hide()}}),E.$window.scroll(function(){self.hide()}),E.$window.on("resize",function(){self.hide()})}}),_e(function(E,$){var DropList=E.DropList;DropList.fn._render=function(){var self=this,editor=self.editor,$list=self.$list;editor.$editorContainer.append($list),self.rendered=!0},DropList.fn._position=function(){var self=this,$list=self.$list,editor=self.editor,menu=self.menu,$menuContainer=editor.menuContainer.$menuContainer,$menuDom=menu.selected?menu.$domSelected:menu.$domNormal,menuPosition=$menuDom.offsetParent().position(),menuTop=menuPosition.top,menuLeft=menuPosition.left,menuHeight=$menuDom.offsetParent().height(),menuWidth=$menuDom.offsetParent().width(),listWidth=$list.outerWidth(),txtWidth=editor.txt.$txt.outerWidth(),top=menuTop+menuHeight,left=menuLeft+menuWidth/2,marginLeft=0-menuWidth/2,valWithTxt=left+listWidth-txtWidth;valWithTxt>-10&&(marginLeft=marginLeft-valWithTxt-10),$list.css({top:top,left:left,"margin-left":marginLeft}),editor._isMenufixed&&(top+=$menuContainer.offset().top+$menuContainer.outerHeight()-$list.offset().top,$list.css({top:top}))},DropList.fn.show=function(){var self=this,menu=self.menu;if(self.rendered||self._render(),!self.isShowing){var $list=self.$list;$list.show(),self._position(),self.isShowing=!0,menu.activeStyle(!0)}},DropList.fn.hide=function(){var self=this,menu=self.menu;if(self.isShowing){var $list=self.$list;$list.hide(),self.isShowing=!1,menu.activeStyle(!1)}}}),_e(function(E,$){var DropPanel=function(editor,menu,opt){this.editor=editor,this.menu=menu,this.$content=opt.$content,this.width=opt.width||200,this.height=opt.height,this.onRender=opt.onRender,this.init()};DropPanel.fn=DropPanel.prototype,E.DropPanel=DropPanel}),_e(function(E,$){var DropPanel=E.DropPanel;DropPanel.fn.init=function(){var self=this;self.initDOM(),self.initHideEvent()},DropPanel.fn.initDOM=function(){var self=this,$content=self.$content,width=self.width,height=self.height,$panel=$('<div class="wangEditor-drop-panel clearfix"></div>'),$triangle=$('<div class="tip-triangle"></div>');$panel.css({width:width,height:height?height:"auto"}),$panel.append($triangle),$panel.append($content),self.$panel=$panel,self.$triangle=$triangle},DropPanel.fn.initHideEvent=function(){var self=this,thisPanle=self.$panel.get(0);E.$body.on("click",function(e){if(self.isShowing){var menuDom,trigger=e.target,menu=self.menu;menuDom=menu.selected?menu.$domSelected.get(0):menu.$domNormal.get(0),menuDom===trigger||$.contains(menuDom,trigger)||thisPanle===trigger||$.contains(thisPanle,trigger)||self.hide()}}),E.$window.scroll(function(e){self.hide()}),E.$window.on("resize",function(){self.hide()})}}),_e(function(E,$){var DropPanel=E.DropPanel;DropPanel.fn._render=function(){var self=this,onRender=self.onRender,editor=self.editor,$panel=self.$panel;editor.$editorContainer.append($panel),onRender&&onRender.call(self),self.rendered=!0},DropPanel.fn._position=function(){var self=this,$panel=self.$panel,$triangle=self.$triangle,editor=self.editor,$menuContainer=editor.menuContainer.$menuContainer,menu=self.menu,$menuDom=menu.selected?menu.$domSelected:menu.$domNormal,menuPosition=$menuDom.offsetParent().position(),menuTop=menuPosition.top,menuLeft=menuPosition.left,menuHeight=$menuDom.offsetParent().height(),menuWidth=$menuDom.offsetParent().width(),panelWidth=$panel.outerWidth(),txtWidth=editor.txt.$txt.outerWidth(),top=menuTop+menuHeight,left=menuLeft+menuWidth/2,marginLeft=0-panelWidth/2,marginLeft2=marginLeft;0-marginLeft>left-10&&(marginLeft=0-(left-10));var valWithTxt=left+panelWidth+marginLeft-txtWidth;valWithTxt>-10&&(marginLeft=marginLeft-valWithTxt-10),$panel.css({top:top,left:left,"margin-left":marginLeft}),editor._isMenufixed&&(top+=$menuContainer.offset().top+$menuContainer.outerHeight()-$panel.offset().top,$panel.css({top:top})),$triangle.css({"margin-left":marginLeft2-marginLeft-5})},DropPanel.fn.focusFirstInput=function(){var self=this,$panel=self.$panel;$panel.find("input[type=text],textarea").each(function(){var $input=$(this);if(null==$input.attr("disabled"))return $input.focus(),!1})},DropPanel.fn.show=function(){var self=this,menu=self.menu;if(self.rendered||self._render(),!self.isShowing){var $panel=self.$panel;$panel.show(),self._position(),self.isShowing=!0,menu.activeStyle(!0),E.w3cRange?self.focusFirstInput():E.placeholderForIE8($panel)}},DropPanel.fn.hide=function(){var self=this,menu=self.menu;if(self.isShowing){var $panel=self.$panel;$panel.hide(),self.isShowing=!1,menu.activeStyle(!1)}}}),_e(function(E,$){var Modal=function(editor,menu,opt){this.editor=editor,this.menu=menu,this.$content=opt.$content,this.init()};Modal.fn=Modal.prototype,E.Modal=Modal}),_e(function(E,$){var Modal=E.Modal;Modal.fn.init=function(){var self=this;self.initDom(),self.initHideEvent()},Modal.fn.initDom=function(){var self=this,$content=self.$content,$modal=$('<div class="wangEditor-modal"></div>'),$close=$('<div class="wangEditor-modal-close"><i class="wangeditor-menu-img-cancel-circle"></i></div>');$modal.append($close),$modal.append($content),self.$modal=$modal,self.$close=$close},Modal.fn.initHideEvent=function(){var self=this,$close=self.$close,modal=self.$modal.get(0);$close.click(function(){self.hide()}),E.$body.on("click",function(e){if(self.isShowing){var menuDom,trigger=e.target,menu=self.menu;menu&&(menuDom=menu.selected?menu.$domSelected.get(0):menu.$domNormal.get(0),menuDom===trigger||$.contains(menuDom,trigger))||modal===trigger||$.contains(modal,trigger)||self.hide()}})}}),_e(function(E,$){var Modal=E.Modal;Modal.fn._render=function(){var self=this,editor=self.editor,$modal=self.$modal;$modal.css("z-index",editor.config.zindex+10+""),E.$body.append($modal),self.rendered=!0},Modal.fn._position=function(){var self=this,$modal=self.$modal,top=$modal.offset().top,width=$modal.outerWidth(),height=$modal.outerHeight(),marginLeft=0-width/2,marginTop=0-height/2,sTop=E.$window.scrollTop();height/2>top&&(marginTop=0-top),$modal.css({"margin-left":marginLeft+"px","margin-top":marginTop+sTop+"px"})},Modal.fn.show=function(){var self=this,menu=self.menu;if(self.rendered||self._render(),!self.isShowing){self.isShowing=!0;var $modal=self.$modal;$modal.show(),self._position(),menu&&menu.activeStyle(!0)}},Modal.fn.hide=function(){var self=this,menu=self.menu;if(self.isShowing){self.isShowing=!1;var $modal=self.$modal;$modal.hide(),menu&&menu.activeStyle(!1)}}}),_e(function(E,$){var Txt=function(editor){this.editor=editor,this.init()};Txt.fn=Txt.prototype,E.Txt=Txt}),_e(function(E,$){var Txt=E.Txt;Txt.fn.init=function(){var $txt,self=this,editor=self.editor,$valueContainer=editor.$valueContainer,currentValue=editor.getInitValue();"DIV"===$valueContainer.get(0).nodeName?($txt=$valueContainer,$txt.addClass("wangEditor-txt"),$txt.attr("contentEditable","true")):$txt=$('<div class="wangEditor-txt" contentEditable="true">'+currentValue+"</div>"),editor.ready(function(){self.insertEmptyP()}),self.$txt=$txt,self.contentEmptyHandle(),self.bindEnterForDiv(),self.bindEnterForText(),self.bindTabEvent(),self.bindPasteFilter(),self.bindFormatText(),self.bindHtml()},Txt.fn.contentEmptyHandle=function(){var $p,self=this,editor=self.editor,$txt=self.$txt;$txt.on("keydown",function(e){if(8===e.keyCode){var txtHtml=$.trim($txt.html().toLowerCase());return"<p><br></p>"===txtHtml?void e.preventDefault():void 0}}),$txt.on("keyup",function(e){if(8===e.keyCode){var txtHtml=$.trim($txt.html().toLowerCase());txtHtml&&"<br>"!==txtHtml||($p=$("<p><br/></p>"),$txt.html(""),$txt.append($p),editor.restoreSelectionByElem($p.get(0)))}})},Txt.fn.bindEnterForDiv=function(){function divHandler(){if($keydownDivElem){var $pElem=$("<p>"+$keydownDivElem.html()+"</p>");$keydownDivElem.after($pElem),$keydownDivElem.remove()}}var $keydownDivElem,self=(E.config.legalTags,this),editor=self.editor,$txt=self.$txt;$txt.on("keydown keyup",function(e){if(13===e.keyCode){var $targetElem,$pElem,rangeElem=editor.getRangeElem(),targetElem=editor.getLegalTags(rangeElem);if(!targetElem){if(targetElem=editor.getSelfOrParentByName(rangeElem,"div"),!targetElem)return;$targetElem=$(targetElem),"keydown"===e.type&&($keydownDivElem=$targetElem,setTimeout(divHandler,0)),"keyup"===e.type&&($pElem=$("<p>"+$targetElem.html()+"</p>"),$targetElem.after($pElem),$targetElem.remove(),editor.restoreSelectionByElem($pElem.get(0),"start"))}}})},Txt.fn.bindEnterForText=function(){var handle,self=this,$txt=self.$txt;$txt.on("keyup",function(e){13===e.keyCode&&(handle||(handle=function(){self.wrapImgAndText()}),setTimeout(handle))})},Txt.fn.bindTabEvent=function(){var self=this,editor=self.editor,$txt=self.$txt;$txt.on("keydown",function(e){9===e.keyCode&&editor.queryCommandSupported("insertHtml")&&editor.command(e,"insertHtml","&nbsp;&nbsp;&nbsp;&nbsp;")})},Txt.fn.bindPasteFilter=function(){function handle(elem){if(elem&&elem.nodeType&&elem.nodeName){var $elem,childNodesClone,nodeName=elem.nodeName.toLowerCase(),nodeType=elem.nodeType;if(3===nodeType||1===nodeType){if($elem=$(elem),"div"===nodeName)return childNodesClone=[],$.each(elem.childNodes,function(index,item){childNodesClone.push(item)}),void $.each(childNodesClone,function(){handle(this)});if(legalTagArr.indexOf(nodeName)>=0)resultHtml+=getResult(elem);else if(3===nodeType)resultHtml+="<p>"+elem.textContent+"</p>";else if("br"===nodeName)resultHtml+="<br/>";else{if(["meta","style","script","object","form","iframe","hr"].indexOf(nodeName)>=0)return;$elem=$(removeAttrs(elem)),resultHtml+=$("<div>").append($elem.clone()).html()}}}}function getResult(elem){var $elem,nodeName=elem.nodeName.toLowerCase(),htmlForP="",htmlForLi="";return["blockquote"].indexOf(nodeName)>=0?($elem=$(elem),"<"+nodeName+">"+$elem.text()+"</"+nodeName+">"):["p","h1","h2","h3","h4","h5"].indexOf(nodeName)>=0?(elem=removeAttrs(elem),$elem=$(elem),htmlForP=$elem.html(),htmlForP=htmlForP.replace(/<.*?>/gi,function(tag){return"</a>"===tag||0===tag.indexOf("<a ")||0===tag.indexOf("<img ")?tag:""}),"<"+nodeName+">"+htmlForP+"</"+nodeName+">"):["ul","ol"].indexOf(nodeName)>=0?($elem=$(elem),$elem.children().each(function(){var $li=$(removeAttrs(this)),html=$li.html();html=html.replace(/<.*?>/gi,function(tag){return"</a>"===tag||0===tag.indexOf("<a ")||0===tag.indexOf("<img ")?tag:""}),htmlForLi+="<li>"+html+"</li>"}),"<"+nodeName+">"+htmlForLi+"</"+nodeName+">"):($elem=$(removeAttrs(elem)),$("<div>").append($elem).html())}function removeAttrs(elem){var attrs=elem.attributes||[],attrNames=[],exception=["href","target","src","alt","rowspan","colspan"];$.each(attrs,function(key,attr){attr&&2===attr.nodeType&&attrNames.push(attr.nodeName)}),$.each(attrNames,function(key,attr){exception.indexOf(attr)<0&&elem.removeAttribute(attr)});var children=elem.childNodes;return children.length&&$.each(children,function(key,value){removeAttrs(value)}),elem}var self=this,editor=self.editor,resultHtml="",$txt=self.$txt,legalTags=editor.config.legalTags,legalTagArr=legalTags.split(",");$txt.on("paste",function(e){if(editor.config.pasteFilter){var currentNodeName=editor.getRangeElem().nodeName;if("TD"!==currentNodeName&&"TH"!==currentNodeName){resultHtml="";var pasteHtml,$paste,data=e.clipboardData||e.originalEvent.clipboardData,ieData=window.clipboardData;
if(editor.config.pasteText){if(data&&data.getData)pasteHtml=data.getData("text/plain");else{if(!ieData||!ieData.getData)return;pasteHtml=ieData.getData("text")}pasteHtml&&(resultHtml="<p>"+pasteHtml+"</p>")}else if(data&&data.getData)pasteHtml=data.getData("text/html"),pasteHtml?($paste=$("<div>"+pasteHtml+"</div>"),handle($paste.get(0))):(pasteHtml=data.getData("text/plain"),pasteHtml&&(pasteHtml=pasteHtml.replace(/[ ]/g,"&nbsp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"</p><p>"),resultHtml="<p>"+pasteHtml+"</p>",resultHtml=resultHtml.replace(/<p>(https?:\/\/.*?)<\/p>/gi,function(match,link){return'<p><a href="'+link+'" target="_blank">'+link+"</p>"})));else{if(!ieData||!ieData.getData)return;if(resultHtml=ieData.getData("text"),!resultHtml)return;resultHtml="<p>"+resultHtml+"</p>",resultHtml=resultHtml.replace(new RegExp("\n","g"),"</p><p>")}resultHtml&&(editor.command(e,"insertHtml",resultHtml),self.clearEmptyOrNestP())}}})},Txt.fn.bindFormatText=function(){var self=this,$txt=(self.editor,self.$txt),legalTags=E.config.legalTags,legalTagArr=legalTags.split(","),regArr=(legalTagArr.length,[]);$.each(legalTagArr,function(k,tag){var reg=">\\s*<("+tag+")>";regArr.push(new RegExp(reg,"ig"))}),regArr.push(new RegExp(">\\s*<(li)>","ig")),regArr.push(new RegExp(">\\s*<(tr)>","ig")),regArr.push(new RegExp(">\\s*<(code)>","ig")),$txt.formatText=function(){var $temp=$("<div>"),html=$txt.html();return html=html.replace(/\s*</gi,"<"),$.each(regArr,function(k,reg){reg.test(html)&&(html=html.replace(reg,function(matchStr,tag){return">\n<"+tag+">"}))}),$temp.html(html),$temp.text()}},Txt.fn.bindHtml=function(){var self=this,editor=self.editor,$txt=self.$txt,$valueContainer=editor.$valueContainer,valueNodeName=editor.valueNodeName;$txt.html=function(html){var result;return"div"===valueNodeName&&(result=$.fn.html.call($txt,html)),void 0===html?(result=$.fn.html.call($txt),result=result.replace(/(href|src)\=\"(.*)\"/gim,function(a,b,c){return b+'="'+c.replace("&amp;","&")+'"'})):(result=$.fn.html.call($txt,html),$valueContainer.val(html)),void 0===html?result:void $txt.change()}}}),_e(function(E,$){var Txt=E.Txt,txtChangeEventNames="propertychange change click keyup input paste";Txt.fn.render=function(){var $txt=this.$txt,$editorContainer=this.editor.$editorContainer;$editorContainer.append($txt)},Txt.fn.initHeight=function(){var editor=this.editor,$txt=this.$txt,valueContainerHeight=editor.$valueContainer.height(),menuHeight=editor.menuContainer.height(),txtHeight=valueContainerHeight-menuHeight;txtHeight=txtHeight<50?50:txtHeight,$txt.height(txtHeight),editor.valueContainerHeight=valueContainerHeight,this.initMaxHeight(txtHeight,menuHeight)},Txt.fn.initMaxHeight=function(txtHeight,menuHeight){var editor=this.editor,$menuContainer=editor.menuContainer.$menuContainer,$txt=this.$txt,$wrap=$("<div>");if(window.getComputedStyle&&"max-height"in window.getComputedStyle($txt.get(0))){var maxHeight=parseInt(editor.$valueContainer.css("max-height"));if(isNaN(maxHeight))return;if(editor.menus.fullscreen)return void E.warn("max-height和『全屏』菜单一起使用时，会有一些问题尚未解决，请暂时不要两个同时使用");editor.useMaxHeight=!0,$wrap.css({"max-height":maxHeight-menuHeight+"px","overflow-y":"auto"}),$txt.css({"height":"auto","overflow-y":"visible","min-height":txtHeight+"px"}),$wrap.on("scroll",function(){$txt.parent().scrollTop()>10?$menuContainer.addClass("wangEditor-menu-shadow"):$menuContainer.removeClass("wangEditor-menu-shadow")}),$txt.wrap($wrap)}},Txt.fn.saveSelectionEvent=function(){function save(){editor.saveSelection()}function saveSync(){Date.now()-dt<100||(dt=Date.now(),save())}function saveAync(){timeoutId&&clearTimeout(timeoutId),timeoutId=setTimeout(save,300)}var timeoutId,$txt=this.$txt,editor=this.editor,dt=Date.now();$txt.on(txtChangeEventNames+" focus blur",function(e){saveSync(),saveAync()}),$txt.on("mousedown",function(){$txt.on("mouseleave.saveSelection",function(e){saveSync(),saveAync(),editor.updateMenuStyle()})}).on("mouseup",function(){$txt.off("mouseleave.saveSelection")})},Txt.fn.updateValueEvent=function(){function doOnchange(){var val=$txt.html();oldValue!==val&&(editor.onchange&&"function"==typeof editor.onchange&&editor.onchange.call(editor),editor.updateValue(),oldValue=val)}var timeoutId,oldValue,$txt=this.$txt,editor=this.editor;$txt.on(txtChangeEventNames,function(e){null==oldValue&&(oldValue=$txt.html()),timeoutId&&clearTimeout(timeoutId),timeoutId=setTimeout(doOnchange,100)})},Txt.fn.updateMenuStyleEvent=function(){var $txt=this.$txt,editor=this.editor;$txt.on(txtChangeEventNames,function(e){editor.updateMenuStyle()})},Txt.fn.insertEmptyP=function(){var $txt=this.$txt,$children=$txt.children();return 0===$children.length?void $txt.append($("<p><br></p>")):void("<br>"!==$.trim($children.last().html()).toLowerCase()&&$txt.append($("<p><br></p>")))},Txt.fn.wrapImgAndText=function(){var i,childNode,$txt=this.$txt,$imgs=$txt.children("img"),txt=$txt[0],childNodes=txt.childNodes,childrenLength=childNodes.length;for($imgs.length&&$imgs.each(function(){$(this).wrap("<p>")}),i=0;i<childrenLength;i++)childNode=childNodes[i],3===childNode.nodeType&&childNode.textContent&&$.trim(childNode.textContent)&&$(childNode).wrap("<p>")},Txt.fn.clearEmptyOrNestP=function(){var $txt=this.$txt,$pList=$txt.find("p");$pList.each(function(){var $firstChild,$p=$(this),$children=$p.children(),childrenLength=$children.length,content=$.trim($p.html());return content?void(1===childrenLength&&($firstChild=$children.first(),$firstChild.get(0)&&"P"===$firstChild.get(0).nodeName&&$p.html($firstChild.html()))):void $p.remove()})},Txt.fn.scrollTop=function(val){var self=this,editor=self.editor,$txt=self.$txt;return editor.useMaxHeight?$txt.parent().scrollTop(val):$txt.scrollTop(val)},Txt.fn.showHeightOnHover=function(){function addAndShowTip($target){isTipInTxt||($editorContainer.append($tip),isTipInTxt=!0);var height=($txt.position().top,$txt.outerHeight(),$target.height()),top=$target.position().top,marginTop=parseInt($target.css("margin-top"),10),paddingTop=parseInt($target.css("padding-top"),10),marginBottom=parseInt($target.css("margin-bottom"),10),paddingBottom=parseInt($target.css("padding-bottom"),10);top+menuContainer.height();$tip.css({height:height+paddingTop+marginTop+paddingBottom+marginBottom,top:top+menuContainer.height()})}function removeTip(){isTipInTxt&&($tip.remove(),isTipInTxt=!1)}var editor=this.editor,$editorContainer=editor.$editorContainer,menuContainer=editor.menuContainer,$txt=this.$txt,$tip=$('<i class="height-tip"><i>'),isTipInTxt=!1;$txt.on("mouseenter","ul,ol,blockquote,p,h1,h2,h3,h4,h5,table,pre",function(e){addAndShowTip($(e.currentTarget))}).on("mouseleave",function(){removeTip()})}}),_e(function(E,$){Array.prototype.indexOf||(Array.prototype.indexOf=function(elem){for(var i=0,length=this.length;i<length;i++)if(this[i]===elem)return i;return-1},Array.prototype.lastIndexOf=function(elem){var length=this.length;for(length-=1;length>=0;length--)if(this[length]===elem)return length;return-1}),Date.now||(Date.now=function(){return(new Date).valueOf()});var console=window.console,emptyFn=function(){};$.each(["info","log","warn","error"],function(key,value){null==console?E[value]=emptyFn:E[value]=function(info){E.config&&E.config.printLog&&console[value]("wangEditor提示: "+info)}}),E.random=function(){return Math.random().toString().slice(2)},E.placeholder="placeholder"in document.createElement("input"),E.placeholderForIE8=function($container){E.placeholder||$container.find("input[placeholder]").each(function(){var $input=$(this),placeholder=$input.attr("placeholder");""===$input.val()&&($input.css("color","#666"),$input.val(placeholder),$input.on("focus.placeholder click.placeholder",function(){$input.val(""),$input.css("color","#333"),$input.off("focus.placeholder click.placeholder")}))})}}),_e(function(E,$){E.langs={},E.langs["zh-cn"]={bold:"粗体",underline:"下划线",italic:"斜体",forecolor:"文字颜色",bgcolor:"背景色",strikethrough:"删除线",eraser:"清空格式",source:"源码",quote:"引用",fontfamily:"字体",fontsize:"字号",head:"标题",orderlist:"有序列表",unorderlist:"无序列表",alignleft:"左对齐",aligncenter:"居中",alignright:"右对齐",link:"链接",text:"文本",submit:"提交",cancel:"取消",unlink:"取消链接",table:"表格",emotion:"表情",img:"图片",video:"视频","width":"宽","height":"高",location:"位置",loading:"加载中",searchlocation:"搜索位置",dynamicMap:"动态地图",clearLocation:"清除位置",langDynamicOneLocation:"动态地图只能显示一个位置",insertcode:"插入代码",undo:"撤销",redo:"重复",fullscreen:"全屏",openLink:"打开链接"},E.langs.en={bold:"Bold",underline:"Underline",italic:"Italic",forecolor:"Color",bgcolor:"Backcolor",strikethrough:"Strikethrough",eraser:"Eraser",source:"Codeview",quote:"Quote",fontfamily:"Font family",fontsize:"Font size",head:"Head",orderlist:"Ordered list",unorderlist:"Unordered list",alignleft:"Align left",aligncenter:"Align center",alignright:"Align right",link:"Insert link",text:"Text",submit:"Submit",cancel:"Cancel",unlink:"Unlink",table:"Table",emotion:"Emotions",img:"Image",video:"Video","width":"width","height":"height",location:"Location",loading:"Loading",searchlocation:"search",dynamicMap:"Dynamic",clearLocation:"Clear",langDynamicOneLocation:"Only one location in dynamic map",insertcode:"Insert Code",undo:"Undo",redo:"Redo",fullscreen:"Full screnn",openLink:"open link"}}),_e(function(E,$){E.config={},E.config.zindex=1e4,E.config.printLog=!0,E.config.menuFixed=0,E.config.jsFilter=!0,E.config.legalTags="p,h1,h2,h3,h4,h5,h6,blockquote,table,ul,ol,pre",E.config.lang=E.langs["zh-cn"],E.config.menus=["source","|","bold","underline","italic","strikethrough","eraser","forecolor","bgcolor","|","quote","fontfamily","fontsize","head","unorderlist","orderlist","alignleft","aligncenter","alignright","|","link","unlink","table","emotion","|","img","video","location","insertcode","|","undo","redo","fullscreen"],E.config.colors={"#880000":"暗红色","#800080":"紫色","#ff0000":"红色","#ff00ff":"鲜粉色","#000080":"深蓝色","#0000ff":"蓝色","#00ffff":"湖蓝色","#008080":"蓝绿色","#008000":"绿色","#808000":"橄榄色","#00ff00":"浅绿色","#ffcc00":"橙黄色","#808080":"灰色","#c0c0c0":"银色","#000000":"黑色","#ffffff":"白色"},E.config.familys=["宋体","黑体","楷体","微软雅黑","Arial","Verdana","Georgia","Times New Roman","Microsoft JhengHei","Trebuchet MS","Courier New","Impact","Comic Sans MS","Consolas"],E.config.fontsizes={1:"12px",2:"13px",3:"16px",4:"18px",5:"24px",6:"32px",7:"48px"},E.config.emotionsShow="icon",E.config.emotions={"weibo":{title:"微博表情",data:[{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/7a/shenshou_thumb.gif",value:"[草泥马]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/60/horse2_thumb.gif",value:"[神马]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/bc/fuyun_thumb.gif",value:"[浮云]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/c9/geili_thumb.gif",value:"[给力]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/f2/wg_thumb.gif",value:"[围观]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/70/vw_thumb.gif",value:"[威武]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/6e/panda_thumb.gif",value:"[熊猫]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/81/rabbit_thumb.gif",value:"[兔子]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/bc/otm_thumb.gif",value:"[奥特曼]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/15/j_thumb.gif",value:"[囧]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/89/hufen_thumb.gif",value:"[互粉]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/c4/liwu_thumb.gif",value:"[礼物]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/ac/smilea_thumb.gif",value:"[呵呵]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/0b/tootha_thumb.gif",value:"[哈哈]"}]}},E.config.mapAk="TVhjYjq1ICT2qqL5LdS8mwas",E.config.uploadImgUrl="",E.config.uploadTimeout=2e4,E.config.uploadImgFns={},E.config.customUpload=!1,E.config.uploadParams={},E.config.uploadHeaders={},E.config.hideLinkImg=!1,E.config.pasteFilter=!0,E.config.pasteText=!1,E.config.codeDefaultLang="javascript"}),_e(function(E,$){E.UI={},E.UI.menus={"default":{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-command"></i></a>',selected:".selected"},bold:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-bold"></i></a>',selected:".selected"},underline:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-underline"></i></a>',selected:".selected"},italic:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-italic"></i></a>',selected:".selected"},forecolor:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-pencil"></i></a>',selected:".selected"},bgcolor:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-brush"></i></a>',selected:".selected"},strikethrough:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-strikethrough"></i></a>',selected:".selected"},eraser:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-eraser"></i></a>',selected:".selected"},quote:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-quotes-left"></i></a>',selected:".selected"},source:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-code"></i></a>',selected:".selected"},fontfamily:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-font2"></i></a>',selected:".selected"},fontsize:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-text-height"></i></a>',selected:".selected"},head:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-header"></i></a>',selected:".selected"},orderlist:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-list-numbered"></i></a>',selected:".selected"},unorderlist:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-list-bullet"></i></a>',selected:".selected"},alignleft:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-align-left"></i></a>',selected:".selected"},aligncenter:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-align-center"></i></a>',selected:".selected"},alignright:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-align-right"></i></a>',selected:".selected"},link:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-link"></i></a>',selected:".selected"},unlink:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-unlink"></i></a>',selected:".selected"},table:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-table"></i></a>',selected:".selected"},emotion:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-happy"></i></a>',selected:".selected"},img:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-picture"></i></a>',selected:".selected"},video:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-play"></i></a>',selected:".selected"},location:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-location"></i></a>',selected:".selected"},insertcode:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-terminal"></i></a>',selected:".selected"},undo:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-ccw"></i></a>',selected:".selected"},redo:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-cw"></i></a>',selected:".selected"},fullscreen:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-enlarge2"></i></a>',selected:'<a href="#" tabindex="-1" class="selected"><i class="wangeditor-menu-img-shrink2"></i></a>'}}}),_e(function(E,$){E.fn.initDefaultConfig=function(){var editor=this;editor.config=$.extend({},E.config),editor.UI=$.extend({},E.UI)}}),_e(function(E,$){E.fn.addEditorContainer=function(){this.$editorContainer=$('<div class="wangEditor-container"></div>')}}),_e(function(E,$){E.fn.addTxt=function(){var editor=this,txt=new E.Txt(editor);editor.txt=txt}}),_e(function(E,$){E.fn.addMenuContainer=function(){var editor=this;editor.menuContainer=new E.MenuContainer(editor)}}),_e(function(E,$){E.createMenuFns=[],E.createMenu=function(fn){E.createMenuFns.push(fn)},E.fn.addMenus=function(){function check(menuId){return menuIds.indexOf(menuId)>=0}var editor=this,menuIds=editor.config.menus;$.each(E.createMenuFns,function(k,createMenuFn){createMenuFn.call(editor,check)})}}),_e(function(E,$){E.createMenu(function(check){var menuId="bold";if(check(menuId)){var editor=this,lang=editor.config.lang,menu=new E.Menu({editor:editor,id:menuId,title:lang.bold,commandName:"Bold"});menu.clickEventSelected=function(e){var isRangeEmpty=editor.isRangeEmpty();isRangeEmpty?editor.commandForElem("b,strong,h1,h2,h3,h4,h5",e,"Bold"):editor.command(e,"Bold")},editor.menus[menuId]=menu}})}),_e(function(E,$){E.createMenu(function(check){var menuId="underline";if(check(menuId)){var editor=this,lang=editor.config.lang,menu=new E.Menu({editor:editor,id:menuId,title:lang.underline,commandName:"Underline"});menu.clickEventSelected=function(e){var isRangeEmpty=editor.isRangeEmpty();isRangeEmpty?editor.commandForElem("u,a",e,"Underline"):editor.command(e,"Underline")},editor.menus[menuId]=menu}})}),_e(function(E,$){E.createMenu(function(check){var menuId="italic";if(check(menuId)){var editor=this,lang=editor.config.lang,menu=new E.Menu({editor:editor,id:menuId,title:lang.italic,commandName:"Italic"});menu.clickEventSelected=function(e){var isRangeEmpty=editor.isRangeEmpty();isRangeEmpty?editor.commandForElem("i",e,"Italic"):editor.command(e,"Italic")},editor.menus[menuId]=menu}})}),_e(function(E,$){E.createMenu(function(check){var menuId="forecolor";if(check(menuId)){var editor=this,lang=editor.config.lang,configColors=editor.config.colors,menu=new E.Menu({editor:editor,id:menuId,title:lang.forecolor}),$content=$("<div></div>");$.each(configColors,function(k,v){$content.append(['<a href="#" class="color-item"','    title="'+v+'" commandValue="'+k+'" ','    style="color: '+k+'" ','><i class="wangeditor-menu-img-pencil"></i></a>'].join(""))}),$content.on("click","a[commandValue]",function(e){var $elem=$(this),commandValue=$elem.attr("commandValue");menu.selected&&editor.isRangeEmpty()?editor.commandForElem("font[color]",e,"forecolor",commandValue):editor.command(e,"forecolor",commandValue)}),menu.dropPanel=new E.DropPanel(editor,menu,{$content:$content,width:125}),menu.updateSelectedEvent=function(){var rangeElem=editor.getRangeElem();return rangeElem=editor.getSelfOrParentByName(rangeElem,"font[color]"),!!rangeElem},editor.menus[menuId]=menu}})}),_e(function(E,$){E.createMenu(function(check){function checkElemFn(elem){var cssText;return!!(elem&&elem.style&&null!=elem.style.cssText&&(cssText=elem.style.cssText,cssText&&cssText.indexOf("background-color:")>=0))}var menuId="bgcolor";if(check(menuId)){var editor=this,lang=editor.config.lang,configColors=editor.config.colors,menu=new E.Menu({editor:editor,id:menuId,title:lang.bgcolor}),$content=$("<div></div>");$.each(configColors,function(k,v){$content.append(['<a href="#" class="color-item"','    title="'+v+'" commandValue="'+k+'" ','    style="color: '+k+'" ','><i class="wangeditor-menu-img-brush"></i></a>'].join(""))}),$content.on("click","a[commandValue]",function(e){var $elem=$(this),commandValue=$elem.attr("commandValue");menu.selected&&editor.isRangeEmpty()?editor.commandForElem({selector:"span,font",check:checkElemFn},e,"BackColor",commandValue):editor.command(e,"BackColor",commandValue)}),menu.dropPanel=new E.DropPanel(editor,menu,{$content:$content,width:125}),menu.updateSelectedEvent=function(){var rangeElem=editor.getRangeElem();return rangeElem=editor.getSelfOrParentByName(rangeElem,"span,font",checkElemFn),!!rangeElem},editor.menus[menuId]=menu}})}),_e(function(E,$){E.createMenu(function(check){var menuId="strikethrough";if(check(menuId)){var editor=this,lang=editor.config.lang,menu=new E.Menu({editor:editor,id:menuId,title:lang.strikethrough,commandName:"StrikeThrough"});menu.clickEventSelected=function(e){var isRangeEmpty=editor.isRangeEmpty();isRangeEmpty?editor.commandForElem("strike",e,"StrikeThrough"):editor.command(e,"StrikeThrough")},editor.menus[menuId]=menu}})}),_e(function(E,$){E.createMenu(function(check){var menuId="eraser";if(check(menuId)){var editor=this,lang=editor.config.lang,menu=new E.Menu({editor:editor,id:menuId,title:lang.eraser,commandName:"RemoveFormat"});menu.clickEvent=function(e){function commandFn(){var rangeElem,pElem,$pElem,quoteElem,$quoteElem,listElem,$listElem,editor=this;rangeElem=editor.getRangeElem(),quoteElem=editor.getSelfOrParentByName(rangeElem,"blockquote"),quoteElem&&($quoteElem=$(quoteElem),$clearElem=$("<p>"+$quoteElem.text()+"</p>"),$quoteElem.after($clearElem).remove()),pElem=editor.getSelfOrParentByName(rangeElem,"p,h1,h2,h3,h4,h5"),pElem&&($pElem=$(pElem),$clearElem=$("<p>"+$pElem.text()+"</p>"),$pElem.after($clearElem).remove()),listElem=editor.getSelfOrParentByName(rangeElem,"ul,ol"),listElem&&($listElem=$(listElem),$clearElem=$("<p>"+$listElem.text()+"</p>"),$listElem.after($clearElem).remove())}function callback(){var editor=this;$clearElem&&editor.restoreSelectionByElem($clearElem.get(0))}var isRangeEmpty=editor.isRangeEmpty();if(!isRangeEmpty)return void editor.command(e,"RemoveFormat");var $clearElem;editor.customCommand(e,commandFn,callback)},editor.menus[menuId]=menu}})}),_e(function(E,$){E.createMenu(function(check){function updateValue(){var $code=menu.$codeTextarea,$txt=editor.txt.$txt,value=$.trim($code.val());value||(value="<p><br></p>"),editor.config.jsFilter&&(value=value.replace(/<script[\s\S]*?<\/script>/gi,"")),$txt.html(value)}var menuId="source";if(check(menuId)){var txtHtml,editor=this,lang=editor.config.lang,menu=new E.Menu({editor:editor,id:menuId,title:lang.source});menu.isShowCode=!1,menu.clickEvent=function(e){var self=this,editor=self.editor,$txt=editor.txt.$txt,txtOuterHeight=$txt.outerHeight(),txtHeight=$txt.height();self.$codeTextarea||(self.$codeTextarea=$('<textarea class="code-textarea"></textarea>'));var $code=self.$codeTextarea;$code.css({height:txtHeight,"margin-top":txtOuterHeight-txtHeight}),$code.val($txt.html()),$txt.after($code).hide(),$code.show(),menu.isShowCode=!0,this.updateSelected(),editor.disableMenusExcept("source"),txtHtml=$txt.html()},menu.clickEventSelected=function(e){var self=this,editor=self.editor,$txt=editor.txt.$txt,$code=self.$codeTextarea;$code&&(updateValue(),$code.after($txt).hide(),$txt.show(),menu.isShowCode=!1,this.updateSelected(),editor.enableMenusExcept("source"),$txt.html()!==txtHtml&&editor.onchange&&"function"==typeof editor.onchange&&editor.onchange.call(editor))},menu.updateSelectedEvent=function(){return this.isShowCode},editor.menus[menuId]=menu}})}),_e(function(E,$){E.createMenu(function(check){var menuId="quote";if(check(menuId)){var editor=this,lang=editor.config.lang,menu=new E.Menu({editor:editor,id:menuId,title:lang.quote,commandName:"formatBlock",commandValue:"blockquote"});menu.clickEvent=function(e){function commandFn(){$quote=$("<p>"+$rangeElem.text()+"</p>"),$rangeElem.after($quote).remove(),$quote.wrap("<blockquote>")}function callback(){var editor=this;$quote&&editor.restoreSelectionByElem($quote.get(0))}var $rangeElem,rangeElem=editor.getRangeElem();if(!rangeElem)return void e.preventDefault();var $quote,currentQuote=editor.getSelfOrParentByName(rangeElem,"blockquote");return currentQuote?void e.preventDefault():(rangeElem=editor.getLegalTags(rangeElem),$rangeElem=$(rangeElem),$rangeElem.text()?rangeElem?void editor.customCommand(e,commandFn,callback):void editor.command(e,"formatBlock","blockquote"):void 0)},menu.clickEventSelected=function(e){function commandFn(){var $quoteElem,$children;if($quoteElem=$(quoteElem),$children=$quoteElem.children(),$children.length)return $children.each(function(k){var $item=$(this);"P"===$item.get(0).nodeName?$quoteElem.after($item):$quoteElem.after("<p>"+$item.text()+"</p>"),$lastChild=$item}),void $quoteElem.remove()}function callback(){var editor=this;$lastChild&&editor.restoreSelectionByElem($lastChild.get(0))}var rangeElem,quoteElem,$lastChild;return rangeElem=editor.getRangeElem(),(quoteElem=editor.getSelfOrParentByName(rangeElem,"blockquote"))?void editor.customCommand(e,commandFn,callback):void e.preventDefault()},menu.updateSelectedEvent=function(){var rangeElem,self=this,editor=self.editor;return rangeElem=editor.getRangeElem(),rangeElem=editor.getSelfOrParentByName(rangeElem,"blockquote"),!!rangeElem},editor.menus[menuId]=menu,editor.ready(function(){var editor=this,$txt=editor.txt.$txt,isPrevEnter=!1;$txt.on("keydown",function(e){if(13!==e.keyCode)return void(isPrevEnter=!1);var rangeElem=editor.getRangeElem();if(rangeElem=editor.getSelfOrParentByName(rangeElem,"blockquote"),!rangeElem)return void(isPrevEnter=!1);if(!isPrevEnter)return void(isPrevEnter=!0);var currentRangeElem=editor.getRangeElem(),$currentRangeElem=$(currentRangeElem);$currentRangeElem.length&&$currentRangeElem.parent().after($currentRangeElem),editor.restoreSelectionByElem(currentRangeElem,"start"),isPrevEnter=!1,e.preventDefault()})}),editor.ready(function(){function commandFn(){$rangeElem&&$rangeElem.remove()}function callback(){if($rangeElem){var $prev=$rangeElem.prev();$prev.length?editor.restoreSelectionByElem($prev.get(0)):editor.initSelection()}}var $rangeElem,editor=this,$txt=editor.txt.$txt;$txt.on("keydown",function(e){if(8===e.keyCode){var rangeElem=editor.getRangeElem();if(rangeElem=editor.getSelfOrParentByName(rangeElem,"blockquote")){$rangeElem=$(rangeElem);var text=$rangeElem.text();text||editor.customCommand(e,commandFn,callback)}}})})}})}),_e(function(E,$){E.createMenu(function(check){var menuId="fontfamily";if(check(menuId)){var editor=this,lang=editor.config.lang,configFamilys=editor.config.familys,menu=new E.Menu({editor:editor,id:menuId,title:lang.fontfamily,commandName:"fontName"}),data={};$.each(configFamilys,function(k,v){data[v]=v});var tpl='<span style="font-family:{#commandValue};">{#title}</span>';menu.dropList=new E.DropList(editor,menu,{data:data,tpl:tpl,selectorForELemCommand:"font[face]"}),menu.updateSelectedEvent=function(){var rangeElem=editor.getRangeElem();return rangeElem=editor.getSelfOrParentByName(rangeElem,"font[face]"),!!rangeElem},editor.menus[menuId]=menu}})}),_e(function(E,$){E.createMenu(function(check){var menuId="fontsize";if(check(menuId)){var editor=this,lang=editor.config.lang,configSize=editor.config.fontsizes,menu=new E.Menu({editor:editor,id:menuId,title:lang.fontsize,commandName:"fontSize"}),data=configSize,tpl='<span style="font-size:{#title};">{#title}</span>';menu.dropList=new E.DropList(editor,menu,{data:data,tpl:tpl,selectorForELemCommand:"font[size]"}),menu.updateSelectedEvent=function(){var rangeElem=editor.getRangeElem();return rangeElem=editor.getSelfOrParentByName(rangeElem,"font[size]"),!!rangeElem},editor.menus[menuId]=menu}})}),_e(function(E,$){E.createMenu(function(check){function beforeEvent(e){editor.queryCommandState("InsertOrderedList")?(isOrderedList=!0,editor.command(e,"InsertOrderedList")):isOrderedList=!1}function afterEvent(e){isOrderedList&&editor.command(e,"InsertOrderedList")}var menuId="head";if(check(menuId)){var isOrderedList,editor=this,lang=editor.config.lang,menu=new E.Menu({editor:editor,id:menuId,title:lang.head,commandName:"formatBlock"}),data={"<h1>":"标题1","<h2>":"标题2","<h3>":"标题3","<h4>":"标题4","<h5>":"标题5"},tpl="{#commandValue}{#title}";menu.dropList=new E.DropList(editor,menu,{data:data,tpl:tpl,beforeEvent:beforeEvent,afterEvent:afterEvent}),menu.updateSelectedEvent=function(){var rangeElem=editor.getRangeElem();return rangeElem=editor.getSelfOrParentByName(rangeElem,"h1,h2,h3,h4,h5"),!!rangeElem},editor.menus[menuId]=menu}})}),_e(function(E,$){E.createMenu(function(check){var menuId="unorderlist";if(check(menuId)){var editor=this,lang=editor.config.lang,menu=new E.Menu({editor:editor,id:menuId,title:lang.unorderlist,commandName:"InsertUnorderedList"});editor.menus[menuId]=menu}})}),_e(function(E,$){E.createMenu(function(check){var menuId="orderlist";if(check(menuId)){var editor=this,lang=editor.config.lang,menu=new E.Menu({editor:editor,id:menuId,title:lang.orderlist,commandName:"InsertOrderedList"});editor.menus[menuId]=menu}})}),_e(function(E,$){E.createMenu(function(check){var menuId="alignleft";if(check(menuId)){var editor=this,lang=editor.config.lang,menu=new E.Menu({editor:editor,id:menuId,title:lang.alignleft,commandName:"JustifyLeft"});menu.updateSelectedEvent=function(){var rangeElem=editor.getRangeElem();return rangeElem=editor.getSelfOrParentByName(rangeElem,"p,h1,h2,h3,h4,h5,li",function(elem){var cssText;return!!(elem&&elem.style&&null!=elem.style.cssText&&(cssText=elem.style.cssText,cssText&&/text-align:\s*left;/.test(cssText)))||"left"===$(elem).attr("align")}),!!rangeElem},editor.menus[menuId]=menu}})}),_e(function(E,$){E.createMenu(function(check){var menuId="aligncenter";if(check(menuId)){var editor=this,lang=editor.config.lang,menu=new E.Menu({editor:editor,id:menuId,title:lang.aligncenter,commandName:"JustifyCenter"});menu.updateSelectedEvent=function(){var rangeElem=editor.getRangeElem();return rangeElem=editor.getSelfOrParentByName(rangeElem,"p,h1,h2,h3,h4,h5,li",function(elem){var cssText;return!!(elem&&elem.style&&null!=elem.style.cssText&&(cssText=elem.style.cssText,cssText&&/text-align:\s*center;/.test(cssText)))||"center"===$(elem).attr("align")}),!!rangeElem},editor.menus[menuId]=menu}})}),_e(function(E,$){E.createMenu(function(check){var menuId="alignright";if(check(menuId)){var editor=this,lang=editor.config.lang,menu=new E.Menu({editor:editor,id:menuId,title:lang.alignright,commandName:"JustifyRight"});menu.updateSelectedEvent=function(){var rangeElem=editor.getRangeElem();return rangeElem=editor.getSelfOrParentByName(rangeElem,"p,h1,h2,h3,h4,h5,li",function(elem){var cssText;return!!(elem&&elem.style&&null!=elem.style.cssText&&(cssText=elem.style.cssText,cssText&&/text-align:\s*right;/.test(cssText)))||"right"===$(elem).attr("align")}),!!rangeElem},editor.menus[menuId]=menu}})}),_e(function(E,$){E.createMenu(function(check){var menuId="link";if(check(menuId)){var editor=this,lang=editor.config.lang,menu=new E.Menu({editor:editor,id:menuId,title:lang.link}),$content=$("<div></div>"),$div1=$('<div style="margin:20px 10px;" class="clearfix"></div>'),$div2=$div1.clone(),$div3=$div1.clone().css("margin","0 10px"),$textInput=$('<input type="text" class="block" placeholder="'+lang.text+'"/>'),$urlInput=$('<input type="text" class="block" placeholder="'+lang.link+'"/>'),$btnSubmit=$('<button class="right">'+lang.submit+"</button>"),$btnCancel=$('<button class="right gray">'+lang.cancel+"</button>");$div1.append($textInput),$div2.append($urlInput),$div3.append($btnSubmit).append($btnCancel),$content.append($div1).append($div2).append($div3),menu.dropPanel=new E.DropPanel(editor,menu,{$content:$content,width:300}),menu.clickEvent=function(e){var menu=this,dropPanel=menu.dropPanel;if(dropPanel.isShowing)return void dropPanel.hide();$textInput.val(""),$urlInput.val("http://");var url="",rangeElem=editor.getRangeElem();rangeElem=editor.getSelfOrParentByName(rangeElem,"a"),rangeElem&&(url=rangeElem.href||"");var text="",isRangeEmpty=editor.isRangeEmpty();isRangeEmpty?rangeElem&&(text=rangeElem.textContent||rangeElem.innerHTML):text=editor.getRangeText()||"",url&&$urlInput.val(url),text&&$textInput.val(text),isRangeEmpty?$textInput.removeAttr("disabled"):$textInput.attr("disabled",!0),dropPanel.show()},menu.updateSelectedEvent=function(){var rangeElem=editor.getRangeElem();return rangeElem=editor.getSelfOrParentByName(rangeElem,"a"),!!rangeElem},$btnCancel.click(function(e){e.preventDefault(),menu.dropPanel.hide()}),$btnSubmit.click(function(e){e.preventDefault();var $linkElem,linkHtml,commandFn,callback,$oldLinks,$newLinks,rangeElem=editor.getRangeElem(),targetElem=editor.getSelfOrParentByName(rangeElem,"a"),isRangeEmpty=editor.isRangeEmpty(),$txt=editor.txt.$txt,uniqId="link"+E.random(),url=$.trim($urlInput.val()),text=$.trim($textInput.val());
return url?(text||(text=url),void(isRangeEmpty?targetElem?($linkElem=$(targetElem),commandFn=function(){$linkElem.attr("href",url),$linkElem.text(text)},callback=function(){var editor=this;editor.restoreSelectionByElem(targetElem)},editor.customCommand(e,commandFn,callback)):(linkHtml='<a href="'+url+'" target="_blank">'+text+"</a>",E.userAgent.indexOf("Firefox")>0&&(linkHtml+="<span>&nbsp;</span>"),editor.command(e,"insertHtml",linkHtml)):($oldLinks=$txt.find("a"),$oldLinks.attr(uniqId,"1"),editor.command(e,"createLink",url),$newLinks=$txt.find("a").not("["+uniqId+"]"),$newLinks.attr("target","_blank"),$oldLinks.removeAttr(uniqId)))):void menu.dropPanel.focusFirstInput()}),editor.menus[menuId]=menu}})}),_e(function(E,$){E.createMenu(function(check){var menuId="unlink";if(check(menuId)){var editor=this,lang=editor.config.lang,menu=new E.Menu({editor:editor,id:menuId,title:lang.unlink,commandName:"unLink"});menu.clickEvent=function(e){function commandFn(){$a.after($span).remove()}function callback(){editor.restoreSelectionByElem($span.get(0))}var isRangeEmpty=editor.isRangeEmpty();if(!isRangeEmpty)return void editor.command(e,"unLink");var rangeElem=editor.getRangeElem(),aElem=editor.getSelfOrParentByName(rangeElem,"a");if(!aElem)return void e.preventDefault();var $a=$(aElem),$span=$("<span>"+$a.text()+"</span>");editor.customCommand(e,commandFn,callback)},editor.menus[menuId]=menu}})}),_e(function(E,$){E.createMenu(function(check){var menuId="table";if(check(menuId)){var $tr,i,j,editor=this,lang=editor.config.lang,menu=new E.Menu({editor:editor,id:menuId,title:lang.table}),$content=$('<div style="font-size: 14px; color: #666; text-align:right;"></div>'),$table=$('<table class="choose-table" style="margin-bottom:10px;margin-top:5px;">'),$row=$("<span>0</span>"),$rowspan=$("<span> 行 </span>"),$col=$("<span>0</span>"),$colspan=$("<span> 列</span>");for(i=0;i<15;i++){for($tr=$('<tr index="'+(i+1)+'">'),j=0;j<20;j++)$tr.append($('<td index="'+(j+1)+'">'));$table.append($tr)}$content.append($table),$content.append($row).append($rowspan).append($col).append($colspan),$table.on("mouseenter","td",function(e){var $currentTd=$(e.currentTarget),currentTdIndex=$currentTd.attr("index"),$currentTr=$currentTd.parent(),currentTrIndex=$currentTr.attr("index");$row.text(currentTrIndex),$col.text(currentTdIndex),$table.find("tr").each(function(){var $tr=$(this),trIndex=$tr.attr("index");parseInt(trIndex,10)<=parseInt(currentTrIndex,10)?$tr.find("td").each(function(){var $td=$(this),tdIndex=$td.attr("index");parseInt(tdIndex,10)<=parseInt(currentTdIndex,10)?$td.addClass("active"):$td.removeClass("active")}):$tr.find("td").removeClass("active")})}).on("mouseleave",function(e){$table.find("td").removeClass("active"),$row.text(0),$col.text(0)}),$table.on("click","td",function(e){var i,j,$currentTd=$(e.currentTarget),currentTdIndex=$currentTd.attr("index"),$currentTr=$currentTd.parent(),currentTrIndex=$currentTr.attr("index"),rownum=parseInt(currentTrIndex,10),colnum=parseInt(currentTdIndex,10),tableHtml="<table>";for(i=0;i<rownum;i++){for(tableHtml+="<tr>",j=0;j<colnum;j++)tableHtml+="<td><span>&nbsp;</span></td>";tableHtml+="</tr>"}tableHtml+="</table>",editor.command(e,"insertHtml",tableHtml)}),menu.dropPanel=new E.DropPanel(editor,menu,{$content:$content,width:262}),editor.menus[menuId]=menu}})}),_e(function(E,$){E.createMenu(function(check){function insertEmotionImgs(data,$tabContent){$.each(data,function(k,emotion){var src=emotion.icon||emotion.url,value=emotion.value||emotion.title,commandValue="icon"===emotionsShow?src:value,$command=$('<a href="#" commandValue="'+commandValue+'"></a>'),$img=$("<img>");$img.attr("_src",src),$command.append($img),$tabContent.append($command),editor.emotionUrls.push(src)})}var menuId="emotion";if(check(menuId)){var editor=this,config=editor.config,lang=config.lang,configEmotions=config.emotions,emotionsShow=config.emotionsShow;editor.emotionUrls=[];var menu=new E.Menu({editor:editor,id:menuId,title:lang.emotion}),$panelContent=$('<div class="panel-tab"></div>'),$tabContainer=$('<div class="tab-container"></div>'),$contentContainer=$('<div class="content-container emotion-content-container"></div>');$.each(configEmotions,function(k,emotion){var title=emotion.title,data=emotion.data;E.log("正在处理 "+title+" 表情的数据...");var $tab=$('<a href="#">'+title+" </a>");$tabContainer.append($tab);var $tabContent=$('<div class="content"></div>');if($contentContainer.append($tabContent),$tab.click(function(e){$tabContainer.children().removeClass("selected"),$contentContainer.children().removeClass("selected"),$tabContent.addClass("selected"),$tab.addClass("selected"),e.preventDefault()}),"string"==typeof data)E.log("将通过 "+data+" 地址ajax下载表情包"),$.get(data,function(result){result=$.parseJSON(result),E.log("下载完毕，得到 "+result.length+" 个表情"),insertEmotionImgs(result,$tabContent)});else{if(!(Object.prototype.toString.call(data).toLowerCase().indexOf("array")>0))return void E.error("data 数据格式错误，请修改为正确格式，参考文档："+E.docsite);insertEmotionImgs(data,$tabContent)}}),$panelContent.append($tabContainer).append($contentContainer),$tabContainer.children().first().addClass("selected"),$contentContainer.children().first().addClass("selected"),$contentContainer.on("click","a[commandValue]",function(e){var $a=$(e.currentTarget),commandValue=$a.attr("commandValue");"icon"===emotionsShow?editor.command(e,"InsertImage",commandValue):editor.command(e,"insertHtml","<span>"+commandValue+"</span>"),e.preventDefault()}),menu.dropPanel=new E.DropPanel(editor,menu,{$content:$panelContent,width:350}),menu.clickEvent=function(e){var menu=this,dropPanel=menu.dropPanel;return dropPanel.isShowing?void dropPanel.hide():(dropPanel.show(),void(menu.imgLoaded||($contentContainer.find("img").each(function(){var $img=$(this),_src=$img.attr("_src");$img.on("error",function(){E.error("加载不出表情图片 "+_src)}),$img.attr("src",_src),$img.removeAttr("_src")}),menu.imgLoaded=!0)))},editor.menus[menuId]=menu}})}),_e(function(E,$){function linkContentHandler(editor,menu,$linkContent){function callback(){$urlInput.val("")}var lang=editor.config.lang,$urlContainer=$('<div style="margin:20px 10px 10px 10px;"></div>'),$urlInput=$('<input type="text" class="block" placeholder="http://"/>');$urlContainer.append($urlInput);var $btnSubmit=$('<button class="right">'+lang.submit+"</button>"),$btnCancel=$('<button class="right gray">'+lang.cancel+"</button>");$linkContent.append($urlContainer).append($btnSubmit).append($btnCancel),$btnCancel.click(function(e){e.preventDefault(),menu.dropPanel.hide()}),$btnSubmit.click(function(e){e.preventDefault();var url=$.trim($urlInput.val());if(!url)return void $urlInput.focus();var imgHtml='<img style="max-width:100%;" src="'+url+'"/>';editor.command(e,"insertHtml",imgHtml,callback)})}E.createMenu(function(check){function tabToggle(){$uploadTab.click(function(e){$tabContainer.children().removeClass("selected"),$contentContainer.children().removeClass("selected"),$uploadContent.addClass("selected"),$uploadTab.addClass("selected"),e.preventDefault()}),$linkTab.click(function(e){$tabContainer.children().removeClass("selected"),$contentContainer.children().removeClass("selected"),$linkContent.addClass("selected"),$linkTab.addClass("selected"),e.preventDefault(),E.placeholder&&$linkContent.find("input[type=text]").focus()}),$uploadTab.click()}function hideUploadImg(){$tabContainer.remove(),$uploadContent.remove(),$linkContent.addClass("selected")}function hideLinkImg(){$tabContainer.remove(),$linkContent.remove(),$uploadContent.addClass("selected")}var menuId="img";if(check(menuId)){var editor=this,lang=editor.config.lang,menu=new E.Menu({editor:editor,id:menuId,title:lang.img}),$panelContent=$('<div class="panel-tab"></div>'),$tabContainer=$('<div class="tab-container"></div>'),$contentContainer=$('<div class="content-container"></div>');$panelContent.append($tabContainer).append($contentContainer);var $uploadTab=$('<a href="#">上传图片</a>'),$linkTab=$('<a href="#">网络图片</a>');$tabContainer.append($uploadTab).append($linkTab);var $uploadContent=$('<div class="content"></div>');$contentContainer.append($uploadContent);var $linkContent=$('<div class="content"></div>');$contentContainer.append($linkContent),linkContentHandler(editor,menu,$linkContent),menu.dropPanel=new E.DropPanel(editor,menu,{$content:$panelContent,width:400,onRender:function(){var init=editor.config.customUploadInit;init&&init.call(editor)}}),editor.menus[menuId]=menu,editor.ready(function(){function hidePanel(){menu.dropPanel.hide()}var editor=this,config=editor.config,uploadImgUrl=config.uploadImgUrl,customUpload=config.customUpload,linkImg=config.hideLinkImg;uploadImgUrl||customUpload?(editor.$uploadContent=$uploadContent,tabToggle(),linkImg&&hideLinkImg()):hideUploadImg(),$uploadContent.click(function(){setTimeout(hidePanel)})})}})}),_e(function(E,$){E.createMenu(function(check){var menuId="video";if(check(menuId)){var editor=this,lang=editor.config.lang,reg=/^<(iframe)|(embed)/i,menu=new E.Menu({editor:editor,id:menuId,title:lang.video}),$content=$("<div></div>"),$linkInputContainer=$('<div style="margin:20px 10px;"></div>'),$linkInput=$('<input type="text" class="block" placeholder=\'格式如：<iframe src="..." frameborder=0 allowfullscreen></iframe>\'/>');$linkInputContainer.append($linkInput);var $sizeContainer=$('<div style="margin:20px 10px;"></div>'),$widthInput=$('<input type="text" value="640" style="width:50px;text-align:center;"/>'),$heightInput=$('<input type="text" value="498" style="width:50px;text-align:center;"/>');$sizeContainer.append("<span> "+lang.width+" </span>").append($widthInput).append("<span> px &nbsp;&nbsp;&nbsp;</span>").append("<span> "+lang.height+" </span>").append($heightInput).append("<span> px </span>");var $btnContainer=$("<div></div>"),$howToCopy=$('<a href="http://www.kancloud.cn/wangfupeng/wangeditor2/134973" target="_blank" style="display:inline-block;margin-top:10px;margin-left:10px;color:#999;">如何复制视频链接？</a>'),$btnSubmit=$('<button class="right">'+lang.submit+"</button>"),$btnCancel=$('<button class="right gray">'+lang.cancel+"</button>");$btnContainer.append($howToCopy).append($btnSubmit).append($btnCancel),$content.append($linkInputContainer).append($sizeContainer).append($btnContainer),$btnCancel.click(function(e){e.preventDefault(),$linkInput.val(""),menu.dropPanel.hide()}),$btnSubmit.click(function(e){e.preventDefault();var $link,link=$.trim($linkInput.val()),width=parseInt($widthInput.val()),height=parseInt($heightInput.val()),$div=$("<div>"),html="<p>{content}</p>";return link?reg.test(link)?isNaN(width)||isNaN(height)?void alert("宽度或高度不是数字！"):($link=$(link),$link.attr("width",width).attr("height",height),html=html.replace("{content}",$div.append($link).html()),editor.command(e,"insertHtml",html),void $linkInput.val("")):(alert("视频链接格式错误！"),void menu.dropPanel.focusFirstInput()):void menu.dropPanel.focusFirstInput()}),menu.dropPanel=new E.DropPanel(editor,menu,{$content:$content,width:400}),editor.menus[menuId]=menu}})}),_e(function(E,$){var inputKeyup=function(input){return"onkeyup"in input}(document.createElement("input"));E.baiduMapAk="TVhjYjq1ICT2qqL5LdS8mwas",E.numberOfLocation=0,E.createMenu(function(check){function callback(){$searchInput.val("")}var menuId="location";if(check(menuId)){if(++E.numberOfLocation>1)return void E.error("目前不支持在一个页面多个编辑器上同时使用地图，可通过自定义菜单配置去掉地图菜单");var editor=this,config=editor.config,lang=config.lang,ak=config.mapAk;editor.mapData={};var mapData=editor.mapData;mapData.markers=[],mapData.mapContainerId="map"+E.random(),mapData.clearLocations=function(){var map=mapData.map;map&&(map.clearOverlays(),mapData.markers=[])},mapData.searchMap=function(){var map=mapData.map;if(map){var myGeo,marker,BMap=window.BMap,cityName=$cityInput.val(),locationName=$searchInput.val();""!==cityName&&(locationName&&""!==locationName||map.centerAndZoom(cityName,11),locationName&&""!==locationName&&(myGeo=new BMap.Geocoder,myGeo.getPoint(locationName,function(point){point?(map.centerAndZoom(point,13),marker=new BMap.Marker(point),map.addOverlay(marker),marker.enableDragging(),mapData.markers.push(marker)):map.centerAndZoom(cityName,11)},cityName)))}};var hasCallback=!1;window.baiduMapCallBack=function(){function locationFun(result){var cityName=result.name;map.setCenter(cityName),$cityInput.val(cityName),E.placeholder&&$searchInput.focus();var timeoutId,_searchFn;inputKeyup?(_searchFn=function(e){"keyup"===e.type&&13===e.keyCode&&e.preventDefault(),timeoutId&&clearTimeout(timeoutId),timeoutId=setTimeout(mapData.searchMap,500)},$cityInput.on("keyup change paste",_searchFn),$searchInput.on("keyup change paste",_searchFn)):(_searchFn=function(){if(!$content.is(":visible"))return void clearTimeout(timeoutId);var currentCity="",currentSearch="",city=$cityInput.val(),search=$searchInput.val();city===currentCity&&search===currentSearch||(mapData.searchMap(),currentCity=city,currentSearch=search),timeoutId&&clearTimeout(timeoutId),timeoutId=setTimeout(_searchFn,1e3)},timeoutId=setTimeout(_searchFn,1e3))}if(!hasCallback){hasCallback=!0;var BMap=window.BMap;mapData.map||(mapData.map=new BMap.Map(mapData.mapContainerId));var map=mapData.map;map.centerAndZoom(new BMap.Point(116.404,39.915),11),map.addControl(new BMap.MapTypeControl),map.setCurrentCity("北京"),map.enableScrollWheelZoom(!0);var myCity=new BMap.LocalCity;myCity.get(locationFun),map.addEventListener("click",function(e){var marker=new BMap.Marker(new BMap.Point(e.point.lng,e.point.lat));map.addOverlay(marker),marker.enableDragging(),mapData.markers.push(marker)},!1)}},mapData.loadMapScript=function(){var script=document.createElement("script");script.type="text/javascript",script.src="https://api.map.baidu.com/api?v=2.0&ak="+ak+"&s=1&callback=baiduMapCallBack";try{document.body.appendChild(script)}catch(ex){E.error("加载地图过程中发生错误")}},mapData.initMap=function(){window.BMap?window.baiduMapCallBack():mapData.loadMapScript()};var menu=new E.Menu({editor:editor,id:menuId,title:lang.location});editor.menus[menuId]=menu;var $content=$("<div></div>"),$inputContainer=$('<div style="margin:10px 0;"></div>'),$cityInput=$('<input type="text"/>');$cityInput.css({width:"80px","text-align":"center"});var $searchInput=$('<input type="text"/>');$searchInput.css({width:"300px","margin-left":"10px"}).attr("placeholder",lang.searchlocation);var $clearBtn=$('<button class="right link">'+lang.clearLocation+"</button>");$inputContainer.append($clearBtn).append($cityInput).append($searchInput),$content.append($inputContainer),$clearBtn.click(function(e){$searchInput.val(""),$searchInput.focus(),mapData.clearLocations(),e.preventDefault()});var $map=$('<div id="'+mapData.mapContainerId+'"></div>');$map.css({height:"260px",width:"100%",position:"relative","margin-top":"10px",border:"1px solid #f1f1f1"});var $mapLoading=$("<span>"+lang.loading+"</span>");$mapLoading.css({position:"absolute",width:"100px","text-align":"center",top:"45%",left:"50%","margin-left":"-50px"}),$map.append($mapLoading),$content.append($map);var $btnContainer=$('<div style="margin:10px 0;"></div>'),$btnSubmit=$('<button class="right">'+lang.submit+"</button>"),$btnCancel=$('<button class="right gray">'+lang.cancel+"</button>"),$checkLabel=$('<label style="display:inline-block;margin-top:10px;color:#666;"></label>'),$check=$('<input type="checkbox">');$checkLabel.append($check).append('<span style="display:inline-block;margin-left:5px;">  '+lang.dynamicMap+"</span>"),$btnContainer.append($checkLabel).append($btnSubmit).append($btnCancel),$content.append($btnContainer),$btnCancel.click(function(e){e.preventDefault(),callback(),menu.dropPanel.hide()}),$btnSubmit.click(function(e){e.preventDefault();var position,src,iframe,map=mapData.map,isDynamic=$check.is(":checked"),markers=mapData.markers,center=map.getCenter(),centerLng=center.lng,centerLat=center.lat,zoom=map.getZoom(),size=map.getSize(),sizeWidth=size.width,sizeHeight=size.height;if(src=isDynamic?"http://ueditor.baidu.com/ueditor/dialogs/map/show.html#":"http://api.map.baidu.com/staticimage?",src=src+"center="+centerLng+","+centerLat+"&zoom="+zoom+"&width="+sizeWidth+"&height="+sizeHeight,markers.length>0&&(src+="&markers=",$.each(markers,function(key,value){position=value.getPosition(),key>0&&(src+="|"),src=src+position.lng+","+position.lat})),isDynamic){if(markers.length>1)return void alert(lang.langDynamicOneLocation);src+="&markerStyles=l,A",iframe='<iframe class="ueditor_baidumap" src="{src}" frameborder="0" width="'+sizeWidth+'" height="'+sizeHeight+'"></iframe>',iframe=iframe.replace("{src}",src),editor.command(e,"insertHtml",iframe,callback)}else editor.command(e,"insertHtml",'<img style="max-width:100%;" src="'+src+'"/>',callback)}),menu.dropPanel=new E.DropPanel(editor,menu,{$content:$content,width:500}),menu.onRender=function(){ak===E.baiduMapAk&&E.warn("建议在配置中自定义百度地图的mapAk，否则可能影响地图功能，文档："+E.docsite)},menu.clickEvent=function(e){var menu=this,dropPanel=menu.dropPanel,firstTime=!1;return dropPanel.isShowing?void dropPanel.hide():(mapData.map||(firstTime=!0),dropPanel.show(),mapData.initMap(),void(firstTime||$searchInput.focus()))}}})}),_e(function(E,$){function loadHljs(){if(!(E.userAgent.indexOf("MSIE 8")>0||window.hljs)){var script=document.createElement("script");script.type="text/javascript",script.src="//cdn.bootcss.com/highlight.js/9.2.0/highlight.min.js",document.body.appendChild(script)}}E.createMenu(function(check){function contentHandle($content){var $textareaContainer=$("<div></div>");$textareaContainer.css({margin:"15px 5px 5px 5px",height:"160px","text-align":"center"}),$textarea.css({width:"100%",height:"100%",padding:"10px"}),$textarea.on("keydown",function(e){9===e.keyCode&&e.preventDefault()}),$textareaContainer.append($textarea),$content.append($textareaContainer);var $btnContainer=$("<div></div>"),$btnSubmit=$('<button class="right">'+lang.submit+"</button>"),$btnCancel=$('<button class="right gray">'+lang.cancel+"</button>");$btnContainer.append($btnSubmit).append($btnCancel).append($langSelect),$content.append($btnContainer),$btnCancel.click(function(e){e.preventDefault(),menu.dropPanel.hide()});var codeTpl='<pre style="max-width:100%;overflow-x:auto;"><code{#langClass}>{#content}</code></pre>';$btnSubmit.click(function(e){function commandFn(){var className;lang&&(className=$targetElem.attr("class"),className!==lang+" hljs"&&$targetElem.attr("class",lang+" hljs")),$targetElem.html(val)}function callback(){editor.restoreSelectionByElem(targetElem),doHightlight()}e.preventDefault();var val=$textarea.val();if(!val)return void $textarea.focus();var rangeElem=editor.getRangeElem();$.trim($(rangeElem).text())&&0!==codeTpl.indexOf("<p><br></p>")&&(codeTpl="<p><br></p>"+codeTpl);var lang=$langSelect?$langSelect.val():"",langClass="",doHightlight=function(){$txt.find("pre code").each(function(i,block){var $block=$(block);$block.attr("codemark")||window.hljs&&(window.hljs.highlightBlock(block),$block.attr("codemark","1"))})};if(lang&&(langClass=' class="'+lang+' hljs"'),val=val.replace(/&/gm,"&amp;").replace(/</gm,"&lt;").replace(/>/gm,"&gt;"),!menu.selected){var html=codeTpl.replace("{#langClass}",langClass).replace("{#content}",val);return void editor.command(e,"insertHtml",html,doHightlight)}var $targetElem,targetElem=editor.getSelfOrParentByName(rangeElem,"pre");targetElem&&(targetElem=editor.getSelfOrParentByName(rangeElem,"code")),targetElem&&($targetElem=$(targetElem),editor.customCommand(e,commandFn,callback))})}function updateMenu(){var rangeElem=editor.getRangeElem(),targetElem=editor.getSelfOrParentByName(rangeElem,"code");targetElem?editor.disableMenusExcept("insertcode"):editor.enableMenusExcept("insertcode")}var menuId="insertcode";if(check(menuId)){setTimeout(loadHljs,0);var editor=this,config=editor.config,lang=config.lang,$txt=editor.txt.$txt,menu=new E.Menu({editor:editor,id:menuId,title:lang.insertcode});menu.clickEvent=function(e){var menu=this,dropPanel=menu.dropPanel;if(dropPanel.isShowing)return void dropPanel.hide();$textarea.val(""),dropPanel.show();var hljs=window.hljs;if(hljs&&hljs.listLanguages){if(0!==$langSelect.children().length)return;$langSelect.css({"margin-top":"9px","margin-left":"5px"}),$.each(hljs.listLanguages(),function(key,lang){"xml"===lang&&(lang="html"),lang===config.codeDefaultLang?$langSelect.append('<option value="'+lang+'" selected="selected">'+lang+"</option>"):$langSelect.append('<option value="'+lang+'">'+lang+"</option>")})}else $langSelect.hide()},menu.clickEventSelected=function(e){var menu=this,dropPanel=menu.dropPanel;if(dropPanel.isShowing)return void dropPanel.hide();dropPanel.show();var $targetElem,className,rangeElem=editor.getRangeElem(),targetElem=editor.getSelfOrParentByName(rangeElem,"pre");targetElem&&(targetElem=editor.getSelfOrParentByName(rangeElem,"code")),targetElem&&($targetElem=$(targetElem),$textarea.val($targetElem.text()),$langSelect&&(className=$targetElem.attr("class"),className&&$langSelect.val(className.split(" ")[0])))},menu.updateSelectedEvent=function(){var rangeElem,self=this,editor=self.editor;return rangeElem=editor.getRangeElem(),rangeElem=editor.getSelfOrParentByName(rangeElem,"pre"),!!rangeElem};var $content=$("<div></div>"),$textarea=$("<textarea></textarea>"),$langSelect=$("<select></select>");contentHandle($content),menu.dropPanel=new E.DropPanel(editor,menu,{$content:$content,width:500}),editor.menus[menuId]=menu,$txt.on("keydown",function(e){if(13===e.keyCode){var rangeElem=editor.getRangeElem(),targetElem=editor.getSelfOrParentByName(rangeElem,"code");targetElem&&editor.command(e,"insertHtml","\n")}}),$txt.on("keydown click",function(e){setTimeout(updateMenu)})}})}),_e(function(E,$){E.createMenu(function(check){var menuId="undo";if(check(menuId)){var editor=this,lang=editor.config.lang,menu=new E.Menu({editor:editor,id:menuId,title:lang.undo});menu.clickEvent=function(e){editor.undo()},editor.menus[menuId]=menu,editor.ready(function(){function undo(){editor.undoRecord()}var timeoutId,editor=this,$txt=editor.txt.$txt;$txt.on("keydown",function(e){var keyCode=e.keyCode;return e.ctrlKey&&90===keyCode?void editor.undo():void(13===keyCode?undo():(timeoutId&&clearTimeout(timeoutId),timeoutId=setTimeout(undo,1e3)))}),editor.undoRecord()})}})}),_e(function(E,$){E.createMenu(function(check){var menuId="redo";if(check(menuId)){var editor=this,lang=editor.config.lang,menu=new E.Menu({editor:editor,id:menuId,title:lang.redo});menu.clickEvent=function(e){editor.redo()},editor.menus[menuId]=menu}})}),_e(function(E,$){var scrollTopWhenFullScreen;E.createMenu(function(check){var menuId="fullscreen";if(check(menuId)){var zIndex,maxHeight,editor=this,$txt=editor.txt.$txt,config=editor.config,zIndexConfig=config.zindex||1e4,lang=config.lang,isSelected=!1,menu=new E.Menu({editor:editor,id:menuId,title:lang.fullscreen});menu.clickEvent=function(e){var $editorContainer=editor.$editorContainer;$editorContainer.addClass("wangEditor-fullscreen"),zIndex=$editorContainer.css("z-index"),$editorContainer.css("z-index",zIndexConfig);var $wrapper,txtHeight=$txt.height(),txtOuterHeight=$txt.outerHeight();editor.useMaxHeight&&(maxHeight=$txt.css("max-height"),$txt.css("max-height","none"),$wrapper=$txt.parent(),$wrapper.after($txt),$wrapper.remove(),$txt.css("overflow-y","auto"));var menuContainer=editor.menuContainer;$txt.height(E.$window.height()-menuContainer.height()-(txtOuterHeight-txtHeight)),editor.menuContainer.$menuContainer.attr("style",""),isSelected=!0,editor.isFullScreen=!0,scrollTopWhenFullScreen=E.$window.scrollTop()},menu.clickEventSelected=function(e){var $editorContainer=editor.$editorContainer;$editorContainer.removeClass("wangEditor-fullscreen"),$editorContainer.css("z-index",zIndex),editor.useMaxHeight?$txt.css("max-height",maxHeight):editor.$valueContainer.css("height",editor.valueContainerHeight),editor.txt.initHeight(),isSelected=!1,editor.isFullScreen=!1,null!=scrollTopWhenFullScreen&&E.$window.scrollTop(scrollTopWhenFullScreen)},menu.updateSelectedEvent=function(e){return isSelected},editor.menus[menuId]=menu}})}),_e(function(E,$){E.fn.renderMenus=function(){var menu,editor=this,menus=editor.menus,menuIds=editor.config.menus,groupIdx=(editor.menuContainer,0);$.each(menuIds,function(k,v){return"|"===v?void groupIdx++:(menu=menus[v],void(menu&&menu.render(groupIdx)))})}}),_e(function(E,$){E.fn.renderMenuContainer=function(){var editor=this,menuContainer=editor.menuContainer;editor.$editorContainer;menuContainer.render()}}),_e(function(E,$){E.fn.renderTxt=function(){var editor=this,txt=editor.txt;txt.render(),editor.ready(function(){txt.initHeight()})}}),_e(function(E,$){E.fn.renderEditorContainer=function(){var $prev,$parent,editor=this,$valueContainer=editor.$valueContainer,$editorContainer=editor.$editorContainer,$txt=editor.txt.$txt;$valueContainer===$txt?($prev=editor.$prev,$parent=editor.$parent,$prev&&$prev.length?$prev.after($editorContainer):$parent.prepend($editorContainer)):($valueContainer.after($editorContainer),$valueContainer.hide())}}),_e(function(E,$){E.fn.eventMenus=function(){var menus=this.menus;$.each(menus,function(k,v){v.bindEvent()})}}),_e(function(E,$){E.fn.eventMenuContainer=function(){}}),_e(function(E,$){E.fn.eventTxt=function(){var txt=this.txt;txt.saveSelectionEvent(),txt.updateValueEvent(),txt.updateMenuStyleEvent()}}),_e(function(E,$){E.plugin(function(){var editor=this,fns=editor.config.uploadImgFns;fns.onload||(fns.onload=function(resultText,xhr){E.log("上传结束，返回结果为 "+resultText);var img,editor=this,originalName=editor.uploadImgOriginalName||"";0===resultText.indexOf("error|")?(E.warn("上传失败："+resultText.split("|")[1]),alert(resultText.split("|")[1])):(E.log("上传成功，即将插入编辑区域，结果为："+resultText),img=document.createElement("img"),img.onload=function(){var html='<img src="'+resultText+'" alt="'+originalName+'" style="max-width:100%;"/>';editor.command(null,"insertHtml",html),E.log("已插入图片，地址 "+resultText),img=null},img.onerror=function(){E.error("使用返回的结果获取图片，发生错误。请确认以下结果是否正确："+resultText),img=null},img.src=resultText)}),fns.ontimeout||(fns.ontimeout=function(xhr){E.error("上传图片超时"),alert("上传图片超时")}),fns.onerror||(fns.onerror=function(xhr){E.error("上传上图片发生错误"),alert("上传上图片发生错误")})})}),_e(function(E,$){window.FileReader&&window.FormData&&E.plugin(function(){function convertBase64UrlToBlob(urlData,filetype){var i,bytes=window.atob(urlData.split(",")[1]),ab=new ArrayBuffer(bytes.length),ia=new Uint8Array(ab);for(i=0;i<bytes.length;i++)ia[i]=bytes.charCodeAt(i);return new Blob([ab],{type:filetype})}function insertImg(src,event){var img=document.createElement("img");img.onload=function(){var html='<img src="'+src+'" style="max-width:100%;"/>';editor.command(event,"insertHtml",html),E.log("已插入图片，地址 "+src),img=null},img.onerror=function(){E.error("使用返回的结果获取图片，发生错误。请确认以下结果是否正确："+src),img=null},img.src=src}function updateProgress(e){if(e.lengthComputable){var percentComplete=e.loaded/e.total;editor.showUploadProgress(100*percentComplete)}}var editor=this,config=editor.config,uploadImgUrl=config.uploadImgUrl,uploadTimeout=config.uploadTimeout,uploadImgFns=config.uploadImgFns,onload=uploadImgFns.onload,ontimeout=uploadImgFns.ontimeout,onerror=uploadImgFns.onerror;uploadImgUrl&&(editor.xhrUploadImg=function(opt){function timeoutCallback(){timeoutId&&clearTimeout(timeoutId),xhr&&xhr.abort&&xhr.abort(),event.preventDefault(),timeoutfn&&timeoutfn.call(editor,xhr),editor.hideUploadProgress()}var event=opt.event,fileName=opt.filename||"",base64=opt.base64,fileType=opt.fileType||"image/png",name=opt.name||"wangEditor_upload_file",loadfn=opt.loadfn||onload,errorfn=opt.errorfn||onerror,timeoutfn=opt.timeoutfn||ontimeout,params=editor.config.uploadParams||{},headers=editor.config.uploadHeaders||{},fileExt="png";if(fileName.indexOf(".")>0?fileExt=fileName.slice(fileName.lastIndexOf(".")-fileName.length+1):fileType.indexOf("/")>0&&fileType.split("/")[1]&&(fileExt=fileType.split("/")[1]),E.isOnWebsite)return E.log("预览模拟上传"),void insertImg(base64,event);var timeoutId,xhr=new XMLHttpRequest,formData=new FormData;xhr.onload=function(){timeoutId&&clearTimeout(timeoutId),editor.uploadImgOriginalName=fileName,fileName.indexOf(".")>0&&(editor.uploadImgOriginalName=fileName.split(".")[0]),loadfn&&loadfn.call(editor,xhr.responseText,xhr),editor.hideUploadProgress()},xhr.onerror=function(){timeoutId&&clearTimeout(timeoutId),event.preventDefault(),errorfn&&errorfn.call(editor,xhr),editor.hideUploadProgress()},xhr.upload.onprogress=updateProgress,formData.append(name,convertBase64UrlToBlob(base64,fileType),E.random()+"."+fileExt),$.each(params,function(key,value){formData.append(key,value)}),xhr.open("POST",uploadImgUrl,!0),$.each(headers,function(key,value){xhr.setRequestHeader(key,value)}),xhr.withCredentials=!0,xhr.send(formData),timeoutId=setTimeout(timeoutCallback,uploadTimeout),E.log("开始上传...并开始超时计算")})})}),_e(function(E,$){E.plugin(function(){function render(){isRender||(isRender=!0,$progress.css({top:menuHeight+"px"}),$editorContainer.append($progress))}function hideProgress(){$progress.hide(),timeoutId=null}var editor=this,menuContainer=editor.menuContainer,menuHeight=menuContainer.height(),$editorContainer=editor.$editorContainer,width=$editorContainer.width(),$progress=$('<div class="wangEditor-upload-progress"></div>'),isRender=!1;editor.showUploadProgress=function(progress){timeoutId&&clearTimeout(timeoutId),render(),$progress.show(),$progress.width(progress*width/100)};var timeoutId;editor.hideUploadProgress=function(time){timeoutId&&clearTimeout(timeoutId),time=time||750,timeoutId=setTimeout(hideProgress,time)}})}),_e(function(E,$){E.plugin(function(){var event,editor=this,config=editor.config,uploadImgUrl=config.uploadImgUrl,uploadTimeout=config.uploadTimeout;if(uploadImgUrl){var $uploadContent=editor.$uploadContent;if($uploadContent){var $uploadIcon=$('<div class="upload-icon-container"><i class="wangeditor-menu-img-upload"></i></div>');$uploadContent.append($uploadIcon);var upfile=new E.UploadFile({editor:editor,uploadUrl:uploadImgUrl,timeout:uploadTimeout,fileAccept:"image/*"});$uploadIcon.click(function(e){event=e,upfile.selectFiles()})}}})}),_e(function(E,$){if(window.FileReader&&window.FormData){var UploadFile=function(opt){this.editor=opt.editor,this.uploadUrl=opt.uploadUrl,this.timeout=opt.timeout,this.fileAccept=opt.fileAccept,this.multiple=!0};UploadFile.fn=UploadFile.prototype,UploadFile.fn.clear=function(){this.$input.val(""),E.log("input value 已清空")},UploadFile.fn.render=function(){var self=this;if(!self._hasRender){E.log("渲染dom");var fileAccept=self.fileAccept,acceptTpl=fileAccept?'accept="'+fileAccept+'"':"",multiple=self.multiple,multipleTpl=multiple?'multiple="multiple"':"",$input=$('<input type="file" '+acceptTpl+" "+multipleTpl+"/>"),$container=$('<div style="visibility:hidden;"></div>');$container.append($input),E.$body.append($container),$input.on("change",function(e){self.selected(e,$input.get(0))}),self.$input=$input,self._hasRender=!0}},UploadFile.fn.selectFiles=function(){var self=this;E.log("使用 html5 方式上传"),self.render(),E.log("选择文件"),self.$input.click()},UploadFile.fn.selected=function(e,input){var self=this,files=input.files||[];0!==files.length&&(E.log("选中 "+files.length+" 个文件"),$.each(files,function(key,value){self.upload(value)}))},UploadFile.fn.upload=function(file){function clearInput(){self.clear()}var self=this,editor=self.editor,filename=file.name||"",fileType=file.type||"",uploadImgFns=editor.config.uploadImgFns,uploadFileName=editor.config.uploadImgFileName||"wangEditorH5File",onload=uploadImgFns.onload,ontimeout=uploadImgFns.ontimeout,onerror=uploadImgFns.onerror,reader=new FileReader;return onload&&ontimeout&&onerror?(E.log("开始执行 "+filename+" 文件的上传"),reader.onload=function(e){E.log("已读取"+filename+"文件");var base64=e.target.result||this.result;editor.xhrUploadImg({event:e,filename:filename,base64:base64,fileType:fileType,name:uploadFileName,loadfn:function(resultText,xhr){clearInput();var editor=this;onload.call(editor,resultText,xhr)},errorfn:function(xhr){clearInput(),E.isOnWebsite&&alert("wangEditor官网暂时没有服务端，因此报错。实际项目中不会发生");
var editor=this;onerror.call(editor,xhr)},timeoutfn:function(xhr){clearInput(),E.isOnWebsite&&alert("wangEditor官网暂时没有服务端，因此超时。实际项目中不会发生");var editor=this;ontimeout(editor,xhr)}})},void reader.readAsDataURL(file)):void E.error("请为编辑器配置上传图片的 onload ontimeout onerror 回调事件")},E.UploadFile=UploadFile}}),_e(function(E,$){if(!window.FileReader||!window.FormData){var UploadFile=function(opt){this.editor=opt.editor,this.uploadUrl=opt.uploadUrl,this.timeout=opt.timeout,this.fileAccept=opt.fileAccept,this.multiple=!1};UploadFile.fn=UploadFile.prototype,UploadFile.fn.clear=function(){this.$input.val(""),E.log("input value 已清空")},UploadFile.fn.hideModal=function(){this.modal.hide()},UploadFile.fn.render=function(){var self=this,editor=self.editor,uploadFileName=editor.config.uploadImgFileName||"wangEditorFormFile";if(!self._hasRender){var uploadUrl=self.uploadUrl;E.log("渲染dom");var iframeId="iframe"+E.random(),$iframe=$('<iframe name="'+iframeId+'" id="'+iframeId+'" frameborder="0" width="0" height="0"></iframe>'),multiple=self.multiple,multipleTpl=multiple?'multiple="multiple"':"",$p=$("<p>选择图片并上传</p>"),$input=$('<input type="file" '+multipleTpl+' name="'+uploadFileName+'"/>'),$btn=$('<input type="submit" value="上传"/>'),$form=$('<form enctype="multipart/form-data" method="post" action="'+uploadUrl+'" target="'+iframeId+'"></form>'),$container=$('<div style="margin:10px 20px;"></div>');$form.append($p).append($input).append($btn),$.each(editor.config.uploadParams,function(key,value){$form.append($('<input type="hidden" name="'+key+'" value="'+value+'"/>'))}),$container.append($form),$container.append($iframe),self.$input=$input,self.$iframe=$iframe;var modal=new E.Modal(editor,void 0,{$content:$container});self.modal=modal,self._hasRender=!0}},UploadFile.fn.bindLoadEvent=function(){function onloadFn(){var resultText=$.trim(iframeWindow.document.body.innerHTML);if(resultText){var fileFullName=self.$input.val(),fileOriginalName=fileFullName;fileFullName.lastIndexOf("\\")>=0&&(fileOriginalName=fileFullName.slice(fileFullName.lastIndexOf("\\")+1),fileOriginalName.indexOf(".")>0&&(fileOriginalName=fileOriginalName.split(".")[0])),editor.uploadImgOriginalName=fileOriginalName,onload.call(editor,resultText),self.clear(),self.hideModal()}}var self=this;if(!self._hasBindLoad){var editor=self.editor,$iframe=self.$iframe,iframe=$iframe.get(0),iframeWindow=iframe.contentWindow,onload=editor.config.uploadImgFns.onload;iframe.attachEvent?iframe.attachEvent("onload",onloadFn):iframe.onload=onloadFn,self._hasBindLoad=!0}},UploadFile.fn.show=function(){function show(){modal.show(),self.bindLoadEvent()}var self=this,modal=self.modal;setTimeout(show)},UploadFile.fn.selectFiles=function(){var self=this;E.log("使用 form 方式上传"),self.render(),self.clear(),self.show()},E.UploadFile=UploadFile}}),_e(function(E,$){E.plugin(function(){function findPasteImgAndUpload(){var reg=/^data:(image\/\w+);base64/,$imgs=$txt.find("img");E.log("粘贴后，检查到编辑器有"+$imgs.length+"个图片。开始遍历图片，试图找到刚刚粘贴过来的图片"),$.each($imgs,function(){var flag,type,img=this,$img=$(img),base64=$img.attr("src");$imgsBeforePaste.each(function(){if(img===this)return flag=!0,!1}),flag||(E.log("找到一个粘贴过来的图片"),reg.test(base64)?(E.log("src 是 base64 格式，可以上传"),type=base64.match(reg)[1],editor.xhrUploadImg({event:pasteEvent,base64:base64,fileType:type,name:uploadFileName})):E.log("src 为 "+base64+" ，不是 base64 格式，暂时不支持上传"),$img.remove())}),E.log("遍历结束")}var pasteEvent,$imgsBeforePaste,editor=this,txt=editor.txt,$txt=txt.$txt,config=editor.config,uploadImgUrl=config.uploadImgUrl,uploadFileName=config.uploadImgFileName||"wangEditorPasteFile";uploadImgUrl&&$txt.on("paste",function(e){pasteEvent=e;var text,items,data=pasteEvent.clipboardData||pasteEvent.originalEvent.clipboardData;text=null==data?window.clipboardData&&window.clipboardData.getData("text"):data.getData("text/plain")||data.getData("text/html"),text||(items=data&&data.items,items?(E.log("通过 data.items 得到了数据"),$.each(items,function(key,value){var fileType=value.type||"";if(!(fileType.indexOf("image")<0)){var file=value.getAsFile(),reader=new FileReader;E.log("得到一个粘贴图片"),reader.onload=function(e){E.log("读取到粘贴的图片");var base64=e.target.result||this.result;editor.xhrUploadImg({event:pasteEvent,base64:base64,fileType:fileType,name:uploadFileName})},reader.readAsDataURL(file)}})):(E.log("未从 data.items 得到数据，使用检测粘贴图片的方式"),$imgsBeforePaste=$txt.find("img"),E.log("粘贴前，检查到编辑器有"+$imgsBeforePaste.length+"个图片"),setTimeout(findPasteImgAndUpload,0)))})})}),_e(function(E,$){E.plugin(function(){var editor=this,txt=editor.txt,$txt=txt.$txt,config=editor.config,uploadImgUrl=config.uploadImgUrl,uploadFileName=config.uploadImgFileName||"wangEditorDragFile";uploadImgUrl&&(E.$document.on("dragleave drop dragenter dragover",function(e){e.preventDefault()}),$txt.on("drop",function(dragEvent){dragEvent.preventDefault();var originalEvent=dragEvent.originalEvent,files=originalEvent.dataTransfer&&originalEvent.dataTransfer.files;files&&files.length&&$.each(files,function(k,file){var type=file.type,name=file.name;if(!(type.indexOf("image/")<0)){E.log("得到图片 "+name);var reader=new FileReader;reader.onload=function(e){E.log("读取到图片 "+name);var base64=e.target.result||this.result;editor.xhrUploadImg({event:dragEvent,base64:base64,fileType:type,name:uploadFileName})},reader.readAsDataURL(file)}})}))})}),_e(function(E,$){E.plugin(function(){function render(){isRendered||(bindEvent(),$toolbar.append($triangle).append($delete).append($zoomSmall).append($zoomBig),editor.$editorContainer.append($toolbar),isRendered=!0)}function bindEvent(){function command(e,callback){commandFn&&editor.customCommand(e,commandFn,callback)}var commandFn;$delete.click(function(e){commandFn=function(){$currentTable.remove()},command(e,function(){setTimeout(hide,100)})}),$zoomBig.click(function(e){commandFn=function(){$currentTable.css({width:"100%"})},command(e,function(){setTimeout(show)})}),$zoomSmall.click(function(e){commandFn=function(){$currentTable.css({width:"auto"})},command(e,function(){setTimeout(show)})})}function show(){if(!editor._disabled&&null!=$currentTable){$currentTable.addClass("clicked");var tablePosition=$currentTable.position(),tableTop=tablePosition.top,tableLeft=tablePosition.left,tableHeight=$currentTable.outerHeight(),tableWidth=$currentTable.outerWidth(),top=tableTop+tableHeight,left=tableLeft,marginLeft=0,txtTop=$currentTxt.position().top,txtHeight=$currentTxt.outerHeight();top>txtTop+txtHeight&&(top=txtTop+txtHeight),$toolbar.show();var width=$toolbar.outerWidth();marginLeft=tableWidth/2-width/2,$toolbar.css({top:top+5,left:left,"margin-left":marginLeft}),marginLeft<0?($toolbar.css("margin-left","0"),$triangle.hide()):$triangle.show()}}function hide(){null!=$currentTable&&($currentTable.removeClass("clicked"),$currentTable=null,$toolbar.hide())}var $currentTable,editor=this,txt=editor.txt,$txt=txt.$txt,$currentTxt=editor.useMaxHeight?$txt.parent():$txt,isRendered=!1,$toolbar=$('<div class="txt-toolbar"></div>'),$triangle=$('<div class="tip-triangle"></div>'),$delete=$('<a href="#"><i class="wangeditor-menu-img-trash-o"></i></a>'),$zoomSmall=$('<a href="#"><i class="wangeditor-menu-img-search-minus"></i></a>'),$zoomBig=$('<a href="#"><i class="wangeditor-menu-img-search-plus"></i></a>');$currentTxt.on("click","table",function(e){var $table=$(e.currentTarget);return render(),$currentTable&&$currentTable.get(0)===$table.get(0)?void setTimeout(hide,100):($currentTable=$table,show(),e.preventDefault(),void e.stopPropagation())}).on("click keydown scroll",function(e){setTimeout(hide,100)}),E.$body.on("click keydown scroll",function(e){setTimeout(hide,100)})})}),_e(function(E,$){E.userAgent.indexOf("MSIE 8")>0||E.plugin(function(){function imgLink(e,url){if($currentImg){var commandFn,$link,callback=function(){null!=url&&(currentLink=url)},inLink=!1,$parent=$currentImg.parent();if("a"===$parent.get(0).nodeName.toLowerCase()?($link=$parent,inLink=!0):$link=$('<a target="_blank"></a>'),null==url)return $link.attr("href")||"";if(""===url)inLink&&(commandFn=function(){$currentImg.unwrap()});else{if(url===currentLink)return;commandFn=function(){$link.attr("href",url),inLink||$currentImg.wrap($link)}}commandFn&&editor.customCommand(e,commandFn,callback)}}function render(){isRendered||(bindToolbarEvent(),bindDragEvent(),$menuContainer.append($delete).append($zoomSmall).append($zoomBig).append($alignLeft).append($alignCenter).append($alignRight).append($link).append($unLink),$linkInputContainer.append($linkInput).append($linkBtnCancel).append($linkBtnSubmit),$toolbar.append($triangle).append($menuContainer).append($linkInputContainer),editor.$editorContainer.append($toolbar).append($dragPoint),isRendered=!0)}function bindToolbarEvent(){function customCommand(e,callback){commandFn&&editor.customCommand(e,commandFn,callback)}var commandFn;$delete.click(function(e){imgLink(e,""),commandFn=function(){$currentImg.remove()},customCommand(e,function(){setTimeout(hide,100)})}),$zoomBig.click(function(e){commandFn=function(){var img=$currentImg.get(0),width=img.width,height=img.height;width*=1.1,height*=1.1,$currentImg.css({width:width+"px",height:height+"px"})},customCommand(e,function(){setTimeout(show)})}),$zoomSmall.click(function(e){commandFn=function(){var img=$currentImg.get(0),width=img.width,height=img.height;width*=.9,height*=.9,$currentImg.css({width:width+"px",height:height+"px"})},customCommand(e,function(){setTimeout(show)})}),$alignLeft.click(function(e){commandFn=function(){$currentImg.parents("p").css({"text-align":"left"}).attr("align","left")},customCommand(e,function(){setTimeout(hide,100)})}),$alignRight.click(function(e){commandFn=function(){$currentImg.parents("p").css({"text-align":"right"}).attr("align","right")},customCommand(e,function(){setTimeout(hide,100)})}),$alignCenter.click(function(e){commandFn=function(){$currentImg.parents("p").css({"text-align":"center"}).attr("align","center")},customCommand(e,function(){setTimeout(hide,100)})}),$link.click(function(e){e.preventDefault(),currentLink=imgLink(e),$linkInput.val(currentLink),$menuContainer.hide(),$linkInputContainer.show()}),$linkBtnSubmit.click(function(e){e.preventDefault();var url=$.trim($linkInput.val());url&&imgLink(e,url),setTimeout(hide)}),$linkBtnCancel.click(function(e){e.preventDefault(),$linkInput.val(currentLink),$menuContainer.show(),$linkInputContainer.hide()}),$unLink.click(function(e){e.preventDefault(),imgLink(e,""),setTimeout(hide)})}function bindDragEvent(){function mousemove(e){var diffX,diffY;diffX=e.pageX-_x,diffY=e.pageY-_y;var currentDragMarginLeft=dragMarginLeft+diffX,currentDragMarginTop=dragMarginTop+diffY;$dragPoint.css({"margin-left":currentDragMarginLeft,"margin-top":currentDragMarginTop});var currentImgWidth=imgWidth+diffX,currentImggHeight=imgHeight+diffY;$currentImg&&$currentImg.css({width:currentImgWidth,height:currentImggHeight})}var _x,_y,dragMarginLeft,dragMarginTop,imgWidth,imgHeight;$dragPoint.on("mousedown",function(e){$currentImg&&(_x=e.pageX,_y=e.pageY,dragMarginLeft=parseFloat($dragPoint.css("margin-left"),10),dragMarginTop=parseFloat($dragPoint.css("margin-top"),10),imgWidth=$currentImg.width(),imgHeight=$currentImg.height(),$toolbar.hide(),E.$document.on("mousemove._dragResizeImg",mousemove),E.$document.on("mouseup._dragResizeImg",function(e){E.$document.off("mousemove._dragResizeImg"),E.$document.off("mouseup._dragResizeImg"),hide(),$dragPoint.css({"margin-left":dragMarginLeft,"margin-top":dragMarginTop}),isOnDrag=!1}),isOnDrag=!0)})}function show(){if(!editor._disabled&&null!=$currentImg){$currentImg.addClass("clicked");var imgPosition=$currentImg.position(),imgTop=imgPosition.top,imgLeft=imgPosition.left,imgHeight=$currentImg.outerHeight(),imgWidth=$currentImg.outerWidth();$dragPoint.css({top:imgTop+imgHeight,left:imgLeft+imgWidth});var top=imgTop+imgHeight,left=imgLeft,marginLeft=0,txtTop=$currentTxt.position().top,txtHeight=$currentTxt.outerHeight();top>txtTop+txtHeight?top=txtTop+txtHeight:$dragPoint.show(),$toolbar.show();var width=$toolbar.outerWidth();marginLeft=imgWidth/2-width/2,$toolbar.css({top:top+5,left:left,"margin-left":marginLeft}),marginLeft<0?($toolbar.css("margin-left","0"),$triangle.hide()):$triangle.show(),editor.disableMenusExcept()}}function hide(){null!=$currentImg&&($currentImg.removeClass("clicked"),$currentImg=null,$toolbar.hide(),$dragPoint.hide(),editor.enableMenusExcept())}function isEmotion(imgSrc){var result=!1;return editor.emotionUrls?($.each(editor.emotionUrls,function(index,url){var flag=!1;if(imgSrc===url&&(result=!0,flag=!0),flag)return!1}),result):result}var $currentImg,editor=this,lang=editor.config.lang,txt=editor.txt,$txt=txt.$txt,$currentTxt=editor.useMaxHeight?$txt.parent():$txt,currentLink=(editor.$editorContainer,""),isRendered=!1,$dragPoint=$('<div class="img-drag-point"></div>'),$toolbar=$('<div class="txt-toolbar"></div>'),$triangle=$('<div class="tip-triangle"></div>'),$menuContainer=$("<div></div>"),$delete=$('<a href="#"><i class="wangeditor-menu-img-trash-o"></i></a>'),$zoomSmall=$('<a href="#"><i class="wangeditor-menu-img-search-minus"></i></a>'),$zoomBig=$('<a href="#"><i class="wangeditor-menu-img-search-plus"></i></a>'),$alignLeft=$('<a href="#"><i class="wangeditor-menu-img-align-left"></i></a>'),$alignCenter=$('<a href="#"><i class="wangeditor-menu-img-align-center"></i></a>'),$alignRight=$('<a href="#"><i class="wangeditor-menu-img-align-right"></i></a>'),$link=$('<a href="#"><i class="wangeditor-menu-img-link"></i></a>'),$unLink=$('<a href="#"><i class="wangeditor-menu-img-unlink"></i></a>'),$linkInputContainer=$('<div style="display:none;"></div>'),$linkInput=$('<input type="text" style="height:26px; margin-left:10px; width:200px;"/>'),$linkBtnSubmit=$('<button class="right">'+lang.submit+"</button>"),$linkBtnCancel=$('<button class="right gray">'+lang.cancel+"</button>"),isOnDrag=!1;$currentTxt.on("mousedown","img",function(e){e.preventDefault()}).on("click","img",function(e){var $img=$(e.currentTarget),src=$img.attr("src");if(src&&!isEmotion(src)){if(render(),$currentImg&&$currentImg.get(0)===$img.get(0))return void setTimeout(hide,100);$currentImg=$img,show(),$menuContainer.show(),$linkInputContainer.hide(),e.preventDefault(),e.stopPropagation()}}).on("click keydown scroll",function(e){isOnDrag||setTimeout(hide,100)})})}),_e(function(E,$){E.plugin(function(){function render(){isRendered||($toolbar.append($triangle).append($triggerLink),editor.$editorContainer.append($toolbar),isRendered=!0)}function setPosition(){if($currentLink){var position=$currentLink.position(),left=position.left,top=position.top,height=$currentLink.height(),topResult=top+height+5,menuHeight=editor.menuContainer.height(),txtHeight=editor.txt.$txt.outerHeight();topResult>menuHeight+txtHeight&&(topResult=menuHeight+txtHeight+5),$toolbar.css({top:topResult,left:left})}}function show(){if(!isShow&&$currentLink){render(),$toolbar.show();var href=$currentLink.attr("href");$triggerLink.attr("href",href),setPosition(),isShow=!0}}function hide(){isShow&&$currentLink&&($toolbar.hide(),isShow=!1)}var $currentLink,isRendered,showTimeoutId,hideTimeoutId,showTimeoutIdByToolbar,editor=this,lang=editor.config.lang,$txt=editor.txt.$txt,$toolbar=$('<div class="txt-toolbar"></div>'),$triangle=$('<div class="tip-triangle"></div>'),$triggerLink=$('<a href="#" target="_blank"><i class="wangeditor-menu-img-link"></i> '+lang.openLink+"</a>"),isShow=!1;$txt.on("mouseenter","a",function(e){showTimeoutId&&clearTimeout(showTimeoutId),showTimeoutId=setTimeout(function(){var a=e.currentTarget,$a=$(a);$currentLink=$a;var $img=$a.children("img");$img.length&&($img.click(function(e){hide()}),$img.hasClass("clicked"))||show()},500)}).on("mouseleave","a",function(e){hideTimeoutId&&clearTimeout(hideTimeoutId),hideTimeoutId=setTimeout(hide,500)}).on("click keydown scroll",function(e){setTimeout(hide,100)}),$toolbar.on("mouseenter",function(e){hideTimeoutId&&clearTimeout(hideTimeoutId)}).on("mouseleave",function(e){showTimeoutIdByToolbar&&clearTimeout(showTimeoutIdByToolbar),showTimeoutIdByToolbar=setTimeout(hide,500)})})}),_e(function(E,$){E.plugin(function(){var editor=this,menuFixed=editor.config.menuFixed;if(menuFixed!==!1&&"number"==typeof menuFixed){var bodyMarginTop=parseFloat(E.$body.css("margin-top"),10);isNaN(bodyMarginTop)&&(bodyMarginTop=0);var $editorContainer=editor.$editorContainer,editorTop=$editorContainer.offset().top,editorHeight=$editorContainer.outerHeight(),$menuContainer=editor.menuContainer.$menuContainer,menuCssPosition=$menuContainer.css("position"),menuCssTop=$menuContainer.css("top"),menuTop=$menuContainer.offset().top,menuHeight=$menuContainer.outerHeight();editor.txt.$txt;E.$window.scroll(function(){if(!editor.isFullScreen){var sTop=E.$window.scrollTop(),menuWidth=$menuContainer.width();0===menuTop&&(menuTop=$menuContainer.offset().top,editorTop=$editorContainer.offset().top,editorHeight=$editorContainer.outerHeight(),menuHeight=$menuContainer.outerHeight()),sTop>=menuTop&&sTop+menuFixed+menuHeight+30<editorTop+editorHeight?($menuContainer.css({position:"fixed",top:menuFixed}),$menuContainer.width(menuWidth),E.$body.css({"margin-top":bodyMarginTop+menuHeight}),editor._isMenufixed||(editor._isMenufixed=!0)):($menuContainer.css({position:menuCssPosition,top:menuCssTop}),$menuContainer.css("width","100%"),E.$body.css({"margin-top":bodyMarginTop}),editor._isMenufixed&&(editor._isMenufixed=!1))}})}})}),_e(function(E,$){E.createMenu(function(check){var menuId="indent";if(check(menuId)){var editor=this,menu=new E.Menu({editor:editor,id:menuId,title:"缩进",$domNormal:$('<a href="#" tabindex="-1"><i class="wangeditor-menu-img-indent-left"></i></a>'),$domSelected:$('<a href="#" tabindex="-1" class="selected"><i class="wangeditor-menu-img-indent-left"></i></a>')});menu.clickEvent=function(e){function commandFn(){$p.css("text-indent","2em")}var $p,elem=editor.getRangeElem(),p=editor.getSelfOrParentByName(elem,"p");return p?($p=$(p),void editor.customCommand(e,commandFn)):e.preventDefault()},menu.clickEventSelected=function(e){function commandFn(){$p.css("text-indent","0")}var $p,elem=editor.getRangeElem(),p=editor.getSelfOrParentByName(elem,"p");return p?($p=$(p),void editor.customCommand(e,commandFn)):e.preventDefault()},menu.updateSelectedEvent=function(){var $p,indent,elem=editor.getRangeElem(),p=editor.getSelfOrParentByName(elem,"p");return!!p&&($p=$(p),indent=$p.css("text-indent"),!(!indent||"0px"===indent))},editor.menus[menuId]=menu}})}),_e(function(E,$){E.createMenu(function(check){var menuId="lineheight";if(check(menuId)){var editor=this;editor.commandHooks.lineHeight=function(value){var rangeElem=editor.getRangeElem(),targetElem=editor.getSelfOrParentByName(rangeElem,"p,h1,h2,h3,h4,h5,pre");targetElem&&$(targetElem).css("line-height",value+"")};var menu=new E.Menu({editor:editor,id:menuId,title:"行高",commandName:"lineHeight",$domNormal:$('<a href="#" tabindex="-1"><i class="wangeditor-menu-img-arrows-v"></i></a>'),$domSelected:$('<a href="#" tabindex="-1" class="selected"><i class="wangeditor-menu-img-arrows-v"></i></a>')}),data={"1.0":"1.0倍",1.5:"1.5倍",1.8:"1.8倍","2.0":"2.0倍",2.5:"2.5倍","3.0":"3.0倍"},tpl='<span style="line-height:{#commandValue}">{#title}</span>';menu.dropList=new E.DropList(editor,menu,{data:data,tpl:tpl}),editor.menus[menuId]=menu}})}),_e(function(E,$){E.plugin(function(){var editor=this,customUpload=editor.config.customUpload;if(customUpload){if(editor.config.uploadImgUrl)return alert("自定义上传无效，详看浏览器日志console.log"),void E.error("已经配置了 uploadImgUrl ，就不能再配置 customUpload ，两者冲突。将导致自定义上传无效。");var $uploadContent=editor.$uploadContent;$uploadContent||E.error("自定义上传，无法获取 editor.$uploadContent");var $uploadIcon=$('<div class="upload-icon-container"><i class="wangeditor-menu-img-upload"></i></div>');$uploadContent.append($uploadIcon);var btnId="upload"+E.random(),containerId="upload"+E.random();$uploadIcon.attr("id",btnId),$uploadContent.attr("id",containerId),editor.customUploadBtnId=btnId,editor.customUploadContainerId=containerId}})}),_e(function(E,$){E.info("本页面富文本编辑器由 wangEditor 提供 http://wangeditor.github.io/ ")}),window.wangEditor})}).call(exports,__webpack_require__(47),__webpack_require__(298)(module))},298:function(module,exports){module.exports=function(module){return module.webpackPolyfill||(module.deprecate=function(){},module.paths=[],module.children=[],module.webpackPolyfill=1),module}},299:function(module,exports,__webpack_require__){function webpackContext(req){return __webpack_require__(webpackContextResolve(req))}function webpackContextResolve(req){return map[req]||function(){throw new Error("Cannot find module '"+req+"'.")}()}var map={"./wangEditor":297,"./wangEditor.js":297,"./wangEditor.min":300,"./wangEditor.min.js":300};webpackContext.keys=function(){return Object.keys(map)},webpackContext.resolve=webpackContextResolve,module.exports=webpackContext,webpackContext.id=299},300:function(module,exports,__webpack_require__){(function(__webpack_provided_window_dot_jQuery,module){"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};/*! wangeditor.js 2016-09-25 */
!function(a){"function"==typeof window.define?window.define.amd?window.define("wangEditor",["jquery"],a):window.define.cmd?window.define(function(b,c,d){return a}):a(__webpack_provided_window_dot_jQuery):"object"==_typeof(module)&&"object"==_typeof(module.exports)?(window.wangEditorCssPath?__webpack_require__(299)(window.wangEditorCssPath):__webpack_require__(290),module.exports=a(window.wangEditorJQueryPath?__webpack_require__(299)(window.wangEditorJQueryPath):__webpack_require__(47))):a(__webpack_provided_window_dot_jQuery)}(function(a){if(!a||!a.fn||!a.fn.jquery)return void alert("在引用wangEditor.js之前，先引用jQuery，否则无法使用 wangEditor");var b=function(_b){var c=window.wangEditor;c&&_b(c,a)};return function(a,b){if(a.wangEditor)return void alert("一个页面不能重复引用 wangEditor.js 或 wangEditor.min.js ！！！");var c=function c(a){"string"==typeof a&&(a="#"+a);var c=b(a);if(1===c.length){var d=c[0].nodeName;"TEXTAREA"!==d&&"DIV"!==d||(this.valueNodeName=d.toLowerCase(),this.$valueContainer=c,this.$prev=c.prev(),this.$parent=c.parent(),this.init())}};c.fn=c.prototype,c.$body=b("body"),c.$document=b(document),c.$window=b(a),c.userAgent=navigator.userAgent,c.getComputedStyle=a.getComputedStyle,c.w3cRange="function"==typeof document.createRange,c.hostname=location.hostname.toLowerCase(),c.websiteHost="wangeditor.github.io|www.wangeditor.com|wangeditor.coding.me",c.isOnWebsite=c.websiteHost.indexOf(c.hostname)>=0,c.docsite="http://www.kancloud.cn/wangfupeng/wangeditor2/113961",a.wangEditor=c,c.plugin=function(a){c._plugins||(c._plugins=[]),"function"==typeof a&&c._plugins.push(a)}}(window,a),b(function(a,b){a.fn.init=function(){this.initDefaultConfig(),this.addEditorContainer(),this.addTxt(),this.addMenuContainer(),this.menus={},this.commandHooks()}}),b(function(a,b){a.fn.ready=function(a){this.readyFns||(this.readyFns=[]),this.readyFns.push(a)},a.fn.readyHeadler=function(){for(var a=this.readyFns;a.length;)a.shift().call(this)},a.fn.updateValue=function(){var a=this,b=a.$valueContainer,c=a.txt.$txt;if(b!==c){var d=c.html();b.val(d)}},a.fn.getInitValue=function(){var a=this,b=a.$valueContainer,c="",d=a.valueNodeName;return"div"===d?c=b.html():"textarea"===d&&(c=b.val()),c},a.fn.updateMenuStyle=function(){var a=this.menus;b.each(a,function(a,b){b.updateSelected()})},a.fn.enableMenusExcept=function(a){this._disabled||(a=a||[],"string"==typeof a&&(a=[a]),b.each(this.menus,function(b,c){a.indexOf(b)>=0||c.disabled(!1)}))},a.fn.disableMenusExcept=function(a){this._disabled||(a=a||[],"string"==typeof a&&(a=[a]),b.each(this.menus,function(b,c){a.indexOf(b)>=0||c.disabled(!0)}))},a.fn.hideDropPanelAndModal=function(){var a=this.menus;b.each(a,function(a,b){var c=b.dropPanel||b.dropList||b.modal;c&&c.hide&&c.hide()})}}),b(function(a,b){function c(){}var d=!a.w3cRange;a.fn.currentRange=function(a){return a?void(this._rangeData=a):this._rangeData},a.fn.collapseRange=function(a,b){b=b||"end",b="start"===b,a=a||this.currentRange(),a&&(a.collapse(b),this.currentRange(a))},a.fn.getRangeText=d?c:function(a){if(a=a||this.currentRange())return a.toString()},a.fn.getRangeElem=d?c:function(a){a=a||this.currentRange();var b=a.commonAncestorContainer;return 1===b.nodeType?b:b.parentNode},a.fn.isRangeEmpty=d?c:function(a){return a=a||this.currentRange(),!(!a||!a.startContainer||a.startContainer!==a.endContainer||a.startOffset!==a.endOffset)},a.fn.saveSelection=d?c:function(a){var c,d,e=this,f=e.txt.$txt.get(0);a?c=a.commonAncestorContainer:(d=document.getSelection(),d.getRangeAt&&d.rangeCount&&(a=document.getSelection().getRangeAt(0),c=a.commonAncestorContainer)),c&&(b.contains(f,c)||f===c)&&e.currentRange(a)},a.fn.restoreSelection=d?c:function(b){var c;if(b=b||this.currentRange())try{c=document.getSelection(),c.removeAllRanges(),c.addRange(b)}catch(d){a.error("执行 editor.restoreSelection 时，IE可能会有异常，不影响使用")}},a.fn.restoreSelectionByElem=d?c:function(a,b){a&&(b=b||"end",this.setRangeByElem(a),"start"===b&&this.collapseRange(this.currentRange(),"start"),"end"===b&&this.collapseRange(this.currentRange(),"end"),this.restoreSelection())},a.fn.initSelection=d?c:function(){var a=this;if(!a.currentRange()){var b=a.txt.$txt,c=b.children().first();c.length&&a.restoreSelectionByElem(c.get(0))}},a.fn.setRangeByElem=d?c:function(a){var c=this,d=c.txt.$txt.get(0);if(a&&b.contains(d,a)){for(var e=a.firstChild;e&&3!==e.nodeType;)e=e.firstChild;for(var f=a.lastChild;f&&3!==f.nodeType;)f=f.lastChild;var g=document.createRange();e&&f?(g.setStart(e,0),g.setEnd(f,f.textContent.length)):(g.setStart(a,0),g.setEnd(a,0)),c.saveSelection(g)}}}),b(function(a,b){a.w3cRange||(a.fn.getRangeText=function(a){if(a=a||this.currentRange())return a.text},a.fn.getRangeElem=function(a){if(a=a||this.currentRange()){var b=a.parentElement();return 1===b.nodeType?b:b.parentNode}},a.fn.isRangeEmpty=function(a){return a=a||this.currentRange(),!a||!a.text},a.fn.saveSelection=function(a){var c,d=this,e=d.txt.$txt.get(0);a?c=a.parentElement():(a=document.selection.createRange(),c="undefined"==typeof a.parentElement?null:a.parentElement()),c&&(b.contains(e,c)||e===c)&&d.currentRange(a)},a.fn.restoreSelection=function(a){var b,c=this;if(a=a||c.currentRange()){b=document.selection.createRange();try{b.setEndPoint("EndToEnd",a)}catch(d){}if(0===a.text.length)try{b.collapse(!1)}catch(d){}else b.setEndPoint("StartToStart",a);b.select()}})}),b(function(a,b){a.fn.commandHooks=function(){var a=this,c={};c.insertHtml=function(c){var d,e=b(c),f=a.getRangeElem();d=a.getLegalTags(f),d&&b(d).after(e)},a.commandHooks=c}}),b(function(a,b){a.fn.command=function(a,b,c,d){function e(){b&&(g.queryCommandSupported(b)?document.execCommand(b,!1,c):(f=g.commandHooks,b in f&&f[b](c)))}var f,g=this;this.customCommand(a,e,d)},a.fn.commandForElem=function(a,b,c,d,e){var f,g;"string"==typeof a?f=a:(f=a.selector,g=a.check);var h=this.getRangeElem();h=this.getSelfOrParentByName(h,f,g),h&&this.setRangeByElem(h),this.command(b,c,d,e)},a.fn.customCommand=function(a,b,c){function d(){e.hideDropPanelAndModal()}var e=this,f=e.currentRange();return f?(e.undoRecord(),this.restoreSelection(f),b.call(e),this.saveSelection(),this.restoreSelection(),c&&"function"==typeof c&&c.call(e),e.txt.insertEmptyP(),e.txt.wrapImgAndText(),e.updateValue(),e.updateMenuStyle(),setTimeout(d,200),void(a&&a.preventDefault())):void(a&&a.preventDefault())},a.fn.queryCommandValue=function(a){var b="";try{b=document.queryCommandValue(a)}catch(c){}return b},a.fn.queryCommandState=function(a){var b=!1;try{b=document.queryCommandState(a)}catch(c){}return b},a.fn.queryCommandSupported=function(a){var b=!1;try{b=document.queryCommandSupported(a)}catch(c){}return b}}),b(function(a,b){function c(a){var c=this,d=b(a),e=!1;return d.each(function(){if(this===c)return e=!0,!1}),e}var d;a.fn.getLegalTags=function(b){var c=this.config.legalTags;return c?this.getSelfOrParentByName(b,c):void a.error("配置项中缺少 legalTags 的配置")},a.fn.getSelfOrParentByName=function(a,e,f){if(a&&e){d||(d=a.webkitMatchesSelector||a.mozMatchesSelector||a.oMatchesSelector||a.matchesSelector),d||(d=c);for(var g=this.txt.$txt.get(0);a&&g!==a&&b.contains(g,a);){if(d.call(a,e)){if(!f)return a;if(f(a))return a}a=a.parentNode}}}}),b(function(a,b){function c(a){return null==a._redoList&&(a._redoList=[]),a._redoList}function d(a){return null==a._undoList&&(a._undoList=[]),a._undoList}function e(a,b,c){var d=b.val,e=a.txt.$txt.html();if(null!=d){if(d===e)return"redo"===c?void a.redo():"undo"===c?void a.undo():void 0;a.txt.$txt.html(d),a.updateValue(),a.onchange&&"function"==typeof a.onchange&&a.onchange.call(a)}}var f=20;a.fn.undoRecord=function(){var a=this,b=a.txt.$txt,e=b.html(),g=d(a),h=c(a),i=g.length?g[0]:"";e!==i.val&&(h.length&&(h=[]),g.unshift({range:a.currentRange(),val:e}),g.length>f&&g.pop())},a.fn.undo=function(){var a=this,b=d(a),f=c(a);if(b.length){var g=b.shift();f.unshift(g),e(this,g,"undo")}},a.fn.redo=function(){var a=this,b=d(a),f=c(a);if(f.length){var g=f.shift();b.unshift(g),e(this,g,"redo")}}}),b(function(a,b){a.fn.create=function(){var c=this;a.$body&&0!==a.$body.length||(a.$body=b("body"),a.$document=b(document),a.$window=b(window)),c.addMenus(),c.renderMenus(),c.renderMenuContainer(),c.renderTxt(),c.renderEditorContainer(),c.eventMenus(),c.eventMenuContainer(),c.eventTxt(),c.readyHeadler(),c.initSelection(),c.$txt=c.txt.$txt;var d=a._plugins;d&&d.length&&b.each(d,function(a,b){b.call(c)})},a.fn.disable=function(){this.txt.$txt.removeAttr("contenteditable"),this.disableMenusExcept(),this._disabled=!0},a.fn.enable=function(){this._disabled=!1,this.txt.$txt.attr("contenteditable","true"),this.enableMenusExcept()},a.fn.destroy=function(){var a=this,b=a.$valueContainer,c=a.$editorContainer,d=a.valueNodeName;"div"===d?(b.removeAttr("contenteditable"),c.after(b),c.hide()):(b.show(),c.hide())},a.fn.undestroy=function(){var a=this,b=a.$valueContainer,c=a.$editorContainer,d=a.menuContainer.$menuContainer,e=a.valueNodeName;"div"===e?(b.attr("contenteditable","true"),d.after(b),c.show()):(b.hide(),c.show())},a.fn.clear=function(){var a=this,b=a.txt.$txt;b.html("<p><br></p>"),a.restoreSelectionByElem(b.find("p").get(0))}}),b(function(a,b){var c=function(a){this.editor=a,this.init()};c.fn=c.prototype,a.MenuContainer=c}),b(function(a,b){var c=a.MenuContainer;c.fn.init=function(){var a=this,c=b('<div class="wangEditor-menu-container clearfix"></div>');a.$menuContainer=c,a.changeShadow()},c.fn.changeShadow=function(){var a=this.$menuContainer,b=this.editor,c=b.txt.$txt;c.on("scroll",function(){c.scrollTop()>10?a.addClass("wangEditor-menu-shadow"):a.removeClass("wangEditor-menu-shadow")})}}),b(function(a,b){var c=a.MenuContainer;c.fn.render=function(){var a=this.$menuContainer,b=this.editor.$editorContainer;b.append(a)},c.fn.height=function(){var a=this.$menuContainer;return a.height()},c.fn.appendMenu=function(a,b){return this._addGroup(a),this._addOneMenu(b)},c.fn._addGroup=function(a){var c,d=this.$menuContainer;this.$currentGroup&&this.currentGroupIdx===a||(c=b('<div class="menu-group clearfix"></div>'),d.append(c),this.$currentGroup=c,this.currentGroupIdx=a)},c.fn._addOneMenu=function(a){var c=a.$domNormal,d=a.$domSelected,e=this.$currentGroup,f=b('<div class="menu-item clearfix"></div>');return d.hide(),f.append(c).append(d),e.append(f),f}}),b(function(a,b){var c=function(a){this.editor=a.editor,this.id=a.id,this.title=a.title,this.$domNormal=a.$domNormal,this.$domSelected=a.$domSelected||a.$domNormal,this.commandName=a.commandName,this.commandValue=a.commandValue,this.commandNameSelected=a.commandNameSelected||a.commandName,this.commandValueSelected=a.commandValueSelected||a.commandValue};c.fn=c.prototype,a.Menu=c}),b(function(a,b){var c=a.Menu;c.fn.initUI=function(){var c=this.editor,d=c.UI.menus,e=this.id,f=d[e];this.$domNormal&&this.$domSelected||(null==f&&(a.warn('editor.UI配置中，没有菜单 "'+e+'" 的UI配置，只能取默认值'),f=d["default"]),this.$domNormal=b(f.normal),/^\./.test(f.selected)?this.$domSelected=this.$domNormal.clone().addClass(f.selected.slice(1)):this.$domSelected=b(f.selected))}}),b(function(a,b){var c=a.Menu;c.fn.render=function(a){this.initUI();var b=this.editor,c=b.menuContainer,d=c.appendMenu(a,this),e=this.onRender;this._renderTip(d),e&&"function"==typeof e&&e.call(this)},c.fn._renderTip=function(c){function d(){j.show()}function e(){j.hide()}var f,g=this,h=g.editor,i=g.title,j=b('<div class="menu-tip"></div>');g.tipWidth||(f=b('<p style="opacity:0; filter:Alpha(opacity=0); position:absolute;top:-10000px;">'+i+"</p>"),a.$body.append(f),h.ready(function(){var a=f.outerWidth()+5,b=j.outerWidth(),c=parseFloat(j.css("margin-left"),10);f.remove(),f=null,j.css({width:a,"margin-left":c+(b-a)/2}),g.tipWidth=a})),j.append(i),c.append(j);var k;c.find("a").on("mouseenter",function(a){g.active()||g.disabled()||(k=setTimeout(d,200))}).on("mouseleave",function(a){k&&clearTimeout(k),e()}).on("click",e)},c.fn.bindEvent=function(){var b=this,c=b.$domNormal,d=b.$domSelected,e=b.clickEvent;e||(e=function e(c){var d=b.dropPanel||b.dropList||b.modal;if(d&&d.show)return void(d.isShowing?d.hide():d.show());var e,f,g=b.editor,h=b.selected;h?(e=b.commandNameSelected,f=b.commandValueSelected):(e=b.commandName,f=b.commandValue),e?g.command(c,e,f):(a.warn('菜单 "'+b.id+'" 未定义click事件'),c.preventDefault())});var f=b.clickEventSelected||e;c.click(function(a){b.disabled()||(e.call(b,a),b.updateSelected()),a.preventDefault()}),d.click(function(a){b.disabled()||(f.call(b,a),b.updateSelected()),a.preventDefault()})},c.fn.updateSelected=function(){var a=this,b=(a.editor,a.updateSelectedEvent);b||(b=function b(){var a=this,b=a.editor,c=a.commandName,d=a.commandValue;if(d){if(b.queryCommandValue(c).toLowerCase()===d.toLowerCase())return!0}else if(b.queryCommandState(c))return!0;return!1});var c=b.call(a);c=!!c,a.changeSelectedState(c)},c.fn.changeSelectedState=function(a){var b=this,c=b.selected;if(null!=a&&"boolean"==typeof a){if(c===a)return;b.selected=a,a?(b.$domNormal.hide(),b.$domSelected.show()):(b.$domNormal.show(),b.$domSelected.hide())}},c.fn.active=function(a){return null==a?this._activeState:void(this._activeState=a)},c.fn.activeStyle=function(a){var b=(this.selected,this.$domNormal),c=this.$domSelected;a?(b.addClass("active"),c.addClass("active")):(b.removeClass("active"),c.removeClass("active")),this.active(a)},c.fn.disabled=function(a){if(null==a)return!!this._disabled;if(this._disabled!==a){var b=this.$domNormal,c=this.$domSelected;a?(b.addClass("disable"),c.addClass("disable")):(b.removeClass("disable"),c.removeClass("disable")),this._disabled=a}}}),b(function(a,b){var c=function(a,b,_c){this.editor=a,this.menu=b,this.data=_c.data,this.tpl=_c.tpl,this.selectorForELemCommand=_c.selectorForELemCommand,this.beforeEvent=_c.beforeEvent,this.afterEvent=_c.afterEvent,this.init()};c.fn=c.prototype,a.DropList=c}),b(function(a,b){var c=a.DropList;c.fn.init=function(){var a=this;a.initDOM(),a.bindEvent(),a.initHideEvent()},c.fn.initDOM=function(){var a,c,d=this,e=d.data,f=d.tpl||"<span>{#title}</span>",g=b('<div class="wangEditor-drop-list clearfix"></div>');b.each(e,function(d,e){a=f.replace(/{#commandValue}/gi,d).replace(/{#title}/gi,e),c=b('<a href="#" commandValue="'+d+'"></a>'),c.append(a),g.append(c)}),d.$list=g},c.fn.bindEvent=function(){var a=this,c=a.editor,d=a.menu,e=d.commandName,f=a.selectorForELemCommand,g=a.$list,h=a.beforeEvent,i=a.afterEvent;g.on("click","a[commandValue]",function(a){h&&"function"==typeof h&&h.call(a);var g=b(a.currentTarget).attr("commandValue");d.selected&&c.isRangeEmpty()&&f?c.commandForElem(f,a,e,g):c.command(a,e,g),i&&"function"==typeof i&&i.call(a)})},c.fn.initHideEvent=function(){var c=this,d=c.$list.get(0);a.$body.on("click",function(a){if(c.isShowing){var e,f=a.target,g=c.menu;e=g.selected?g.$domSelected.get(0):g.$domNormal.get(0),e===f||b.contains(e,f)||d===f||b.contains(d,f)||c.hide()}}),a.$window.scroll(function(){c.hide()}),a.$window.on("resize",function(){c.hide()})}}),b(function(a,b){var c=a.DropList;c.fn._render=function(){var a=this,b=a.editor,c=a.$list;b.$editorContainer.append(c),a.rendered=!0},c.fn._position=function(){var a=this,b=a.$list,c=a.editor,d=a.menu,e=c.menuContainer.$menuContainer,f=d.selected?d.$domSelected:d.$domNormal,g=f.offsetParent().position(),h=g.top,i=g.left,j=f.offsetParent().height(),k=f.offsetParent().width(),l=b.outerWidth(),m=c.txt.$txt.outerWidth(),n=h+j,o=i+k/2,p=0-k/2,q=o+l-m;q>-10&&(p=p-q-10),b.css({top:n,left:o,"margin-left":p}),c._isMenufixed&&(n+=e.offset().top+e.outerHeight()-b.offset().top,b.css({top:n}))},c.fn.show=function(){var a=this,b=a.menu;if(a.rendered||a._render(),!a.isShowing){var c=a.$list;c.show(),a._position(),a.isShowing=!0,b.activeStyle(!0)}},c.fn.hide=function(){var a=this,b=a.menu;if(a.isShowing){var c=a.$list;c.hide(),a.isShowing=!1,b.activeStyle(!1)}}}),b(function(a,b){var c=function(a,b,_c2){this.editor=a,this.menu=b,this.$content=_c2.$content,this.width=_c2.width||200,this.height=_c2.height,this.onRender=_c2.onRender,this.init()};c.fn=c.prototype,a.DropPanel=c}),b(function(a,b){var c=a.DropPanel;c.fn.init=function(){var a=this;a.initDOM(),a.initHideEvent()},c.fn.initDOM=function(){var a=this,c=a.$content,d=a.width,e=a.height,f=b('<div class="wangEditor-drop-panel clearfix"></div>'),g=b('<div class="tip-triangle"></div>');f.css({width:d,height:e?e:"auto"}),f.append(g),f.append(c),a.$panel=f,a.$triangle=g},c.fn.initHideEvent=function(){var c=this,d=c.$panel.get(0);a.$body.on("click",function(a){if(c.isShowing){var e,f=a.target,g=c.menu;e=g.selected?g.$domSelected.get(0):g.$domNormal.get(0),e===f||b.contains(e,f)||d===f||b.contains(d,f)||c.hide()}}),a.$window.scroll(function(a){c.hide()}),a.$window.on("resize",function(){c.hide()})}}),b(function(a,b){var c=a.DropPanel;c.fn._render=function(){var a=this,b=a.onRender,c=a.editor,d=a.$panel;c.$editorContainer.append(d),b&&b.call(a),a.rendered=!0},c.fn._position=function(){var a=this,b=a.$panel,c=a.$triangle,d=a.editor,e=d.menuContainer.$menuContainer,f=a.menu,g=f.selected?f.$domSelected:f.$domNormal,h=g.offsetParent().position(),i=h.top,j=h.left,k=g.offsetParent().height(),l=g.offsetParent().width(),m=b.outerWidth(),n=d.txt.$txt.outerWidth(),o=i+k,p=j+l/2,q=0-m/2,r=q;0-q>p-10&&(q=0-(p-10));var s=p+m+q-n;s>-10&&(q=q-s-10),b.css({top:o,left:p,"margin-left":q}),d._isMenufixed&&(o+=e.offset().top+e.outerHeight()-b.offset().top,b.css({top:o})),c.css({"margin-left":r-q-5})},c.fn.focusFirstInput=function(){var a=this,c=a.$panel;c.find("input[type=text],textarea").each(function(){var a=b(this);if(null==a.attr("disabled"))return a.focus(),!1})},c.fn.show=function(){var b=this,c=b.menu;if(b.rendered||b._render(),!b.isShowing){var d=b.$panel;d.show(),b._position(),b.isShowing=!0,c.activeStyle(!0),a.w3cRange?b.focusFirstInput():a.placeholderForIE8(d)}},c.fn.hide=function(){var a=this,b=a.menu;if(a.isShowing){var c=a.$panel;c.hide(),a.isShowing=!1,b.activeStyle(!1)}}}),b(function(a,b){var c=function(a,b,_c3){this.editor=a,this.menu=b,this.$content=_c3.$content,this.init()};c.fn=c.prototype,a.Modal=c}),b(function(a,b){var c=a.Modal;c.fn.init=function(){var a=this;a.initDom(),a.initHideEvent()},c.fn.initDom=function(){var a=this,c=a.$content,d=b('<div class="wangEditor-modal"></div>'),e=b('<div class="wangEditor-modal-close"><i class="wangeditor-menu-img-cancel-circle"></i></div>');d.append(e),d.append(c),a.$modal=d,a.$close=e},c.fn.initHideEvent=function(){var c=this,d=c.$close,e=c.$modal.get(0);d.click(function(){c.hide()}),a.$body.on("click",function(a){if(c.isShowing){var d,f=a.target,g=c.menu;g&&(d=g.selected?g.$domSelected.get(0):g.$domNormal.get(0),d===f||b.contains(d,f))||e===f||b.contains(e,f)||c.hide()}})}}),b(function(a,b){var c=a.Modal;c.fn._render=function(){var b=this,c=b.editor,d=b.$modal;d.css("z-index",c.config.zindex+10+""),a.$body.append(d),b.rendered=!0},c.fn._position=function(){var b=this,c=b.$modal,d=c.offset().top,e=c.outerWidth(),f=c.outerHeight(),g=0-e/2,h=0-f/2,i=a.$window.scrollTop();f/2>d&&(h=0-d),c.css({"margin-left":g+"px","margin-top":h+i+"px"})},c.fn.show=function(){var a=this,b=a.menu;if(a.rendered||a._render(),!a.isShowing){a.isShowing=!0;var c=a.$modal;c.show(),a._position(),b&&b.activeStyle(!0)}},c.fn.hide=function(){var a=this,b=a.menu;if(a.isShowing){a.isShowing=!1;var c=a.$modal;c.hide(),b&&b.activeStyle(!1)}}}),b(function(a,b){var c=function(a){this.editor=a,this.init()};c.fn=c.prototype,a.Txt=c}),b(function(a,b){var c=a.Txt;c.fn.init=function(){var a,c=this,d=c.editor,e=d.$valueContainer,f=d.getInitValue();"DIV"===e.get(0).nodeName?(a=e,a.addClass("wangEditor-txt"),a.attr("contentEditable","true")):a=b('<div class="wangEditor-txt" contentEditable="true">'+f+"</div>"),d.ready(function(){c.insertEmptyP()}),c.$txt=a,c.contentEmptyHandle(),c.bindEnterForDiv(),c.bindEnterForText(),c.bindTabEvent(),c.bindPasteFilter(),c.bindFormatText(),c.bindHtml()},c.fn.contentEmptyHandle=function(){var a,c=this,d=c.editor,e=c.$txt;e.on("keydown",function(a){if(8===a.keyCode){var c=b.trim(e.html().toLowerCase());return"<p><br></p>"===c?void a.preventDefault():void 0}}),e.on("keyup",function(c){if(8===c.keyCode){var f=b.trim(e.html().toLowerCase());f&&"<br>"!==f||(a=b("<p><br/></p>"),e.html(""),e.append(a),d.restoreSelectionByElem(a.get(0)))}})},c.fn.bindEnterForDiv=function(){function c(){if(d){var a=b("<p>"+d.html()+"</p>");d.after(a),d.remove()}}var d,e=(a.config.legalTags,this),f=e.editor,g=e.$txt;g.on("keydown keyup",function(a){if(13===a.keyCode){var e,g,h=f.getRangeElem(),i=f.getLegalTags(h);if(!i){if(i=f.getSelfOrParentByName(h,"div"),!i)return;e=b(i),"keydown"===a.type&&(d=e,setTimeout(c,0)),"keyup"===a.type&&(g=b("<p>"+e.html()+"</p>"),e.after(g),e.remove(),f.restoreSelectionByElem(g.get(0),"start"))}}})},c.fn.bindEnterForText=function(){var a,b=this,c=b.$txt;c.on("keyup",function(c){13===c.keyCode&&(a||(a=function(){b.wrapImgAndText()}),setTimeout(a))})},c.fn.bindTabEvent=function(){var a=this,b=a.editor,c=a.$txt;c.on("keydown",function(a){9===a.keyCode&&b.queryCommandSupported("insertHtml")&&b.command(a,"insertHtml","&nbsp;&nbsp;&nbsp;&nbsp;")})},c.fn.bindPasteFilter=function(){function a(e){if(e&&e.nodeType&&e.nodeName){var f,h,i=e.nodeName.toLowerCase(),k=e.nodeType;if(3===k||1===k){if(f=b(e),"div"===i)return h=[],b.each(e.childNodes,function(a,b){h.push(b)}),void b.each(h,function(){a(this)});if(j.indexOf(i)>=0)g+=c(e);else if(3===k)g+="<p>"+e.textContent+"</p>";else if("br"===i)g+="<br/>";else{if(["meta","style","script","object","form","iframe","hr"].indexOf(i)>=0)return;f=b(d(e)),g+=b("<div>").append(f.clone()).html()}}}}function c(a){var c,e=a.nodeName.toLowerCase(),f="",g="";return["blockquote"].indexOf(e)>=0?(c=b(a),"<"+e+">"+c.text()+"</"+e+">"):["p","h1","h2","h3","h4","h5"].indexOf(e)>=0?(a=d(a),c=b(a),f=c.html(),f=f.replace(/<.*?>/gi,function(a){return"</a>"===a||0===a.indexOf("<a ")||0===a.indexOf("<img ")?a:""}),"<"+e+">"+f+"</"+e+">"):["ul","ol"].indexOf(e)>=0?(c=b(a),c.children().each(function(){var a=b(d(this)),c=a.html();c=c.replace(/<.*?>/gi,function(a){return"</a>"===a||0===a.indexOf("<a ")||0===a.indexOf("<img ")?a:""}),g+="<li>"+c+"</li>"}),"<"+e+">"+g+"</"+e+">"):(c=b(d(a)),b("<div>").append(c).html())}function d(a){var c=a.attributes||[],e=[],f=["href","target","src","alt","rowspan","colspan"];b.each(c,function(a,b){b&&2===b.nodeType&&e.push(b.nodeName)}),b.each(e,function(b,c){f.indexOf(c)<0&&a.removeAttribute(c)});var g=a.childNodes;return g.length&&b.each(g,function(a,b){d(b)}),a}var e=this,f=e.editor,g="",h=e.$txt,i=f.config.legalTags,j=i.split(",");h.on("paste",function(c){if(f.config.pasteFilter){var d=f.getRangeElem().nodeName;if("TD"!==d&&"TH"!==d){g="";var h,i,j=c.clipboardData||c.originalEvent.clipboardData,k=window.clipboardData;if(f.config.pasteText){if(j&&j.getData)h=j.getData("text/plain");else{if(!k||!k.getData)return;h=k.getData("text")}h&&(g="<p>"+h+"</p>")}else if(j&&j.getData)h=j.getData("text/html"),h?(i=b("<div>"+h+"</div>"),a(i.get(0))):(h=j.getData("text/plain"),h&&(h=h.replace(/[ ]/g,"&nbsp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"</p><p>"),g="<p>"+h+"</p>",g=g.replace(/<p>(https?:\/\/.*?)<\/p>/gi,function(a,b){return'<p><a href="'+b+'" target="_blank">'+b+"</p>"})));else{if(!k||!k.getData)return;if(g=k.getData("text"),!g)return;g="<p>"+g+"</p>",g=g.replace(new RegExp("\n","g"),"</p><p>")}g&&(f.command(c,"insertHtml",g),e.clearEmptyOrNestP())}}})},c.fn.bindFormatText=function(){var c=this,d=(c.editor,c.$txt),e=a.config.legalTags,f=e.split(","),g=(f.length,[]);b.each(f,function(a,b){var c=">\\s*<("+b+")>";g.push(new RegExp(c,"ig"))}),g.push(new RegExp(">\\s*<(li)>","ig")),g.push(new RegExp(">\\s*<(tr)>","ig")),g.push(new RegExp(">\\s*<(code)>","ig")),d.formatText=function(){var a=b("<div>"),c=d.html();return c=c.replace(/\s*</gi,"<"),b.each(g,function(a,b){b.test(c)&&(c=c.replace(b,function(a,b){return">\n<"+b+">"}))}),a.html(c),a.text()}},c.fn.bindHtml=function(){var a=this,c=a.editor,d=a.$txt,e=c.$valueContainer,f=c.valueNodeName;d.html=function(a){var c;return"div"===f&&(c=b.fn.html.call(d,a)),void 0===a?(c=b.fn.html.call(d),c=c.replace(/(href|src)\=\"(.*)\"/gim,function(a,b,c){return b+'="'+c.replace("&amp;","&")+'"'})):(c=b.fn.html.call(d,a),e.val(a)),void 0===a?c:void d.change()}}}),b(function(a,b){var c=a.Txt,d="propertychange change click keyup input paste";c.fn.render=function(){var a=this.$txt,b=this.editor.$editorContainer;b.append(a)},c.fn.initHeight=function(){var a=this.editor,b=this.$txt,c=a.$valueContainer.height(),d=a.menuContainer.height(),e=c-d;e=e<50?50:e,b.height(e),a.valueContainerHeight=c,this.initMaxHeight(e,d)},c.fn.initMaxHeight=function(c,d){var e=this.editor,f=e.menuContainer.$menuContainer,g=this.$txt,h=b("<div>");if(window.getComputedStyle&&"max-height"in window.getComputedStyle(g.get(0))){var i=parseInt(e.$valueContainer.css("max-height"));if(isNaN(i))return;if(e.menus.fullscreen)return void a.warn("max-height和『全屏』菜单一起使用时，会有一些问题尚未解决，请暂时不要两个同时使用");e.useMaxHeight=!0,h.css({"max-height":i-d+"px","overflow-y":"auto"}),g.css({height:"auto","overflow-y":"visible","min-height":c+"px"}),h.on("scroll",function(){g.parent().scrollTop()>10?f.addClass("wangEditor-menu-shadow"):f.removeClass("wangEditor-menu-shadow")}),g.wrap(h)}},c.fn.saveSelectionEvent=function(){function a(){g.saveSelection()}function b(){Date.now()-h<100||(h=Date.now(),a())}function c(){e&&clearTimeout(e),e=setTimeout(a,300)}var e,f=this.$txt,g=this.editor,h=Date.now();f.on(d+" focus blur",function(a){b(),c()}),f.on("mousedown",function(){f.on("mouseleave.saveSelection",function(a){b(),c(),g.updateMenuStyle()})}).on("mouseup",function(){f.off("mouseleave.saveSelection")})},c.fn.updateValueEvent=function(){function a(){var a=e.html();c!==a&&(f.onchange&&"function"==typeof f.onchange&&f.onchange.call(f),f.updateValue(),c=a)}var b,c,e=this.$txt,f=this.editor;e.on(d,function(d){null==c&&(c=e.html()),b&&clearTimeout(b),b=setTimeout(a,100)})},c.fn.updateMenuStyleEvent=function(){var a=this.$txt,b=this.editor;a.on(d,function(a){b.updateMenuStyle()})},c.fn.insertEmptyP=function(){var a=this.$txt,c=a.children();return 0===c.length?void a.append(b("<p><br></p>")):void("<br>"!==b.trim(c.last().html()).toLowerCase()&&a.append(b("<p><br></p>")))},c.fn.wrapImgAndText=function(){var a,c,d=this.$txt,e=d.children("img"),f=d[0],g=f.childNodes,h=g.length;for(e.length&&e.each(function(){b(this).wrap("<p>")}),a=0;a<h;a++)c=g[a],3===c.nodeType&&c.textContent&&b.trim(c.textContent)&&b(c).wrap("<p>")},c.fn.clearEmptyOrNestP=function(){var a=this.$txt,c=a.find("p");c.each(function(){var a,c=b(this),d=c.children(),e=d.length,f=b.trim(c.html());return f?void(1===e&&(a=d.first(),a.get(0)&&"P"===a.get(0).nodeName&&c.html(a.html()))):void c.remove()})},c.fn.scrollTop=function(a){var b=this,c=b.editor,d=b.$txt;return c.useMaxHeight?d.parent().scrollTop(a):d.scrollTop(a)},c.fn.showHeightOnHover=function(){function a(a){i||(e.append(h),i=!0);var b=(g.position().top,g.outerHeight(),a.height()),c=a.position().top,d=parseInt(a.css("margin-top"),10),j=parseInt(a.css("padding-top"),10),k=parseInt(a.css("margin-bottom"),10),l=parseInt(a.css("padding-bottom"),10);c+f.height(),h.css({height:b+j+d+l+k,top:c+f.height()})}function c(){i&&(h.remove(),i=!1)}var d=this.editor,e=d.$editorContainer,f=d.menuContainer,g=this.$txt,h=b('<i class="height-tip"><i>'),i=!1;g.on("mouseenter","ul,ol,blockquote,p,h1,h2,h3,h4,h5,table,pre",function(c){a(b(c.currentTarget))}).on("mouseleave",function(){c()})}}),b(function(a,b){Array.prototype.indexOf||(Array.prototype.indexOf=function(a){for(var b=0,c=this.length;b<c;b++)if(this[b]===a)return b;return-1},Array.prototype.lastIndexOf=function(a){var b=this.length;for(b-=1;b>=0;b--)if(this[b]===a)return b;return-1}),Date.now||(Date.now=function(){return(new Date).valueOf()});var c=window.console,d=function(){};b.each(["info","log","warn","error"],function(b,e){null==c?a[e]=d:a[e]=function(b){a.config&&a.config.printLog&&c[e]("wangEditor提示: "+b)}}),a.random=function(){return Math.random().toString().slice(2)},a.placeholder="placeholder"in document.createElement("input"),a.placeholderForIE8=function(c){a.placeholder||c.find("input[placeholder]").each(function(){var a=b(this),c=a.attr("placeholder");""===a.val()&&(a.css("color","#666"),a.val(c),a.on("focus.placeholder click.placeholder",function(){a.val(""),a.css("color","#333"),a.off("focus.placeholder click.placeholder")}))})}}),b(function(a,b){a.langs={},a.langs["zh-cn"]={bold:"粗体",underline:"下划线",italic:"斜体",forecolor:"文字颜色",bgcolor:"背景色",strikethrough:"删除线",eraser:"清空格式",source:"源码",quote:"引用",fontfamily:"字体",fontsize:"字号",head:"标题",orderlist:"有序列表",unorderlist:"无序列表",alignleft:"左对齐",aligncenter:"居中",alignright:"右对齐",link:"链接",text:"文本",submit:"提交",cancel:"取消",unlink:"取消链接",table:"表格",emotion:"表情",img:"图片",video:"视频",width:"宽",height:"高",location:"位置",loading:"加载中",searchlocation:"搜索位置",dynamicMap:"动态地图",clearLocation:"清除位置",langDynamicOneLocation:"动态地图只能显示一个位置",insertcode:"插入代码",undo:"撤销",redo:"重复",fullscreen:"全屏",openLink:"打开链接"},a.langs.en={bold:"Bold",underline:"Underline",italic:"Italic",forecolor:"Color",bgcolor:"Backcolor",strikethrough:"Strikethrough",eraser:"Eraser",source:"Codeview",quote:"Quote",fontfamily:"Font family",fontsize:"Font size",head:"Head",orderlist:"Ordered list",unorderlist:"Unordered list",alignleft:"Align left",aligncenter:"Align center",alignright:"Align right",link:"Insert link",text:"Text",submit:"Submit",cancel:"Cancel",unlink:"Unlink",table:"Table",emotion:"Emotions",img:"Image",video:"Video",width:"width",height:"height",location:"Location",loading:"Loading",searchlocation:"search",dynamicMap:"Dynamic",clearLocation:"Clear",langDynamicOneLocation:"Only one location in dynamic map",insertcode:"Insert Code",undo:"Undo",redo:"Redo",fullscreen:"Full screnn",openLink:"open link"}}),b(function(a,b){a.config={},a.config.zindex=1e4,a.config.printLog=!0,a.config.menuFixed=0,a.config.jsFilter=!0,a.config.legalTags="p,h1,h2,h3,h4,h5,h6,blockquote,table,ul,ol,pre",a.config.lang=a.langs["zh-cn"],a.config.menus=["source","|","bold","underline","italic","strikethrough","eraser","forecolor","bgcolor","|","quote","fontfamily","fontsize","head","unorderlist","orderlist","alignleft","aligncenter","alignright","|","link","unlink","table","emotion","|","img","video","location","insertcode","|","undo","redo","fullscreen"],a.config.colors={"#880000":"暗红色","#800080":"紫色","#ff0000":"红色","#ff00ff":"鲜粉色","#000080":"深蓝色","#0000ff":"蓝色","#00ffff":"湖蓝色","#008080":"蓝绿色","#008000":"绿色","#808000":"橄榄色","#00ff00":"浅绿色","#ffcc00":"橙黄色","#808080":"灰色","#c0c0c0":"银色","#000000":"黑色","#ffffff":"白色"},a.config.familys=["宋体","黑体","楷体","微软雅黑","Arial","Verdana","Georgia","Times New Roman","Microsoft JhengHei","Trebuchet MS","Courier New","Impact","Comic Sans MS","Consolas"],a.config.fontsizes={1:"12px",2:"13px",3:"16px",4:"18px",5:"24px",6:"32px",7:"48px"},a.config.emotionsShow="icon",a.config.emotions={weibo:{title:"微博表情",data:[{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/7a/shenshou_thumb.gif",value:"[草泥马]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/60/horse2_thumb.gif",value:"[神马]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/bc/fuyun_thumb.gif",value:"[浮云]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/c9/geili_thumb.gif",value:"[给力]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/f2/wg_thumb.gif",value:"[围观]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/70/vw_thumb.gif",value:"[威武]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/6e/panda_thumb.gif",value:"[熊猫]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/81/rabbit_thumb.gif",value:"[兔子]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/bc/otm_thumb.gif",value:"[奥特曼]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/15/j_thumb.gif",value:"[囧]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/89/hufen_thumb.gif",value:"[互粉]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/c4/liwu_thumb.gif",
value:"[礼物]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/ac/smilea_thumb.gif",value:"[呵呵]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/0b/tootha_thumb.gif",value:"[哈哈]"}]}},a.config.mapAk="TVhjYjq1ICT2qqL5LdS8mwas",a.config.uploadImgUrl="",a.config.uploadTimeout=2e4,a.config.uploadImgFns={},a.config.customUpload=!1,a.config.uploadParams={},a.config.uploadHeaders={},a.config.hideLinkImg=!1,a.config.pasteFilter=!0,a.config.pasteText=!1,a.config.codeDefaultLang="javascript"}),b(function(a,b){a.UI={},a.UI.menus={"default":{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-command"></i></a>',selected:".selected"},bold:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-bold"></i></a>',selected:".selected"},underline:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-underline"></i></a>',selected:".selected"},italic:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-italic"></i></a>',selected:".selected"},forecolor:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-pencil"></i></a>',selected:".selected"},bgcolor:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-brush"></i></a>',selected:".selected"},strikethrough:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-strikethrough"></i></a>',selected:".selected"},eraser:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-eraser"></i></a>',selected:".selected"},quote:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-quotes-left"></i></a>',selected:".selected"},source:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-code"></i></a>',selected:".selected"},fontfamily:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-font2"></i></a>',selected:".selected"},fontsize:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-text-height"></i></a>',selected:".selected"},head:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-header"></i></a>',selected:".selected"},orderlist:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-list-numbered"></i></a>',selected:".selected"},unorderlist:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-list-bullet"></i></a>',selected:".selected"},alignleft:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-align-left"></i></a>',selected:".selected"},aligncenter:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-align-center"></i></a>',selected:".selected"},alignright:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-align-right"></i></a>',selected:".selected"},link:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-link"></i></a>',selected:".selected"},unlink:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-unlink"></i></a>',selected:".selected"},table:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-table"></i></a>',selected:".selected"},emotion:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-happy"></i></a>',selected:".selected"},img:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-picture"></i></a>',selected:".selected"},video:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-play"></i></a>',selected:".selected"},location:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-location"></i></a>',selected:".selected"},insertcode:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-terminal"></i></a>',selected:".selected"},undo:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-ccw"></i></a>',selected:".selected"},redo:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-cw"></i></a>',selected:".selected"},fullscreen:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-enlarge2"></i></a>',selected:'<a href="#" tabindex="-1" class="selected"><i class="wangeditor-menu-img-shrink2"></i></a>'}}}),b(function(a,b){a.fn.initDefaultConfig=function(){var c=this;c.config=b.extend({},a.config),c.UI=b.extend({},a.UI)}}),b(function(a,b){a.fn.addEditorContainer=function(){this.$editorContainer=b('<div class="wangEditor-container"></div>')}}),b(function(a,b){a.fn.addTxt=function(){var b=this,c=new a.Txt(b);b.txt=c}}),b(function(a,b){a.fn.addMenuContainer=function(){var b=this;b.menuContainer=new a.MenuContainer(b)}}),b(function(a,b){a.createMenuFns=[],a.createMenu=function(b){a.createMenuFns.push(b)},a.fn.addMenus=function(){function c(a){return e.indexOf(a)>=0}var d=this,e=d.config.menus;b.each(a.createMenuFns,function(a,b){b.call(d,c)})}}),b(function(a,b){a.createMenu(function(b){var c="bold";if(b(c)){var d=this,e=d.config.lang,f=new a.Menu({editor:d,id:c,title:e.bold,commandName:"Bold"});f.clickEventSelected=function(a){var b=d.isRangeEmpty();b?d.commandForElem("b,strong,h1,h2,h3,h4,h5",a,"Bold"):d.command(a,"Bold")},d.menus[c]=f}})}),b(function(a,b){a.createMenu(function(b){var c="underline";if(b(c)){var d=this,e=d.config.lang,f=new a.Menu({editor:d,id:c,title:e.underline,commandName:"Underline"});f.clickEventSelected=function(a){var b=d.isRangeEmpty();b?d.commandForElem("u,a",a,"Underline"):d.command(a,"Underline")},d.menus[c]=f}})}),b(function(a,b){a.createMenu(function(b){var c="italic";if(b(c)){var d=this,e=d.config.lang,f=new a.Menu({editor:d,id:c,title:e.italic,commandName:"Italic"});f.clickEventSelected=function(a){var b=d.isRangeEmpty();b?d.commandForElem("i",a,"Italic"):d.command(a,"Italic")},d.menus[c]=f}})}),b(function(a,b){a.createMenu(function(c){var d="forecolor";if(c(d)){var e=this,f=e.config.lang,g=e.config.colors,h=new a.Menu({editor:e,id:d,title:f.forecolor}),i=b("<div></div>");b.each(g,function(a,b){i.append(['<a href="#" class="color-item"','    title="'+b+'" commandValue="'+a+'" ','    style="color: '+a+'" ','><i class="wangeditor-menu-img-pencil"></i></a>'].join(""))}),i.on("click","a[commandValue]",function(a){var c=b(this),d=c.attr("commandValue");h.selected&&e.isRangeEmpty()?e.commandForElem("font[color]",a,"forecolor",d):e.command(a,"forecolor",d)}),h.dropPanel=new a.DropPanel(e,h,{$content:i,width:125}),h.updateSelectedEvent=function(){var a=e.getRangeElem();return a=e.getSelfOrParentByName(a,"font[color]"),!!a},e.menus[d]=h}})}),b(function(a,b){a.createMenu(function(c){function d(a){var b;return!!(a&&a.style&&null!=a.style.cssText&&(b=a.style.cssText,b&&b.indexOf("background-color:")>=0))}var e="bgcolor";if(c(e)){var f=this,g=f.config.lang,h=f.config.colors,i=new a.Menu({editor:f,id:e,title:g.bgcolor}),j=b("<div></div>");b.each(h,function(a,b){j.append(['<a href="#" class="color-item"','    title="'+b+'" commandValue="'+a+'" ','    style="color: '+a+'" ','><i class="wangeditor-menu-img-brush"></i></a>'].join(""))}),j.on("click","a[commandValue]",function(a){var c=b(this),e=c.attr("commandValue");i.selected&&f.isRangeEmpty()?f.commandForElem({selector:"span,font",check:d},a,"BackColor",e):f.command(a,"BackColor",e)}),i.dropPanel=new a.DropPanel(f,i,{$content:j,width:125}),i.updateSelectedEvent=function(){var a=f.getRangeElem();return a=f.getSelfOrParentByName(a,"span,font",d),!!a},f.menus[e]=i}})}),b(function(a,b){a.createMenu(function(b){var c="strikethrough";if(b(c)){var d=this,e=d.config.lang,f=new a.Menu({editor:d,id:c,title:e.strikethrough,commandName:"StrikeThrough"});f.clickEventSelected=function(a){var b=d.isRangeEmpty();b?d.commandForElem("strike",a,"StrikeThrough"):d.command(a,"StrikeThrough")},d.menus[c]=f}})}),b(function(a,b){a.createMenu(function(c){var d="eraser";if(c(d)){var e=this,f=e.config.lang,g=new a.Menu({editor:e,id:d,title:f.eraser,commandName:"RemoveFormat"});g.clickEvent=function(a){function c(){var a,c,d,e,f,h,i,j=this;a=j.getRangeElem(),e=j.getSelfOrParentByName(a,"blockquote"),e&&(f=b(e),g=b("<p>"+f.text()+"</p>"),f.after(g).remove()),c=j.getSelfOrParentByName(a,"p,h1,h2,h3,h4,h5"),c&&(d=b(c),g=b("<p>"+d.text()+"</p>"),d.after(g).remove()),h=j.getSelfOrParentByName(a,"ul,ol"),h&&(i=b(h),g=b("<p>"+i.text()+"</p>"),i.after(g).remove())}function d(){var a=this;g&&a.restoreSelectionByElem(g.get(0))}var f=e.isRangeEmpty();if(!f)return void e.command(a,"RemoveFormat");var g;e.customCommand(a,c,d)},e.menus[d]=g}})}),b(function(a,b){a.createMenu(function(c){function d(){var a=i.$codeTextarea,c=g.txt.$txt,d=b.trim(a.val());d||(d="<p><br></p>"),g.config.jsFilter&&(d=d.replace(/<script[\s\S]*?<\/script>/gi,"")),c.html(d)}var e="source";if(c(e)){var f,g=this,h=g.config.lang,i=new a.Menu({editor:g,id:e,title:h.source});i.isShowCode=!1,i.clickEvent=function(a){var c=this,d=c.editor,e=d.txt.$txt,g=e.outerHeight(),h=e.height();c.$codeTextarea||(c.$codeTextarea=b('<textarea class="code-textarea"></textarea>'));var j=c.$codeTextarea;j.css({height:h,"margin-top":g-h}),j.val(e.html()),e.after(j).hide(),j.show(),i.isShowCode=!0,this.updateSelected(),d.disableMenusExcept("source"),f=e.html()},i.clickEventSelected=function(a){var b=this,c=b.editor,e=c.txt.$txt,g=b.$codeTextarea;g&&(d(),g.after(e).hide(),e.show(),i.isShowCode=!1,this.updateSelected(),c.enableMenusExcept("source"),e.html()!==f&&c.onchange&&"function"==typeof c.onchange&&c.onchange.call(c))},i.updateSelectedEvent=function(){return this.isShowCode},g.menus[e]=i}})}),b(function(a,b){a.createMenu(function(c){var d="quote";if(c(d)){var e=this,f=e.config.lang,g=new a.Menu({editor:e,id:d,title:f.quote,commandName:"formatBlock",commandValue:"blockquote"});g.clickEvent=function(a){function c(){h=b("<p>"+f.text()+"</p>"),f.after(h).remove(),h.wrap("<blockquote>")}function d(){var a=this;h&&a.restoreSelectionByElem(h.get(0))}var f,g=e.getRangeElem();if(!g)return void a.preventDefault();var h,i=e.getSelfOrParentByName(g,"blockquote");return i?void a.preventDefault():(g=e.getLegalTags(g),f=b(g),f.text()?g?void e.customCommand(a,c,d):void e.command(a,"formatBlock","blockquote"):void 0)},g.clickEventSelected=function(a){function c(){var a,c;if(a=b(g),c=a.children(),c.length)return c.each(function(c){var d=b(this);"P"===d.get(0).nodeName?a.after(d):a.after("<p>"+d.text()+"</p>"),h=d}),void a.remove()}function d(){var a=this;h&&a.restoreSelectionByElem(h.get(0))}var f,g,h;return f=e.getRangeElem(),(g=e.getSelfOrParentByName(f,"blockquote"))?void e.customCommand(a,c,d):void a.preventDefault()},g.updateSelectedEvent=function(){var a,b=this,c=b.editor;return a=c.getRangeElem(),a=c.getSelfOrParentByName(a,"blockquote"),!!a},e.menus[d]=g,e.ready(function(){var a=this,c=a.txt.$txt,d=!1;c.on("keydown",function(c){if(13!==c.keyCode)return void(d=!1);var e=a.getRangeElem();if(e=a.getSelfOrParentByName(e,"blockquote"),!e)return void(d=!1);if(!d)return void(d=!0);var f=a.getRangeElem(),g=b(f);g.length&&g.parent().after(g),a.restoreSelectionByElem(f,"start"),d=!1,c.preventDefault()})}),e.ready(function(){function a(){d&&d.remove()}function c(){if(d){var a=d.prev();a.length?e.restoreSelectionByElem(a.get(0)):e.initSelection()}}var d,e=this,f=e.txt.$txt;f.on("keydown",function(f){if(8===f.keyCode){var g=e.getRangeElem();if(g=e.getSelfOrParentByName(g,"blockquote")){d=b(g);var h=d.text();h||e.customCommand(f,a,c)}}})})}})}),b(function(a,b){a.createMenu(function(c){var d="fontfamily";if(c(d)){var e=this,f=e.config.lang,g=e.config.familys,h=new a.Menu({editor:e,id:d,title:f.fontfamily,commandName:"fontName"}),i={};b.each(g,function(a,b){i[b]=b});var j='<span style="font-family:{#commandValue};">{#title}</span>';h.dropList=new a.DropList(e,h,{data:i,tpl:j,selectorForELemCommand:"font[face]"}),h.updateSelectedEvent=function(){var a=e.getRangeElem();return a=e.getSelfOrParentByName(a,"font[face]"),!!a},e.menus[d]=h}})}),b(function(a,b){a.createMenu(function(b){var c="fontsize";if(b(c)){var d=this,e=d.config.lang,f=d.config.fontsizes,g=new a.Menu({editor:d,id:c,title:e.fontsize,commandName:"fontSize"}),h=f,i='<span style="font-size:{#title};">{#title}</span>';g.dropList=new a.DropList(d,g,{data:h,tpl:i,selectorForELemCommand:"font[size]"}),g.updateSelectedEvent=function(){var a=d.getRangeElem();return a=d.getSelfOrParentByName(a,"font[size]"),!!a},d.menus[c]=g}})}),b(function(a,b){a.createMenu(function(b){function c(a){g.queryCommandState("InsertOrderedList")?(f=!0,g.command(a,"InsertOrderedList")):f=!1}function d(a){f&&g.command(a,"InsertOrderedList")}var e="head";if(b(e)){var f,g=this,h=g.config.lang,i=new a.Menu({editor:g,id:e,title:h.head,commandName:"formatBlock"}),j={"<h1>":"标题1","<h2>":"标题2","<h3>":"标题3","<h4>":"标题4","<h5>":"标题5"},k="{#commandValue}{#title}";i.dropList=new a.DropList(g,i,{data:j,tpl:k,beforeEvent:c,afterEvent:d}),i.updateSelectedEvent=function(){var a=g.getRangeElem();return a=g.getSelfOrParentByName(a,"h1,h2,h3,h4,h5"),!!a},g.menus[e]=i}})}),b(function(a,b){a.createMenu(function(b){var c="unorderlist";if(b(c)){var d=this,e=d.config.lang,f=new a.Menu({editor:d,id:c,title:e.unorderlist,commandName:"InsertUnorderedList"});d.menus[c]=f}})}),b(function(a,b){a.createMenu(function(b){var c="orderlist";if(b(c)){var d=this,e=d.config.lang,f=new a.Menu({editor:d,id:c,title:e.orderlist,commandName:"InsertOrderedList"});d.menus[c]=f}})}),b(function(a,b){a.createMenu(function(c){var d="alignleft";if(c(d)){var e=this,f=e.config.lang,g=new a.Menu({editor:e,id:d,title:f.alignleft,commandName:"JustifyLeft"});g.updateSelectedEvent=function(){var a=e.getRangeElem();return a=e.getSelfOrParentByName(a,"p,h1,h2,h3,h4,h5,li",function(a){var c;return!!(a&&a.style&&null!=a.style.cssText&&(c=a.style.cssText,c&&/text-align:\s*left;/.test(c)))||"left"===b(a).attr("align")}),!!a},e.menus[d]=g}})}),b(function(a,b){a.createMenu(function(c){var d="aligncenter";if(c(d)){var e=this,f=e.config.lang,g=new a.Menu({editor:e,id:d,title:f.aligncenter,commandName:"JustifyCenter"});g.updateSelectedEvent=function(){var a=e.getRangeElem();return a=e.getSelfOrParentByName(a,"p,h1,h2,h3,h4,h5,li",function(a){var c;return!!(a&&a.style&&null!=a.style.cssText&&(c=a.style.cssText,c&&/text-align:\s*center;/.test(c)))||"center"===b(a).attr("align")}),!!a},e.menus[d]=g}})}),b(function(a,b){a.createMenu(function(c){var d="alignright";if(c(d)){var e=this,f=e.config.lang,g=new a.Menu({editor:e,id:d,title:f.alignright,commandName:"JustifyRight"});g.updateSelectedEvent=function(){var a=e.getRangeElem();return a=e.getSelfOrParentByName(a,"p,h1,h2,h3,h4,h5,li",function(a){var c;return!!(a&&a.style&&null!=a.style.cssText&&(c=a.style.cssText,c&&/text-align:\s*right;/.test(c)))||"right"===b(a).attr("align")}),!!a},e.menus[d]=g}})}),b(function(a,b){a.createMenu(function(c){var d="link";if(c(d)){var e=this,f=e.config.lang,g=new a.Menu({editor:e,id:d,title:f.link}),h=b("<div></div>"),i=b('<div style="margin:20px 10px;" class="clearfix"></div>'),j=i.clone(),k=i.clone().css("margin","0 10px"),l=b('<input type="text" class="block" placeholder="'+f.text+'"/>'),m=b('<input type="text" class="block" placeholder="'+f.link+'"/>'),n=b('<button class="right">'+f.submit+"</button>"),o=b('<button class="right gray">'+f.cancel+"</button>");i.append(l),j.append(m),k.append(n).append(o),h.append(i).append(j).append(k),g.dropPanel=new a.DropPanel(e,g,{$content:h,width:300}),g.clickEvent=function(a){var b=this,c=b.dropPanel;if(c.isShowing)return void c.hide();l.val(""),m.val("http://");var d="",f=e.getRangeElem();f=e.getSelfOrParentByName(f,"a"),f&&(d=f.href||"");var g="",h=e.isRangeEmpty();h?f&&(g=f.textContent||f.innerHTML):g=e.getRangeText()||"",d&&m.val(d),g&&l.val(g),h?l.removeAttr("disabled"):l.attr("disabled",!0),c.show()},g.updateSelectedEvent=function(){var a=e.getRangeElem();return a=e.getSelfOrParentByName(a,"a"),!!a},o.click(function(a){a.preventDefault(),g.dropPanel.hide()}),n.click(function(c){c.preventDefault();var d,f,h,i,j,k,n=e.getRangeElem(),o=e.getSelfOrParentByName(n,"a"),p=e.isRangeEmpty(),q=e.txt.$txt,r="link"+a.random(),s=b.trim(m.val()),t=b.trim(l.val());return s?(t||(t=s),void(p?o?(d=b(o),h=function(){d.attr("href",s),d.text(t)},i=function(){var a=this;a.restoreSelectionByElem(o)},e.customCommand(c,h,i)):(f='<a href="'+s+'" target="_blank">'+t+"</a>",a.userAgent.indexOf("Firefox")>0&&(f+="<span>&nbsp;</span>"),e.command(c,"insertHtml",f)):(j=q.find("a"),j.attr(r,"1"),e.command(c,"createLink",s),k=q.find("a").not("["+r+"]"),k.attr("target","_blank"),j.removeAttr(r)))):void g.dropPanel.focusFirstInput()}),e.menus[d]=g}})}),b(function(a,b){a.createMenu(function(c){var d="unlink";if(c(d)){var e=this,f=e.config.lang,g=new a.Menu({editor:e,id:d,title:f.unlink,commandName:"unLink"});g.clickEvent=function(a){function c(){i.after(j).remove()}function d(){e.restoreSelectionByElem(j.get(0))}var f=e.isRangeEmpty();if(!f)return void e.command(a,"unLink");var g=e.getRangeElem(),h=e.getSelfOrParentByName(g,"a");if(!h)return void a.preventDefault();var i=b(h),j=b("<span>"+i.text()+"</span>");e.customCommand(a,c,d)},e.menus[d]=g}})}),b(function(a,b){a.createMenu(function(c){var d="table";if(c(d)){var e,f,g,h=this,i=h.config.lang,j=new a.Menu({editor:h,id:d,title:i.table}),k=b('<div style="font-size: 14px; color: #666; text-align:right;"></div>'),l=b('<table class="choose-table" style="margin-bottom:10px;margin-top:5px;">'),m=b("<span>0</span>"),n=b("<span> 行 </span>"),o=b("<span>0</span>"),p=b("<span> 列</span>");for(f=0;f<15;f++){for(e=b('<tr index="'+(f+1)+'">'),g=0;g<20;g++)e.append(b('<td index="'+(g+1)+'">'));l.append(e)}k.append(l),k.append(m).append(n).append(o).append(p),l.on("mouseenter","td",function(a){var c=b(a.currentTarget),d=c.attr("index"),e=c.parent(),f=e.attr("index");m.text(f),o.text(d),l.find("tr").each(function(){var a=b(this),c=a.attr("index");parseInt(c,10)<=parseInt(f,10)?a.find("td").each(function(){var a=b(this),c=a.attr("index");parseInt(c,10)<=parseInt(d,10)?a.addClass("active"):a.removeClass("active")}):a.find("td").removeClass("active")})}).on("mouseleave",function(a){l.find("td").removeClass("active"),m.text(0),o.text(0)}),l.on("click","td",function(a){var c,d,e=b(a.currentTarget),f=e.attr("index"),g=e.parent(),i=g.attr("index"),j=parseInt(i,10),k=parseInt(f,10),l="<table>";for(c=0;c<j;c++){for(l+="<tr>",d=0;d<k;d++)l+="<td><span>&nbsp;</span></td>";l+="</tr>"}l+="</table>",h.command(a,"insertHtml",l)}),j.dropPanel=new a.DropPanel(h,j,{$content:k,width:262}),h.menus[d]=j}})}),b(function(a,b){a.createMenu(function(c){function d(a,c){b.each(a,function(a,d){var e=d.icon||d.url,g=d.value||d.title,h="icon"===j?e:g,i=b('<a href="#" commandValue="'+h+'"></a>'),k=b("<img>");k.attr("_src",e),i.append(k),c.append(i),f.emotionUrls.push(e)})}var e="emotion";if(c(e)){var f=this,g=f.config,h=g.lang,i=g.emotions,j=g.emotionsShow;f.emotionUrls=[];var k=new a.Menu({editor:f,id:e,title:h.emotion}),l=b('<div class="panel-tab"></div>'),m=b('<div class="tab-container"></div>'),n=b('<div class="content-container emotion-content-container"></div>');b.each(i,function(c,e){var f=e.title,g=e.data;a.log("正在处理 "+f+" 表情的数据...");var h=b('<a href="#">'+f+" </a>");m.append(h);var i=b('<div class="content"></div>');if(n.append(i),h.click(function(a){m.children().removeClass("selected"),n.children().removeClass("selected"),i.addClass("selected"),h.addClass("selected"),a.preventDefault()}),"string"==typeof g)a.log("将通过 "+g+" 地址ajax下载表情包"),b.get(g,function(c){c=b.parseJSON(c),a.log("下载完毕，得到 "+c.length+" 个表情"),d(c,i)});else{if(!(Object.prototype.toString.call(g).toLowerCase().indexOf("array")>0))return void a.error("data 数据格式错误，请修改为正确格式，参考文档："+a.docsite);d(g,i)}}),l.append(m).append(n),m.children().first().addClass("selected"),n.children().first().addClass("selected"),n.on("click","a[commandValue]",function(a){var c=b(a.currentTarget),d=c.attr("commandValue");"icon"===j?f.command(a,"InsertImage",d):f.command(a,"insertHtml","<span>"+d+"</span>"),a.preventDefault()}),k.dropPanel=new a.DropPanel(f,k,{$content:l,width:350}),k.clickEvent=function(c){var d=this,e=d.dropPanel;return e.isShowing?void e.hide():(e.show(),void(d.imgLoaded||(n.find("img").each(function(){var c=b(this),d=c.attr("_src");c.on("error",function(){a.error("加载不出表情图片 "+d)}),c.attr("src",d),c.removeAttr("_src")}),d.imgLoaded=!0)))},f.menus[e]=k}})}),b(function(a,b){function c(a,c,d){function e(){h.val("")}var f=a.config.lang,g=b('<div style="margin:20px 10px 10px 10px;"></div>'),h=b('<input type="text" class="block" placeholder="http://"/>');g.append(h);var i=b('<button class="right">'+f.submit+"</button>"),j=b('<button class="right gray">'+f.cancel+"</button>");d.append(g).append(i).append(j),j.click(function(a){a.preventDefault(),c.dropPanel.hide()}),i.click(function(c){c.preventDefault();var d=b.trim(h.val());if(!d)return void h.focus();var f='<img style="max-width:100%;" src="'+d+'"/>';a.command(c,"insertHtml",f,e)})}a.createMenu(function(d){function e(){o.click(function(a){m.children().removeClass("selected"),n.children().removeClass("selected"),q.addClass("selected"),o.addClass("selected"),a.preventDefault()}),p.click(function(b){m.children().removeClass("selected"),n.children().removeClass("selected"),r.addClass("selected"),p.addClass("selected"),b.preventDefault(),a.placeholder&&r.find("input[type=text]").focus()}),o.click()}function f(){m.remove(),q.remove(),r.addClass("selected")}function g(){m.remove(),r.remove(),q.addClass("selected")}var h="img";if(d(h)){var i=this,j=i.config.lang,k=new a.Menu({editor:i,id:h,title:j.img}),l=b('<div class="panel-tab"></div>'),m=b('<div class="tab-container"></div>'),n=b('<div class="content-container"></div>');l.append(m).append(n);var o=b('<a href="#">上传图片</a>'),p=b('<a href="#">网络图片</a>');m.append(o).append(p);var q=b('<div class="content"></div>');n.append(q);var r=b('<div class="content"></div>');n.append(r),c(i,k,r),k.dropPanel=new a.DropPanel(i,k,{$content:l,width:400,onRender:function(){var a=i.config.customUploadInit;a&&a.call(i)}}),i.menus[h]=k,i.ready(function(){function a(){k.dropPanel.hide()}var b=this,c=b.config,d=c.uploadImgUrl,h=c.customUpload,i=c.hideLinkImg;d||h?(b.$uploadContent=q,e(),i&&g()):f(),q.click(function(){setTimeout(a)})})}})}),b(function(a,b){a.createMenu(function(c){var d="video";if(c(d)){var e=this,f=e.config.lang,g=/^<(iframe)|(embed)/i,h=new a.Menu({editor:e,id:d,title:f.video}),i=b("<div></div>"),j=b('<div style="margin:20px 10px;"></div>'),k=b('<input type="text" class="block" placeholder=\'格式如：<iframe src="..." frameborder=0 allowfullscreen></iframe>\'/>');j.append(k);var l=b('<div style="margin:20px 10px;"></div>'),m=b('<input type="text" value="640" style="width:50px;text-align:center;"/>'),n=b('<input type="text" value="498" style="width:50px;text-align:center;"/>');l.append("<span> "+f.width+" </span>").append(m).append("<span> px &nbsp;&nbsp;&nbsp;</span>").append("<span> "+f.height+" </span>").append(n).append("<span> px </span>");var o=b("<div></div>"),p=b('<a href="http://www.kancloud.cn/wangfupeng/wangeditor2/134973" target="_blank" style="display:inline-block;margin-top:10px;margin-left:10px;color:#999;">如何复制视频链接？</a>'),q=b('<button class="right">'+f.submit+"</button>"),r=b('<button class="right gray">'+f.cancel+"</button>");o.append(p).append(q).append(r),i.append(j).append(l).append(o),r.click(function(a){a.preventDefault(),k.val(""),h.dropPanel.hide()}),q.click(function(a){a.preventDefault();var c,d=b.trim(k.val()),f=parseInt(m.val()),i=parseInt(n.val()),j=b("<div>"),l="<p>{content}</p>";return d?g.test(d)?isNaN(f)||isNaN(i)?void alert("宽度或高度不是数字！"):(c=b(d),c.attr("width",f).attr("height",i),l=l.replace("{content}",j.append(c).html()),e.command(a,"insertHtml",l),void k.val("")):(alert("视频链接格式错误！"),void h.dropPanel.focusFirstInput()):void h.dropPanel.focusFirstInput()}),h.dropPanel=new a.DropPanel(e,h,{$content:i,width:400}),e.menus[d]=h}})}),b(function(a,b){var c=function(a){return"onkeyup"in a}(document.createElement("input"));a.baiduMapAk="TVhjYjq1ICT2qqL5LdS8mwas",a.numberOfLocation=0,a.createMenu(function(d){function e(){q.val("")}var f="location";if(d(f)){if(++a.numberOfLocation>1)return void a.error("目前不支持在一个页面多个编辑器上同时使用地图，可通过自定义菜单配置去掉地图菜单");var g=this,h=g.config,i=h.lang,j=h.mapAk;g.mapData={};var k=g.mapData;k.markers=[],k.mapContainerId="map"+a.random(),k.clearLocations=function(){var a=k.map;a&&(a.clearOverlays(),k.markers=[])},k.searchMap=function(){var a=k.map;if(a){var b,c,d=window.BMap,e=p.val(),f=q.val();""!==e&&(f&&""!==f||a.centerAndZoom(e,11),f&&""!==f&&(b=new d.Geocoder,b.getPoint(f,function(b){b?(a.centerAndZoom(b,13),c=new d.Marker(b),a.addOverlay(c),c.enableDragging(),k.markers.push(c)):a.centerAndZoom(e,11)},e)))}};var l=!1;window.baiduMapCallBack=function(){function b(b){var d=b.name;e.setCenter(d),p.val(d),a.placeholder&&q.focus();var f,_g;c?(_g=function(a){"keyup"===a.type&&13===a.keyCode&&a.preventDefault(),f&&clearTimeout(f),f=setTimeout(k.searchMap,500)},p.on("keyup change paste",_g),q.on("keyup change paste",_g)):(_g=function(){if(!n.is(":visible"))return void clearTimeout(f);var a="",b="",c=p.val(),d=q.val();c===a&&d===b||(k.searchMap(),a=c,b=d),f&&clearTimeout(f),f=setTimeout(_g,1e3)},f=setTimeout(_g,1e3))}if(!l){l=!0;var d=window.BMap;k.map||(k.map=new d.Map(k.mapContainerId));var e=k.map;e.centerAndZoom(new d.Point(116.404,39.915),11),e.addControl(new d.MapTypeControl),e.setCurrentCity("北京"),e.enableScrollWheelZoom(!0);var f=new d.LocalCity;f.get(b),e.addEventListener("click",function(a){var b=new d.Marker(new d.Point(a.point.lng,a.point.lat));e.addOverlay(b),b.enableDragging(),k.markers.push(b)},!1)}},k.loadMapScript=function(){var b=document.createElement("script");b.type="text/javascript",b.src="https://api.map.baidu.com/api?v=2.0&ak="+j+"&s=1&callback=baiduMapCallBack";try{document.body.appendChild(b)}catch(c){a.error("加载地图过程中发生错误")}},k.initMap=function(){window.BMap?window.baiduMapCallBack():k.loadMapScript()};var m=new a.Menu({editor:g,id:f,title:i.location});g.menus[f]=m;var n=b("<div></div>"),o=b('<div style="margin:10px 0;"></div>'),p=b('<input type="text"/>');p.css({width:"80px","text-align":"center"});var q=b('<input type="text"/>');q.css({width:"300px","margin-left":"10px"}).attr("placeholder",i.searchlocation);var r=b('<button class="right link">'+i.clearLocation+"</button>");o.append(r).append(p).append(q),n.append(o),r.click(function(a){q.val(""),q.focus(),k.clearLocations(),a.preventDefault()});var s=b('<div id="'+k.mapContainerId+'"></div>');s.css({height:"260px",width:"100%",position:"relative","margin-top":"10px",border:"1px solid #f1f1f1"});var t=b("<span>"+i.loading+"</span>");t.css({position:"absolute",width:"100px","text-align":"center",top:"45%",left:"50%","margin-left":"-50px"}),s.append(t),n.append(s);var u=b('<div style="margin:10px 0;"></div>'),v=b('<button class="right">'+i.submit+"</button>"),w=b('<button class="right gray">'+i.cancel+"</button>"),x=b('<label style="display:inline-block;margin-top:10px;color:#666;"></label>'),y=b('<input type="checkbox">');x.append(y).append('<span style="display:inline-block;margin-left:5px;">  '+i.dynamicMap+"</span>"),u.append(x).append(v).append(w),n.append(u),w.click(function(a){a.preventDefault(),e(),m.dropPanel.hide()}),v.click(function(a){a.preventDefault();var c,d,f,h=k.map,j=y.is(":checked"),l=k.markers,m=h.getCenter(),n=m.lng,o=m.lat,p=h.getZoom(),q=h.getSize(),r=q.width,s=q.height;if(d=j?"http://ueditor.baidu.com/ueditor/dialogs/map/show.html#":"http://api.map.baidu.com/staticimage?",d=d+"center="+n+","+o+"&zoom="+p+"&width="+r+"&height="+s,l.length>0&&(d+="&markers=",b.each(l,function(a,b){c=b.getPosition(),a>0&&(d+="|"),d=d+c.lng+","+c.lat})),j){if(l.length>1)return void alert(i.langDynamicOneLocation);d+="&markerStyles=l,A",f='<iframe class="ueditor_baidumap" src="{src}" frameborder="0" width="'+r+'" height="'+s+'"></iframe>',f=f.replace("{src}",d),g.command(a,"insertHtml",f,e)}else g.command(a,"insertHtml",'<img style="max-width:100%;" src="'+d+'"/>',e)}),m.dropPanel=new a.DropPanel(g,m,{$content:n,width:500}),m.onRender=function(){j===a.baiduMapAk&&a.warn("建议在配置中自定义百度地图的mapAk，否则可能影响地图功能，文档："+a.docsite)},m.clickEvent=function(a){var b=this,c=b.dropPanel,d=!1;return c.isShowing?void c.hide():(k.map||(d=!0),c.show(),k.initMap(),void(d||q.focus()))}}})}),b(function(a,b){function c(){if(!(a.userAgent.indexOf("MSIE 8")>0||window.hljs)){var b=document.createElement("script");b.type="text/javascript",b.src="//cdn.bootcss.com/highlight.js/9.2.0/highlight.min.js",document.body.appendChild(b)}}a.createMenu(function(d){function e(a){var c=b("<div></div>");c.css({margin:"15px 5px 5px 5px",height:"160px","text-align":"center"}),n.css({width:"100%",height:"100%",padding:"10px"}),n.on("keydown",function(a){9===a.keyCode&&a.preventDefault()}),c.append(n),a.append(c);var d=b("<div></div>"),e=b('<button class="right">'+j.submit+"</button>"),f=b('<button class="right gray">'+j.cancel+"</button>");d.append(e).append(f).append(o),a.append(d),f.click(function(a){a.preventDefault(),l.dropPanel.hide()});var g='<pre style="max-width:100%;overflow-x:auto;"><code{#langClass}>{#content}</code></pre>';e.click(function(a){function c(){var a;i&&(a=q.attr("class"),a!==i+" hljs"&&q.attr("class",i+" hljs")),q.html(e)}function d(){h.restoreSelectionByElem(r),m()}a.preventDefault();var e=n.val();if(!e)return void n.focus();var f=h.getRangeElem();b.trim(b(f).text())&&0!==g.indexOf("<p><br></p>")&&(g="<p><br></p>"+g);var i=o?o.val():"",j="",m=function(){k.find("pre code").each(function(a,c){var d=b(c);d.attr("codemark")||window.hljs&&(window.hljs.highlightBlock(c),d.attr("codemark","1"))})};if(i&&(j=' class="'+i+' hljs"'),e=e.replace(/&/gm,"&amp;").replace(/</gm,"&lt;").replace(/>/gm,"&gt;"),!l.selected){var p=g.replace("{#langClass}",j).replace("{#content}",e);return void h.command(a,"insertHtml",p,m)}var q,r=h.getSelfOrParentByName(f,"pre");r&&(r=h.getSelfOrParentByName(f,"code")),r&&(q=b(r),h.customCommand(a,c,d))})}function f(){var a=h.getRangeElem(),b=h.getSelfOrParentByName(a,"code");b?h.disableMenusExcept("insertcode"):h.enableMenusExcept("insertcode")}var g="insertcode";if(d(g)){setTimeout(c,0);var h=this,i=h.config,j=i.lang,k=h.txt.$txt,l=new a.Menu({editor:h,id:g,title:j.insertcode});l.clickEvent=function(a){var c=this,d=c.dropPanel;if(d.isShowing)return void d.hide();n.val(""),d.show();var e=window.hljs;if(e&&e.listLanguages){if(0!==o.children().length)return;o.css({"margin-top":"9px","margin-left":"5px"}),b.each(e.listLanguages(),function(a,b){"xml"===b&&(b="html"),b===i.codeDefaultLang?o.append('<option value="'+b+'" selected="selected">'+b+"</option>"):o.append('<option value="'+b+'">'+b+"</option>")})}else o.hide()},l.clickEventSelected=function(a){var c=this,d=c.dropPanel;if(d.isShowing)return void d.hide();d.show();var e,f,g=h.getRangeElem(),i=h.getSelfOrParentByName(g,"pre");i&&(i=h.getSelfOrParentByName(g,"code")),i&&(e=b(i),n.val(e.text()),o&&(f=e.attr("class"),f&&o.val(f.split(" ")[0])))},l.updateSelectedEvent=function(){var a,b=this,c=b.editor;return a=c.getRangeElem(),a=c.getSelfOrParentByName(a,"pre"),!!a};var m=b("<div></div>"),n=b("<textarea></textarea>"),o=b("<select></select>");e(m),l.dropPanel=new a.DropPanel(h,l,{$content:m,width:500}),h.menus[g]=l,k.on("keydown",function(a){if(13===a.keyCode){var b=h.getRangeElem(),c=h.getSelfOrParentByName(b,"code");c&&h.command(a,"insertHtml","\n")}}),k.on("keydown click",function(a){setTimeout(f)})}})}),b(function(a,b){a.createMenu(function(b){var c="undo";if(b(c)){var d=this,e=d.config.lang,f=new a.Menu({editor:d,id:c,title:e.undo});f.clickEvent=function(a){d.undo()},d.menus[c]=f,d.ready(function(){function a(){c.undoRecord()}var b,c=this,d=c.txt.$txt;d.on("keydown",function(d){var e=d.keyCode;return d.ctrlKey&&90===e?void c.undo():void(13===e?a():(b&&clearTimeout(b),b=setTimeout(a,1e3)))}),c.undoRecord()})}})}),b(function(a,b){a.createMenu(function(b){var c="redo";if(b(c)){var d=this,e=d.config.lang,f=new a.Menu({editor:d,id:c,title:e.redo});f.clickEvent=function(a){d.redo()},d.menus[c]=f}})}),b(function(a,b){var c;a.createMenu(function(b){var d="fullscreen";if(b(d)){var e,f,g=this,h=g.txt.$txt,i=g.config,j=i.zindex||1e4,k=i.lang,l=!1,m=new a.Menu({editor:g,id:d,title:k.fullscreen});m.clickEvent=function(b){var d=g.$editorContainer;d.addClass("wangEditor-fullscreen"),e=d.css("z-index"),
d.css("z-index",j);var i,k=h.height(),m=h.outerHeight();g.useMaxHeight&&(f=h.css("max-height"),h.css("max-height","none"),i=h.parent(),i.after(h),i.remove(),h.css("overflow-y","auto"));var n=g.menuContainer;h.height(a.$window.height()-n.height()-(m-k)),g.menuContainer.$menuContainer.attr("style",""),l=!0,g.isFullScreen=!0,c=a.$window.scrollTop()},m.clickEventSelected=function(b){var d=g.$editorContainer;d.removeClass("wangEditor-fullscreen"),d.css("z-index",e),g.useMaxHeight?h.css("max-height",f):g.$valueContainer.css("height",g.valueContainerHeight),g.txt.initHeight(),l=!1,g.isFullScreen=!1,null!=c&&a.$window.scrollTop(c)},m.updateSelectedEvent=function(a){return l},g.menus[d]=m}})}),b(function(a,b){a.fn.renderMenus=function(){var a,c=this,d=c.menus,e=c.config.menus,f=(c.menuContainer,0);b.each(e,function(b,c){return"|"===c?void f++:(a=d[c],void(a&&a.render(f)))})}}),b(function(a,b){a.fn.renderMenuContainer=function(){var a=this,b=a.menuContainer;a.$editorContainer,b.render()}}),b(function(a,b){a.fn.renderTxt=function(){var a=this,b=a.txt;b.render(),a.ready(function(){b.initHeight()})}}),b(function(a,b){a.fn.renderEditorContainer=function(){var a,b,c=this,d=c.$valueContainer,e=c.$editorContainer,f=c.txt.$txt;d===f?(a=c.$prev,b=c.$parent,a&&a.length?a.after(e):b.prepend(e)):(d.after(e),d.hide())}}),b(function(a,b){a.fn.eventMenus=function(){var a=this.menus;b.each(a,function(a,b){b.bindEvent()})}}),b(function(a,b){a.fn.eventMenuContainer=function(){}}),b(function(a,b){a.fn.eventTxt=function(){var a=this.txt;a.saveSelectionEvent(),a.updateValueEvent(),a.updateMenuStyleEvent()}}),b(function(a,b){a.plugin(function(){var b=this,c=b.config.uploadImgFns;c.onload||(c.onload=function(b,c){a.log("上传结束，返回结果为 "+b);var d,e=this,f=e.uploadImgOriginalName||"";0===b.indexOf("error|")?(a.warn("上传失败："+b.split("|")[1]),alert(b.split("|")[1])):(a.log("上传成功，即将插入编辑区域，结果为："+b),d=document.createElement("img"),d.onload=function(){var c='<img src="'+b+'" alt="'+f+'" style="max-width:100%;"/>';e.command(null,"insertHtml",c),a.log("已插入图片，地址 "+b),d=null},d.onerror=function(){a.error("使用返回的结果获取图片，发生错误。请确认以下结果是否正确："+b),d=null},d.src=b)}),c.ontimeout||(c.ontimeout=function(b){a.error("上传图片超时"),alert("上传图片超时")}),c.onerror||(c.onerror=function(b){a.error("上传上图片发生错误"),alert("上传上图片发生错误")})})}),b(function(a,b){window.FileReader&&window.FormData&&a.plugin(function(){function c(a,b){var c,d=window.atob(a.split(",")[1]),e=new ArrayBuffer(d.length),f=new Uint8Array(e);for(c=0;c<d.length;c++)f[c]=d.charCodeAt(c);return new Blob([e],{type:b})}function d(b,c){var d=document.createElement("img");d.onload=function(){var e='<img src="'+b+'" style="max-width:100%;"/>';f.command(c,"insertHtml",e),a.log("已插入图片，地址 "+b),d=null},d.onerror=function(){a.error("使用返回的结果获取图片，发生错误。请确认以下结果是否正确："+b),d=null},d.src=b}function e(a){if(a.lengthComputable){var b=a.loaded/a.total;f.showUploadProgress(100*b)}}var f=this,g=f.config,h=g.uploadImgUrl,i=g.uploadTimeout,j=g.uploadImgFns,k=j.onload,l=j.ontimeout,m=j.onerror;h&&(f.xhrUploadImg=function(g){function j(){y&&clearTimeout(y),z&&z.abort&&z.abort(),n.preventDefault(),u&&u.call(f,z),f.hideUploadProgress()}var n=g.event,o=g.filename||"",p=g.base64,q=g.fileType||"image/png",r=g.name||"wangEditor_upload_file",s=g.loadfn||k,t=g.errorfn||m,u=g.timeoutfn||l,v=f.config.uploadParams||{},w=f.config.uploadHeaders||{},x="png";if(o.indexOf(".")>0?x=o.slice(o.lastIndexOf(".")-o.length+1):q.indexOf("/")>0&&q.split("/")[1]&&(x=q.split("/")[1]),a.isOnWebsite)return a.log("预览模拟上传"),void d(p,n);var y,z=new XMLHttpRequest,A=new FormData;z.onload=function(){y&&clearTimeout(y),f.uploadImgOriginalName=o,o.indexOf(".")>0&&(f.uploadImgOriginalName=o.split(".")[0]),s&&s.call(f,z.responseText,z),f.hideUploadProgress()},z.onerror=function(){y&&clearTimeout(y),n.preventDefault(),t&&t.call(f,z),f.hideUploadProgress()},z.upload.onprogress=e,A.append(r,c(p,q),a.random()+"."+x),b.each(v,function(a,b){A.append(a,b)}),z.open("POST",h,!0),b.each(w,function(a,b){z.setRequestHeader(a,b)}),z.withCredentials=!0,z.send(A),y=setTimeout(j,i),a.log("开始上传...并开始超时计算")})})}),b(function(a,b){a.plugin(function(){function a(){j||(j=!0,i.css({top:f+"px"}),g.append(i))}function c(){i.hide(),k=null}var d=this,e=d.menuContainer,f=e.height(),g=d.$editorContainer,h=g.width(),i=b('<div class="wangEditor-upload-progress"></div>'),j=!1;d.showUploadProgress=function(b){k&&clearTimeout(k),a(),i.show(),i.width(b*h/100)};var k;d.hideUploadProgress=function(a){k&&clearTimeout(k),a=a||750,k=setTimeout(c,a)}})}),b(function(a,b){a.plugin(function(){var c,d=this,e=d.config,f=e.uploadImgUrl,g=e.uploadTimeout;if(f){var h=d.$uploadContent;if(h){var i=b('<div class="upload-icon-container"><i class="wangeditor-menu-img-upload"></i></div>');h.append(i);var j=new a.UploadFile({editor:d,uploadUrl:f,timeout:g,fileAccept:"image/*"});i.click(function(a){c=a,j.selectFiles()})}}})}),b(function(a,b){if(window.FileReader&&window.FormData){var c=function(a){this.editor=a.editor,this.uploadUrl=a.uploadUrl,this.timeout=a.timeout,this.fileAccept=a.fileAccept,this.multiple=!0};c.fn=c.prototype,c.fn.clear=function(){this.$input.val(""),a.log("input value 已清空")},c.fn.render=function(){var c=this;if(!c._hasRender){a.log("渲染dom");var d=c.fileAccept,e=d?'accept="'+d+'"':"",f=c.multiple,g=f?'multiple="multiple"':"",h=b('<input type="file" '+e+" "+g+"/>"),i=b('<div style="visibility:hidden;"></div>');i.append(h),a.$body.append(i),h.on("change",function(a){c.selected(a,h.get(0))}),c.$input=h,c._hasRender=!0}},c.fn.selectFiles=function(){var b=this;a.log("使用 html5 方式上传"),b.render(),a.log("选择文件"),b.$input.click()},c.fn.selected=function(c,d){var e=this,f=d.files||[];0!==f.length&&(a.log("选中 "+f.length+" 个文件"),b.each(f,function(a,b){e.upload(b)}))},c.fn.upload=function(b){function c(){d.clear()}var d=this,e=d.editor,f=b.name||"",g=b.type||"",h=e.config.uploadImgFns,i=e.config.uploadImgFileName||"wangEditorH5File",j=h.onload,k=h.ontimeout,l=h.onerror,m=new FileReader;return j&&k&&l?(a.log("开始执行 "+f+" 文件的上传"),m.onload=function(b){a.log("已读取"+f+"文件");var d=b.target.result||this.result;e.xhrUploadImg({event:b,filename:f,base64:d,fileType:g,name:i,loadfn:function(a,b){c();var d=this;j.call(d,a,b)},errorfn:function(b){c(),a.isOnWebsite&&alert("wangEditor官网暂时没有服务端，因此报错。实际项目中不会发生");var d=this;l.call(d,b)},timeoutfn:function(b){c(),a.isOnWebsite&&alert("wangEditor官网暂时没有服务端，因此超时。实际项目中不会发生");var d=this;k(d,b)}})},void m.readAsDataURL(b)):void a.error("请为编辑器配置上传图片的 onload ontimeout onerror 回调事件")},a.UploadFile=c}}),b(function(a,b){if(!window.FileReader||!window.FormData){var c=function(a){this.editor=a.editor,this.uploadUrl=a.uploadUrl,this.timeout=a.timeout,this.fileAccept=a.fileAccept,this.multiple=!1};c.fn=c.prototype,c.fn.clear=function(){this.$input.val(""),a.log("input value 已清空")},c.fn.hideModal=function(){this.modal.hide()},c.fn.render=function(){var c=this,d=c.editor,e=d.config.uploadImgFileName||"wangEditorFormFile";if(!c._hasRender){var f=c.uploadUrl;a.log("渲染dom");var g="iframe"+a.random(),h=b('<iframe name="'+g+'" id="'+g+'" frameborder="0" width="0" height="0"></iframe>'),i=c.multiple,j=i?'multiple="multiple"':"",k=b("<p>选择图片并上传</p>"),l=b('<input type="file" '+j+' name="'+e+'"/>'),m=b('<input type="submit" value="上传"/>'),n=b('<form enctype="multipart/form-data" method="post" action="'+f+'" target="'+g+'"></form>'),o=b('<div style="margin:10px 20px;"></div>');n.append(k).append(l).append(m),b.each(d.config.uploadParams,function(a,c){n.append(b('<input type="hidden" name="'+a+'" value="'+c+'"/>'))}),o.append(n),o.append(h),c.$input=l,c.$iframe=h;var p=new a.Modal(d,void 0,{$content:o});c.modal=p,c._hasRender=!0}},c.fn.bindLoadEvent=function(){function a(){var a=b.trim(g.document.body.innerHTML);if(a){var e=c.$input.val(),f=e;e.lastIndexOf("\\")>=0&&(f=e.slice(e.lastIndexOf("\\")+1),f.indexOf(".")>0&&(f=f.split(".")[0])),d.uploadImgOriginalName=f,h.call(d,a),c.clear(),c.hideModal()}}var c=this;if(!c._hasBindLoad){var d=c.editor,e=c.$iframe,f=e.get(0),g=f.contentWindow,h=d.config.uploadImgFns.onload;f.attachEvent?f.attachEvent("onload",a):f.onload=a,c._hasBindLoad=!0}},c.fn.show=function(){function a(){c.show(),b.bindLoadEvent()}var b=this,c=b.modal;setTimeout(a)},c.fn.selectFiles=function(){var b=this;a.log("使用 form 方式上传"),b.render(),b.clear(),b.show()},a.UploadFile=c}}),b(function(a,b){a.plugin(function(){function c(){var c=/^data:(image\/\w+);base64/,g=h.find("img");a.log("粘贴后，检查到编辑器有"+g.length+"个图片。开始遍历图片，试图找到刚刚粘贴过来的图片"),b.each(g,function(){var g,h,i=this,j=b(i),l=j.attr("src");e.each(function(){if(i===this)return g=!0,!1}),g||(a.log("找到一个粘贴过来的图片"),c.test(l)?(a.log("src 是 base64 格式，可以上传"),h=l.match(c)[1],f.xhrUploadImg({event:d,base64:l,fileType:h,name:k})):a.log("src 为 "+l+" ，不是 base64 格式，暂时不支持上传"),j.remove())}),a.log("遍历结束")}var d,e,f=this,g=f.txt,h=g.$txt,i=f.config,j=i.uploadImgUrl,k=i.uploadImgFileName||"wangEditorPasteFile";j&&h.on("paste",function(g){d=g;var i,j,l=d.clipboardData||d.originalEvent.clipboardData;i=null==l?window.clipboardData&&window.clipboardData.getData("text"):l.getData("text/plain")||l.getData("text/html"),i||(j=l&&l.items,j?(a.log("通过 data.items 得到了数据"),b.each(j,function(b,c){var e=c.type||"";if(!(e.indexOf("image")<0)){var g=c.getAsFile(),h=new FileReader;a.log("得到一个粘贴图片"),h.onload=function(b){a.log("读取到粘贴的图片");var c=b.target.result||this.result;f.xhrUploadImg({event:d,base64:c,fileType:e,name:k})},h.readAsDataURL(g)}})):(a.log("未从 data.items 得到数据，使用检测粘贴图片的方式"),e=h.find("img"),a.log("粘贴前，检查到编辑器有"+e.length+"个图片"),setTimeout(c,0)))})})}),b(function(a,b){a.plugin(function(){var c=this,d=c.txt,e=d.$txt,f=c.config,g=f.uploadImgUrl,h=f.uploadImgFileName||"wangEditorDragFile";g&&(a.$document.on("dragleave drop dragenter dragover",function(a){a.preventDefault()}),e.on("drop",function(d){d.preventDefault();var e=d.originalEvent,f=e.dataTransfer&&e.dataTransfer.files;f&&f.length&&b.each(f,function(b,e){var f=e.type,g=e.name;if(!(f.indexOf("image/")<0)){a.log("得到图片 "+g);var i=new FileReader;i.onload=function(b){a.log("读取到图片 "+g);var e=b.target.result||this.result;c.xhrUploadImg({event:d,base64:e,fileType:f,name:h})},i.readAsDataURL(e)}})}))})}),b(function(a,b){a.plugin(function(){function c(){l||(d(),m.append(n).append(o).append(p).append(q),h.$editorContainer.append(m),l=!0)}function d(){function a(a,c){b&&h.customCommand(a,b,c)}var b;o.click(function(c){b=function(){g.remove()},a(c,function(){setTimeout(f,100)})}),q.click(function(c){b=function(){g.css({width:"100%"})},a(c,function(){setTimeout(e)})}),p.click(function(c){b=function(){g.css({width:"auto"})},a(c,function(){setTimeout(e)})})}function e(){if(!h._disabled&&null!=g){g.addClass("clicked");var a=g.position(),b=a.top,c=a.left,d=g.outerHeight(),e=g.outerWidth(),f=b+d,i=c,j=0,l=k.position().top,o=k.outerHeight();f>l+o&&(f=l+o),m.show();var p=m.outerWidth();j=e/2-p/2,m.css({top:f+5,left:i,"margin-left":j}),j<0?(m.css("margin-left","0"),n.hide()):n.show()}}function f(){null!=g&&(g.removeClass("clicked"),g=null,m.hide())}var g,h=this,i=h.txt,j=i.$txt,k=h.useMaxHeight?j.parent():j,l=!1,m=b('<div class="txt-toolbar"></div>'),n=b('<div class="tip-triangle"></div>'),o=b('<a href="#"><i class="wangeditor-menu-img-trash-o"></i></a>'),p=b('<a href="#"><i class="wangeditor-menu-img-search-minus"></i></a>'),q=b('<a href="#"><i class="wangeditor-menu-img-search-plus"></i></a>');k.on("click","table",function(a){var d=b(a.currentTarget);return c(),g&&g.get(0)===d.get(0)?void setTimeout(f,100):(g=d,e(),a.preventDefault(),void a.stopPropagation())}).on("click keydown scroll",function(a){setTimeout(f,100)}),a.$body.on("click keydown scroll",function(a){setTimeout(f,100)})})}),b(function(a,b){a.userAgent.indexOf("MSIE 8")>0||a.plugin(function(){function c(a,c){if(j){var d,e,f=function(){null!=c&&(p=c)},g=!1,h=j.parent();if("a"===h.get(0).nodeName.toLowerCase()?(e=h,g=!0):e=b('<a target="_blank"></a>'),null==c)return e.attr("href")||"";if(""===c)g&&(d=function(){j.unwrap()});else{if(c===p)return;d=function(){e.attr("href",c),g||j.wrap(e)}}d&&k.customCommand(a,d,f)}}function d(){q||(e(),f(),u.append(v).append(w).append(x).append(y).append(z).append(A).append(B).append(C),D.append(E).append(G).append(F),s.append(t).append(u).append(D),k.$editorContainer.append(s).append(r),q=!0)}function e(){function a(a,b){d&&k.customCommand(a,d,b)}var d;v.click(function(b){c(b,""),d=function(){j.remove()},a(b,function(){setTimeout(h,100)})}),x.click(function(b){d=function(){var a=j.get(0),b=a.width,c=a.height;b*=1.1,c*=1.1,j.css({width:b+"px",height:c+"px"})},a(b,function(){setTimeout(g)})}),w.click(function(b){d=function(){var a=j.get(0),b=a.width,c=a.height;b*=.9,c*=.9,j.css({width:b+"px",height:c+"px"})},a(b,function(){setTimeout(g)})}),y.click(function(b){d=function(){j.parents("p").css({"text-align":"left"}).attr("align","left")},a(b,function(){setTimeout(h,100)})}),A.click(function(b){d=function(){j.parents("p").css({"text-align":"right"}).attr("align","right")},a(b,function(){setTimeout(h,100)})}),z.click(function(b){d=function(){j.parents("p").css({"text-align":"center"}).attr("align","center")},a(b,function(){setTimeout(h,100)})}),B.click(function(a){a.preventDefault(),p=c(a),E.val(p),u.hide(),D.show()}),F.click(function(a){a.preventDefault();var d=b.trim(E.val());d&&c(a,d),setTimeout(h)}),G.click(function(a){a.preventDefault(),E.val(p),u.show(),D.hide()}),C.click(function(a){a.preventDefault(),c(a,""),setTimeout(h)})}function f(){function b(a){var b,h;b=a.pageX-c,h=a.pageY-d;var k=e+b,l=f+h;r.css({"margin-left":k,"margin-top":l});var m=g+b,n=i+h;j&&j.css({width:m,height:n})}var c,d,e,f,g,i;r.on("mousedown",function(k){j&&(c=k.pageX,d=k.pageY,e=parseFloat(r.css("margin-left"),10),f=parseFloat(r.css("margin-top"),10),g=j.width(),i=j.height(),s.hide(),a.$document.on("mousemove._dragResizeImg",b),a.$document.on("mouseup._dragResizeImg",function(b){a.$document.off("mousemove._dragResizeImg"),a.$document.off("mouseup._dragResizeImg"),h(),r.css({"margin-left":e,"margin-top":f}),H=!1}),H=!0)})}function g(){if(!k._disabled&&null!=j){j.addClass("clicked");var a=j.position(),b=a.top,c=a.left,d=j.outerHeight(),e=j.outerWidth();r.css({top:b+d,left:c+e});var f=b+d,g=c,h=0,i=o.position().top,l=o.outerHeight();f>i+l?f=i+l:r.show(),s.show();var m=s.outerWidth();h=e/2-m/2,s.css({top:f+5,left:g,"margin-left":h}),h<0?(s.css("margin-left","0"),t.hide()):t.show(),k.disableMenusExcept()}}function h(){null!=j&&(j.removeClass("clicked"),j=null,s.hide(),r.hide(),k.enableMenusExcept())}function i(a){var c=!1;return k.emotionUrls?(b.each(k.emotionUrls,function(b,d){var e=!1;if(a===d&&(c=!0,e=!0),e)return!1}),c):c}var j,k=this,l=k.config.lang,m=k.txt,n=m.$txt,o=k.useMaxHeight?n.parent():n,p=(k.$editorContainer,""),q=!1,r=b('<div class="img-drag-point"></div>'),s=b('<div class="txt-toolbar"></div>'),t=b('<div class="tip-triangle"></div>'),u=b("<div></div>"),v=b('<a href="#"><i class="wangeditor-menu-img-trash-o"></i></a>'),w=b('<a href="#"><i class="wangeditor-menu-img-search-minus"></i></a>'),x=b('<a href="#"><i class="wangeditor-menu-img-search-plus"></i></a>'),y=b('<a href="#"><i class="wangeditor-menu-img-align-left"></i></a>'),z=b('<a href="#"><i class="wangeditor-menu-img-align-center"></i></a>'),A=b('<a href="#"><i class="wangeditor-menu-img-align-right"></i></a>'),B=b('<a href="#"><i class="wangeditor-menu-img-link"></i></a>'),C=b('<a href="#"><i class="wangeditor-menu-img-unlink"></i></a>'),D=b('<div style="display:none;"></div>'),E=b('<input type="text" style="height:26px; margin-left:10px; width:200px;"/>'),F=b('<button class="right">'+l.submit+"</button>"),G=b('<button class="right gray">'+l.cancel+"</button>"),H=!1;o.on("mousedown","img",function(a){a.preventDefault()}).on("click","img",function(a){var c=b(a.currentTarget),e=c.attr("src");if(e&&!i(e)){if(d(),j&&j.get(0)===c.get(0))return void setTimeout(h,100);j=c,g(),u.show(),D.hide(),a.preventDefault(),a.stopPropagation()}}).on("click keydown scroll",function(a){H||setTimeout(h,100)})})}),b(function(a,b){a.plugin(function(){function a(){g||(n.append(o).append(p),k.$editorContainer.append(n),g=!0)}function c(){if(f){var a=f.position(),b=a.left,c=a.top,d=f.height(),e=c+d+5,g=k.menuContainer.height(),h=k.txt.$txt.outerHeight();e>g+h&&(e=g+h+5),n.css({top:e,left:b})}}function d(){if(!q&&f){a(),n.show();var b=f.attr("href");p.attr("href",b),c(),q=!0}}function e(){q&&f&&(n.hide(),q=!1)}var f,g,h,i,j,k=this,l=k.config.lang,m=k.txt.$txt,n=b('<div class="txt-toolbar"></div>'),o=b('<div class="tip-triangle"></div>'),p=b('<a href="#" target="_blank"><i class="wangeditor-menu-img-link"></i> '+l.openLink+"</a>"),q=!1;m.on("mouseenter","a",function(a){h&&clearTimeout(h),h=setTimeout(function(){var c=a.currentTarget,g=b(c);f=g;var h=g.children("img");h.length&&(h.click(function(a){e()}),h.hasClass("clicked"))||d()},500)}).on("mouseleave","a",function(a){i&&clearTimeout(i),i=setTimeout(e,500)}).on("click keydown scroll",function(a){setTimeout(e,100)}),n.on("mouseenter",function(a){i&&clearTimeout(i)}).on("mouseleave",function(a){j&&clearTimeout(j),j=setTimeout(e,500)})})}),b(function(a,b){a.plugin(function(){var b=this,c=b.config.menuFixed;if(c!==!1&&"number"==typeof c){var d=parseFloat(a.$body.css("margin-top"),10);isNaN(d)&&(d=0);var e=b.$editorContainer,f=e.offset().top,g=e.outerHeight(),h=b.menuContainer.$menuContainer,i=h.css("position"),j=h.css("top"),k=h.offset().top,l=h.outerHeight();b.txt.$txt,a.$window.scroll(function(){if(!b.isFullScreen){var m=a.$window.scrollTop(),n=h.width();0===k&&(k=h.offset().top,f=e.offset().top,g=e.outerHeight(),l=h.outerHeight()),m>=k&&m+c+l+30<f+g?(h.css({position:"fixed",top:c}),h.width(n),a.$body.css({"margin-top":d+l}),b._isMenufixed||(b._isMenufixed=!0)):(h.css({position:i,top:j}),h.css("width","100%"),a.$body.css({"margin-top":d}),b._isMenufixed&&(b._isMenufixed=!1))}})}})}),b(function(a,b){a.createMenu(function(c){var d="indent";if(c(d)){var e=this,f=new a.Menu({editor:e,id:d,title:"缩进",$domNormal:b('<a href="#" tabindex="-1"><i class="wangeditor-menu-img-indent-left"></i></a>'),$domSelected:b('<a href="#" tabindex="-1" class="selected"><i class="wangeditor-menu-img-indent-left"></i></a>')});f.clickEvent=function(a){function c(){d.css("text-indent","2em")}var d,f=e.getRangeElem(),g=e.getSelfOrParentByName(f,"p");return g?(d=b(g),void e.customCommand(a,c)):a.preventDefault()},f.clickEventSelected=function(a){function c(){d.css("text-indent","0")}var d,f=e.getRangeElem(),g=e.getSelfOrParentByName(f,"p");return g?(d=b(g),void e.customCommand(a,c)):a.preventDefault()},f.updateSelectedEvent=function(){var a,c,d=e.getRangeElem(),f=e.getSelfOrParentByName(d,"p");return!(!f||(a=b(f),c=a.css("text-indent"),!c||"0px"===c))},e.menus[d]=f}})}),b(function(a,b){a.createMenu(function(c){var d="lineheight";if(c(d)){var e=this;e.commandHooks.lineHeight=function(a){var c=e.getRangeElem(),d=e.getSelfOrParentByName(c,"p,h1,h2,h3,h4,h5,pre");d&&b(d).css("line-height",a+"")};var f=new a.Menu({editor:e,id:d,title:"行高",commandName:"lineHeight",$domNormal:b('<a href="#" tabindex="-1"><i class="wangeditor-menu-img-arrows-v"></i></a>'),$domSelected:b('<a href="#" tabindex="-1" class="selected"><i class="wangeditor-menu-img-arrows-v"></i></a>')}),g={"1.0":"1.0倍",1.5:"1.5倍",1.8:"1.8倍","2.0":"2.0倍",2.5:"2.5倍","3.0":"3.0倍"},h='<span style="line-height:{#commandValue}">{#title}</span>';f.dropList=new a.DropList(e,f,{data:g,tpl:h}),e.menus[d]=f}})}),b(function(a,b){a.plugin(function(){var c=this,d=c.config.customUpload;if(d){if(c.config.uploadImgUrl)return alert("自定义上传无效，详看浏览器日志console.log"),void a.error("已经配置了 uploadImgUrl ，就不能再配置 customUpload ，两者冲突。将导致自定义上传无效。");var e=c.$uploadContent;e||a.error("自定义上传，无法获取 editor.$uploadContent");var f=b('<div class="upload-icon-container"><i class="wangeditor-menu-img-upload"></i></div>');e.append(f);var g="upload"+a.random(),h="upload"+a.random();f.attr("id",g),e.attr("id",h),c.customUploadBtnId=g,c.customUploadContainerId=h}})}),b(function(a,b){a.info("本页面富文本编辑器由 wangEditor 提供 http://wangeditor.github.io/ ")}),window.wangEditor})}).call(exports,__webpack_require__(47),__webpack_require__(298)(module))}});